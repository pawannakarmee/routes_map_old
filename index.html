<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Route Display</title>

    <!-- Local Leaflet CSS for offline compatibility -->
    <link rel="stylesheet" href="leaflet.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet/dist/leaflet.css"
      onerror="this.remove()"
    />

    <!-- Google font (optional) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <script src="leaflet.js"></script>
    <script>
      // If local leaflet.js is missing or failed, load CDN
      if (typeof window.L === "undefined") {
        const s = document.createElement("script");
        s.src = "https://unpkg.com/leaflet/dist/leaflet.js";
        document.head.appendChild(s);
      }
    </script>

    <script>
      document.addEventListener(
        "touchstart",
        function (event) {
          if (event.touches.length > 1) {
            event.preventDefault(); // allow pinch zoom
          }
        },
        { passive: false },
      );

      let lastTouchEnd = 0;
      document.addEventListener(
        "touchend",
        function (event) {
          let now = new Date().getTime();
          if (now - lastTouchEnd <= 350) {
            event.preventDefault(); // block double-tap zoom
          }
          lastTouchEnd = now;
        },
        { passive: false },
      );
    </script>

    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
      }

      #map {
        touch-action: none;
        -ms-touch-action: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
        height: 100vh;
        width: 100vw;
        background-color: #000000; /*screen backgroud*/
      }

      /* fixes name labels styling*/
      .coord-label {
        background: none !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        margin: 0 !important;
        /*color: white; handled by js below*/
        font-size: 10px;
        font-family: sans-serif;
        font-weight: light; /* Thinner font */
        text-align: center;
        opacity: 0.6;
        position: fixed;
        z-index: 1 !important; /* lower than freq-label */
      }
      .coord-label::before {
        display: none !important;
      }

      /* airway name labels styling after button press eg, G462*/
      .airway-label {
        background-color: rgba(65, 75, 85, 0.9) !important;
        /*background: transparent !important;*/
        border: none !important;
        padding: 2px !important;
        margin: 0px !important;
        box-shadow: none !important;
        font-size: 12px;
        font-family: "Roboto", sans-serif;
        font-weight: bold;
        color: rgb(247, 195, 52) !important;
        text-shadow: none !important;
        line-height: 1;
        z-index: 500 !important;
      }

      /* ---------Menu bar styling ------on color- "#B4F59D", off color "#c2c2c0"; -----------------*/
      .map-menu-bar {
        position: fixed;
        top: 0px;
        left: 0px;
        right: 0px;
        z-index: 3000;
        display: flex;
        gap: 3px;
        padding: 3px;
        background: rgba(75, 89, 97, 0.6);
        backdrop-filter: blur(0.5px);
      }

      /* ------menu button styling (flat look)----- */
      .map-btn {
        padding: 6px 10px;
        font-size: 11.2px;
        color: #e6e6e3;
        cursor: pointer;
        height: 28px;
        width: auto;
        min-width: 45px;
        /*background: transparent;  Remove background */
        background: rgba(75, 89, 97, 1);
        border: 0.5px solid #6a7f71;
        /*border: none;  Remove border */
        border-radius: 14px; /* Remove individual rounding */
      }
      .map-btn:hover {
        background: rgba(110, 144, 148, 0.7);
      }
      /*
      #toggleRunwaysBtn {
        color: #b4f59d;
      }
*/
      #toggleWaypointsBtn {
        color: #b4f59d;
      }
      /* danger Areas button with submenu */
      .map-btn-panel {
        position: relative;
        display: inline-flex;
        flex-direction: column;
      }

      .areas-checkboxes {
        display: none;
        position: absolute;
        top: 116%;
        left: 0;
        min-width: 60px;
        background: rgba(186, 189, 190, 0.95);
        color: #0a3a40;
        padding: 6px;
        margin-top: 1px;
        border-radius: 6px;
        box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
        font-size: 11px;
        font-family: sans-serif;
        z-index: 1002;
      }
      .areas-checkboxes label {
        display: block;
        margin: 2px 0;
      }
      /* Show checkboxes when Areas or Sectors button is active */
      #areasPanel.active .areas-checkboxes,
      #mapLayerPanel.active .areas-checkboxes,
      #sectorPanel.active .sector-checkboxes,
      #sid12_Panel.active .areas-checkboxes {
        display: block;
      }

      #clearAreasBtn.map-btn {
        font-size: 9px;
        padding: 4px 8px;
        height: 20px;
        width: 85px;
        text-align: center;
      }

      /* -------Custom sector-checkboxes style-------- */
      #sectorHeader {
        width: 80px;
        height: 28px;
      }

      .sector-info-group {
        display: flex;
        gap: 3px;
      }

      .sector-btn-wrapper {
        position: relative; /* anchor point */
        display: inline-block;
      }
      .sector-checkboxes {
        position: absolute;
        top: 100%; /* directly below Sectors button */
        left: 0;
        margin-top: 5px;
        margin-left: 1.5px;
        width: 65px;
        display: none;
        background: rgba(45, 59, 71, 0.8);
        color: #d3d3d3;
        padding: 6px;
        border-radius: 6px;
        box-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
        font-size: 11px;
        font-family: sans-serif;
        z-index: 1002;
      }
      .sector-checkboxes label {
        display: block;
        margin: 3px 0; /* Slightly more spacing between labels */
      }
      .sector-checkboxes hr {
        margin: 6px 0;
        border-color: #d3d3d3; /* Match text color for consistency */
      }
      /* Ensure sectorPanel is pushed to the far right */
      #sectorPanel {
        margin-left: auto;
      }

      #sectorTablePanel {
        position: absolute;
        background: rgba(45, 59, 71, 0.8);
        cursor: move; /* draggable look */
        z-index: 1000;
      }

      #toolMenu {
        width: 50px;
        color: #6ec4c4;
        border-color: #4d8d8d;
      }

      /*---------------------tool bar---------------*/
      .tool-bar {
        position: fixed;
        top: 38px;
        right: 3px;
        z-index: 3000;
        display: flex;
        flex-direction: column;
        width: 40px;
        gap: 5px;
        padding: 6px;
        background: rgba(75, 89, 97, 0.6);
        border-radius: 24px;
      }

      /* ------tool button styling (flat look)----- */
      .tool-btn {
        padding: 0px 0px;
        font-size: 10px;
        color: #6ec4c4; /*#03F7F7;*/
        cursor: pointer;
        height: 40px;
        width: 40px;
        /*max-width: 40px;*/
        background: rgba(75, 89, 97, 2);
        border: 0.5px solid #029494;
        border-radius: 22px;
      }
      .tool-btn:hover {
        background: rgba(120, 144, 152, 0.7);
      }

      /*----- direction arrow of ariway name ------- */
      .airway-arrow {
        width: 0;
        height: 0;
        display: inline-block;
        margin: 0 2px;
      }

      .airway-arrow.right {
        border-top: 4px solid transparent;
        border-bottom: 4px solid transparent;
        border-left: 6px solid #aa9b5d;
      }

      .airway-arrow.left {
        border-top: 4px solid transparent;
        border-bottom: 4px solid transparent;
        border-right: 6px solid #aa9b5d;
      }

      .airway-name-tooltip {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
      }

      @font-face {
        font-family: "Inter";
        src: url("/fonts/Inter-VariableFont_slnt,wght.ttf") format("truetype");
        font-weight: 400 700;
        font-style: normal;
        font-display: swap;
      }

      .airway-name-inner {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-family: "Inter", "Segoe UI", sans-serif;
        font-size: 10.2px;
        font-weight: 500;
        letter-spacing: 0.02em;
        line-height: 1;
        -webkit-font-smoothing: antialiased;
        text-rendering: geometricPrecision;

        color: rgb(163, 163, 90);
        background: rgba(0, 0, 0, 0.65);
        border-radius: 2px;

        transform-origin: center center;
        white-space: nowrap;
      }

      /* --- Crosshair --- */
      #crosshair {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin-left: -10px;
        margin-top: -10px;
        pointer-events: none;
        z-index: 9999;
      }
      #crosshair:before,
      #crosshair:after {
        content: "";
        position: absolute;
        background: #353d4a;
      }
      #crosshair:before {
        left: 9px;
        top: 0;
        bottom: 0;
        width: 1px;
      }
      #crosshair:after {
        top: 9px;
        left: 0;
        right: 0;
        height: 1px;
      }

      #centerCoords {
        background: rgba(55, 65, 75, 0.9);
        position: fixed;
        bottom: 20px;
        right: 2px;
        width: 150px;
        text-align: center;
        color: white;
        border: none;
        border-radius: 14px;
        height: 18px;
        padding: 3px 6px;
        font-size: 11px;
        user-select: text;
        pointer-events: auto;
        z-index: 1000;
      }

      /* --drawing -tools ---------------*/
      .rbl-tooltip {
        background: rgba(55, 75, 87, 0.7);
        border: none;
        color: #fcd78e;
        height: 18px;
        padding: 3px 6px;
        border-radius: 8px;
        box-shadow: none;
        font-size: 11px;
      }

      .freq-marker {
        border: none;
        box-shadow: none;
        font-family: monospace;
      }
      .freq-label {
        background: rgba(47, 57, 63, 0.7);
        color: #e6e6de;
        padding: 1px 4px;
        border-radius: 8px;
        font-size: 11px;
        white-space: nowrap;
        position: absolute;
        z-index: 2 !important;
      }

      /*multi point measure line---*/
      .measure-tooltip {
        background: none !important;
        border: none !important;
        box-shadow: none !important;
        color: yellow;
        font-weight: bold;
        font-family: monospace;
      }

      /* ---------------text box style-----------------*/
      .text-marker {
        pointer-events: auto;
      }

      .text-box-container {
        position: relative;
        display: inline-block;
      }
      .text-box {
        min-width: 100px;
        min-height: 45px;
        resize: both;
        background: rgba(192, 194, 196, 0.9);
        color: black;
        border: 0.2px solid #7d514f;
        border-radius: 6px;
        padding: 6px 18px 6px 6px;
        font-size: 12px;
        font-weight: bold;
        font-family: "Roboto", sans-serif;
        outline: none;
        z-index: 1000 !important;
        position: relatice;
      }

      .text-box-drag-handle {
        position: absolute;
        top: 2px;
        left: 2px;
        width: 12px;
        height: 12px;
        cursor: move;
        user-select: none;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 2px;
      }

      .text-box-close {
        position: absolute;
        top: 2px;
        right: 4px;
        font-size: 16px;
        /*cursor: pointer;*/
        color: #272323;
        font-weight: bold;
      }

      .text-box-close:hover {
        cursor: pointer;
        color: rgb(230, 10, 10);
      }
      /*-------------------route pair area styling--------------------*/
      /* Modern floating toggle */
      .rp-toggle {
        position: absolute;
        top: 44px;
        left: 171px; /* spawn position (OPEN) */
        z-index: 20000;

        width: 30px;
        height: 28px;
        border-radius: 10px;
        background: rgba(35, 49, 57, 0.7);
        border: 1px solid rgba(97, 128, 138, 0.479);
        backdrop-filter: blur(8px);

        display: flex;
        align-items: center;
        justify-content: center;

        cursor: pointer;
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.35);
        /*transition: left 180ms ease, transform 120ms ease, background 180ms ease;*/
      }

      /* Arrow base */
      .rp-arrow {
        width: 0;
        height: 0;
        border-style: solid;
      }

      /* OPEN → arrow DOWN */
      .rp-toggle.is-open .rp-arrow {
        border-width: 8px 6px 0 6px;
        border-color: #fff transparent transparent transparent;
      }

      /* CLOSED → arrow LEFT */
      .rp-toggle.is-closed .rp-arrow {
        border-width: 6px 8px 6px 0;
        border-color: transparent #fff transparent transparent;
      }

      /*------------------*/
      #routePanel {
        position: absolute;
        top: 36px;
        left: 3px;
        background: rgba(35, 49, 57, 0.6);
        /*border: 1px solid #ccc; #999;*/
        border-radius: 8px;
        padding: 8px;
        width: 150px;
        max-height: 92%;
        overflow: hidden;
        /*overflow-y: auto;*/
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
        display: flex;
        flex-direction: column;
        z-index: 1000;
      }
      #routeList {
        overflow-y: auto;
        overflow-x: hidden;
        padding-right: 6px;
      }
      #routeList::-webkit-scrollbar {
        width: 4px; /* narrower scrollbar */
      }
      #routeList::-webkit-scrollbar-thumb {
        background-color: rgba(200, 200, 200, 0.5); /* thumb color */
        border-radius: 3px;
      }
      #routeList::-webkit-scrollbar-track {
        background-color: transparent;
      }

      /*-------route pair buttons styling------------*/
      #routeList button {
        display: block;
        width: 100%;
        margin-bottom: 5px;
        padding: 4px;
        font-size: 11px;
        font-family: sans-serif;
        border-radius: 12px;
        border: 0.1px solid rgb(124, 123, 123);
        background: rgb(41, 54, 54);
        color: #ddd7db;
        cursor: pointer;
        transition: transform 0.2s ease;
        transform-origin: center;
        will-change: transform;
      }
      #routeList button:hover {
        /*transform: scale(1.1);*/
        background-color: #fbc965;
        color: black;
        z-index: 1;
      }

      /*--format route pair button when selected--*/
      #routeList button.selected-route {
        background-color: #fbc965;
        color: black;
        /*font-weight: bold;*/
        border: 1px solid black;
      }

      #routeFilters {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        background: rgba(0, 0, 0, 0.15);
        border-bottom: 1px solid #888;
      }

      /*--Arr,Dep,Ovf buttons ---------------*/
      .filter-btn {
        flex: 1;
        padding: 4px;
        margin: 2px;
        color: #3f550f;
        font-size: 12px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        background: #b3afaf;
      }
      .filter-btn:hover {
        transform: scale(1.1);
        background-color: #fbc965;
        color: black;
      }

      .filter-btn.selected {
        background-color: #fbc965;
        color: black;
        font-size: 12px;
        font-weight: bold;
        border: 1px solid black;
      }

      /*-----------------sector letter in colored area styling big letter---------------------*/
      .sector-label {
        background: none !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        margin: 0 !important;
        color: rgba(255, 255, 255, 0.4) !important;
        font-size: 48px !important;
        font-family: sans-serif !important;
        font-weight: bold !important;
        text-align: bottom !important;
        opacity: 1 !important; /* Ensure container is fully visible; opacity is handled via rgba */
      }

      /* ----------------holding pattern tooltip styling----------------*/
      .leaflet-tooltip.holding-tooltip {
        background-color: rgba(10, 60, 70, 0.8);
        color: #d6d878;
        border: 1px solid grey;
        border-radius: 10px;
        padding: 6px 10px;
        font-size: 10.5px;
        font-family: Arial, sans-serif;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(3px);
        z-index: 900 !important;
      }

      /* Remove the little arrow ("tip") */
      .leaflet-tooltip.holding-tooltip::before,
      .leaflet-tooltip.holding-tooltip::after {
        display: none !important;
      }

      /* Danger-Area Details tooltip top center*/
      .area-details-panel {
        position: absolute;
        top: 35px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(10, 60, 70, 1);
        padding: 8px 12px;
        border-radius: 10px;
        border: 1px solid grey;
        font-size: 13px;
        font-family: Arial, sans-serif;
        white-space: pre-line; /* Changed from pre-wrap to normal to collapse whitespace */
        display: none;
        text-align: left;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
        line-height: 1.5; /* Reduced line-height for tighter spacing */
        z-index: 2000;
      }
      .area-details-panel strong {
        font-weight: bold;
      }
      #areaDetailsPanel::first-line {
        line-height: 0; /* tighten the top */
      }

      /*------------------------ Tooltip container ---------------------------------*/
      .tooltip-container {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        flex-direction: column; /* Stack vertically */
        align-items: center;
        gap: 3px;
        pointer-events: auto; /* Allow interaction with tooltips */
        z-index: 1500;
      }

      .tooltip {
        padding: 6px 12px;
        background: #233139;
        color: white;
        font-size: 13px;
        font-family: monospace; /*"Roboto", sans-serif;*/
        border-radius: 12px;
        text-align: center;
        white-space: nowrap; /* Keep nowrap for single-line tooltips */
        overflow: hidden;
        text-overflow: ellipsis;
        width: auto;
        height: 14px;
        max-width: none;
        display: inline-block; /* Ensure individual width calculation */
        user-select: text; /* Allow text selection */
      }

      .is-hidden {
        display: none !important;
      }
      /*------ Specific styling for remarks tooltip --------*/
      #remarksOverlay.tooltip {
        background: rgba(191, 227, 209, 0.9);
        /*border: 1px solid rgba(134, 230, 173, 0.9);*/
        border-radius: 14px;
        color: #00252b;
        font-size: 13px;
        font-family: monospace;
        font-weight: bold;
        height: auto;
      }

      /*----Specific styling CFL_XFL tooltip at the ends of the route------*/
      .leaflet-tooltip.route-extra-label {
        background-color: rgba(191, 227, 209, 1) !important;
        color: #00252b !important;
        padding: 1px 7px;
        font-weight: bold;
        font-size: 11px;
        border: none;
        border-radius: 11px;
        position: absolute;
        z-index: 100;
      }

      /* Ensure map has relative positioning for absolute children */
      #map {
        position: relative;
        width: 100%;
        height: 100vh; /* Adjust based on  map height */
      }
      .leaflet-container {
        cursor: crosshair !important;
      }
      /* Pen tool cursor – FORCE it on all Leaflet panes */
      .leaflet-container.pen-cursor,
      .leaflet-container.pen-cursor * {
        cursor:
          url("./pen-cursor.png") 6 26,
          crosshair !important;
      }

      .leaflet-control-attribution {
        font-size: 12px;
        font-weight: 400;
      }

      /*add yellow spot at the end of the drawn route line*/
      .arrow-head {
        width: 3px;
        height: 3px;
        background: url('data:image/svg+xml;utf8,<svg fill="yellow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="75" cy="60" r="30"/></svg>')
          no-repeat center;
        background-size: contain;
        transform-origin: center;
      }
    </style>
  </head>
  <body>
    <!-- Menu bar for buttons -->
    <div id="map">
      <div id="crosshair"></div>
    </div>

    <div id="mapMenuBar" class="map-menu-bar">
      <button id="toggleMapBtn" class="map-btn">Toggle Map</button>
      <button id="resetViewBtn" class="map-btn">RTE Clear</button>
      <button id="toggleRouteTipsBtn" class="map-btn">RTE Info</button>
      <div id="mapLayerPanel" class="map-btn-panel">
        <button id="toggleMapLayerBtn" class="map-btn">Map Layers ▸</button>
        <div id="mapLayerCheckboxes" class="areas-checkboxes">
          <label><input type="checkbox" id="mlAwyLabels" /> AWYLabels</label>
          <label><input type="checkbox" id="mlFixes" checked /> Fixes</label>
          <label><input type="checkbox" id="mlRunways" checked /> RWYs</label>
          <label><input type="checkbox" id="mlBorders" /> Borders</label>
          <label
            ><input type="checkbox" id="mlAirspace" checked /> Airspace</label
          >
        </div>
      </div>

      <div id="areasPanel" class="map-btn-panel">
        <button id="toggleAreasBtn" class="map-btn">Areas ▸</button>
        <div id="areasCheckboxes" class="areas-checkboxes">
          <label
            ><input type="checkbox" id="toggleRestricted" /> Restricted</label
          >
          <label
            ><input type="checkbox" id="toggleProhibitated" />
            Prohibitated</label
          >
          <label><input type="checkbox" id="toggleDanger" /> Danger</label>
          <label><input type="checkbox" id="toggleTraining" /> Training</label>
          <label><input type="checkbox" id="toggleCTA" /> CTA</label>
          <label><input type="checkbox" id="toggleDetails" /> Info</label>
          <button id="clearAreasBtn" class="map-btn">Clear</button>
        </div>
      </div>
      <button id="showHoldingsBtn" class="map-btn">HLD pts</button>
      <button id="toggleFreqBtn" class="map-btn">FREQ</button>

      <div id="sid12_Panel" class="map-btn-panel">
        <button id="toggleSidBtn" class="map-btn">SIDs ▸</button>
        <div id="sid12Checkboxes" class="areas-checkboxes">
          <label><input type="checkbox" id="rwyOMAA13" /> AA_13</label>
          <label><input type="checkbox" id="rwyOMAA13" /> AA_31</label>
          <label><input type="checkbox" id="rwyOMAD13" /> AD_13</label>
          <label><input type="checkbox" id="rwyOMDB12" /> DB_12</label>
          <label><input type="checkbox" id="rwyOMSJ12" /> SJ_12</label>
        </div>
      </div>
      <!--<button id="showSidBtn" class="map-btn">SIDs ▸</button>-->

      <div id="toolBar" class="tool-bar">
        <!--<button id="toolsBtn" class ="tool-btn">Tools</button>-->
        <button id="rblToolBtn" class="tool-btn">RBL</button>
        <button id="clearRblBtn" class="tool-btn">Clear RBLs</button>
        <button id="measureBtn" class="tool-btn">Scale</button>
        <button id="clearMeasuresBtn" class="tool-btn">Clear Scale</button>
        <button id="penBtn" class="tool-btn">Pen</button>
        <button id="clearPenBtn" class="tool-btn">Clear Pen</button>
        <button id="textToolBtn" class="tool-btn">Text Box</button>
        <button id="clearTextBtn" class="tool-btn">Clear Boxes</button>
      </div>

      <div id="sectorPanel" class="map-btn-panel">
        <div class="sector-info-group">
          <button id="toggleTableBtn" class="map-btn">Sector Info ▸</button>
          <div class="sector-btn-wrapper">
            <button id="sectorHeader" class="map-btn">Sectors ▸</button>
            <div id="sectorOptions" class="sector-checkboxes">
              <label
                ><input type="checkbox" id="selectHighSectors" /> High</label
              >
              <label><input type="checkbox" id="selectLowSectors" /> Low</label>
              <hr style="margin: 6px 0; border-color: #0a3a40" />
              <label><input type="checkbox" value="S" /> ACCS</label>
              <label><input type="checkbox" value="L" /> ACCL</label>
              <label><input type="checkbox" value="B" /> ACCB</label>
              <label><input type="checkbox" value="G" /> ACCG</label>
              <label><input type="checkbox" value="A" /> ACCA</label>
              <label><input type="checkbox" value="N" /> ACCN</label>
              <label><input type="checkbox" value="M" /> ACCM</label>
              <label><input type="checkbox" value="W" /> ACCW</label>
              <label><input type="checkbox" value="C" /> ACCC</label>
              <label><input type="checkbox" value="D" /> ACCD</label>
              <label><input type="checkbox" value="H" /> ACCH</label>
              <label><input type="checkbox" value="E" /> ACCE</label>
              <label><input type="checkbox" value="Y" /> ACCY</label>
              <label><input type="checkbox" value="R" /> ACCR</label>
              <hr style="margin: 6px 0; border-color: gray" />
              <label>
                <input type="checkbox" id="showSectorColors" /> Show
              </label>
            </div>
          </div>
          <button id="toolMenu" class="map-btn">Tools</button>
        </div>
      </div>
    </div>

    <button
      id="toggleRoutePanelBtn"
      type="button"
      class="rp-toggle"
      aria-label="Toggle Route Panel"
    >
      <span class="rp-arrow"></span>
    </button>

    <!--route filter buttons -->
    <div id="routePanel">
      <div id="routeFilters">
        <button onclick="filterRoutes('Arr')" class="filter-btn selected">
          Arr
        </button>
        <button onclick="filterRoutes('Dep')" class="filter-btn">Dep</button>
        <button onclick="filterRoutes('Ovf')" class="filter-btn">Ovf</button>
        <button onclick="filterRoutes('FRA')" class="filter-btn">FRA</button>
      </div>
      <div id="routeList"></div>
    </div>

    <div id="tooltipContainer" class="tooltip-container">
      <div id="sectorTooltip" class="tooltip">Sectors:</div>
      <div id="routeTooltip" class="tooltip">Route:</div>
      <div id="expandedRouteTooltip" class="tooltip">Waypoints:</div>
      <div id="remarksOverlay" class="tooltip">Remarks:</div>
    </div>

    <div id="areaDetailsPanel" class="area-details-panel">
      <strong id="areaName">Area</strong>
      <span id="areaLimit"></span>
      <span id="areaType"></span>
    </div>

    <!-- ----Floating Table for sector info------------->
    <div
      id="sectorTablePanel"
      style="
        padding: 12px;
        border-radius: 8px;
        font-size: 11px;
        font-family: sans-serif;
        z-index: 1500;
        display: none;
      "
    >
      <table
        id="sectorTable"
        border="1"
        cellpadding="6"
        cellspacing="0"
        style="
          border-collapse: collapse;
          background: rgba(35, 49, 58, 0.8);
          color: white;
        "
      >
        <thead>
          <tr>
            <th>Sectors</th>
            <th>Limit</th>
            <th>Freq</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- zoonslider at the bottom of the screen styling--currently hidden with js code-->
    <div
      id="zoomSliderPanel"
      style="
        position: absolute;
        bottom: 5px;
        right: 3px;
        /*background: rgba(0, 0, 0, 0.1);*/
        padding: 8px;
        border-radius: 16px;
        color: white;
        font-size: 8px;
        font-family: sans-serif;
        height: 5px;
        width: 150px;
      "
    >
      <label for="zoomSlider"></label>
      <input
        type="range"
        id="zoomSlider"
        min="5"
        max="12"
        step="0.3"
        value="7"
      />
      <span id="zoomValue">7.0</span>
    </div>
    <input type="text" id="centerCoords" readonly />
    <!--style="width:180px; text-align:center;-->

    <script src="ne_countries_inline.js"></script>

    <script>
      function convertDMSToDecimal(dmsStr) {
        const match = dmsStr.match(
          /^(\d{2,3})(\d{2})(\d{2}(?:\.\d+)?)([NSWE])$/,
        );
        if (!match) return null;
        const [, deg, min, sec, dir] = match;
        let decimal =
          parseInt(deg) + parseInt(min) / 60 + parseFloat(sec) / 3600;
        if (dir === "S" || dir === "W") decimal *= -1;
        return decimal;
      }
      function dmsToLatLng(latDMS, lonDMS) {
        return [convertDMSToDecimal(latDMS), convertDMSToDecimal(lonDMS)];
      }
      // Basemap layer with required Esri attribution
      const baseMapLayer = L.tileLayer(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",
        {
          attribution:
            '© <a href="https://www.esri.com/">Esri</a>, ' +
            '© Map data from <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
            "and the GIS User Community",
          maxZoom: 19,
          opacity: 0.75,
        },
      );

      //----------------main map border coordinates--------------------------
      const rawCoords = [
        ["262100N", "0560600E"],
        ["253600N", "0561300E"],
        ["250000N", "0563500E"],
        ["240000N", "0553500E"],
        ["224200N", "0551200E"],
        ["225611N", "0523488E"],
        ["240300N", "0514700E"],
        ["254900N", "0530600E"],
        ["260430N", "0535730E"],
        ["253800N", "0552000E"],
        ["262100N", "0560600E"],
      ];

      //----global variables------------
      let airspaceVisible = true;
      let firBoundaryVisible = true;
      let trianglesVisible = true;
      let airwayLinesVisible = true;

      let lastRouteBounds = null;

      const sectorHoverLayers = {}; // code -> Leaflet polyline/polygon (TEMP)
      let temporarySectors = [];
      let airwaysDrawn = false;
      let airwayColor = "grey"; // map ON default
      const airwayLayers = [];

      const sectorPolygons = {};
      const airwayPolylineMap = {};
      const freqLayer = L.layerGroup();
      let coordLabelColor = "#919C9C"; //waypoint name color
      let highlightedAirway = null;
      let activeHighlightedAirways = new Map();
      let airwayColorIndex = 0;
      let sectorLayers = {};
      let extraLabelMarkers = [];
      let drawnAreaLayers = [];
      let drawnRouteLayers = [];
      let holdingLayers = [];
      let holdingMarkers = [];
      let runwayLayers = [];
      let runwaysVisible = true;
      let highlightedAirwayLayers = [];
      let holdingsVisible = false;
      let areasVisible = false;
      let sectorVisible = false;
      let mapLayerVisible = false;
      let currentRouteFilter = "Arr";
      let coordsVisible = true; //waypoint name toggle visible
      let triangleLayers = [];
      let routeTipsVisible = false;
      const prohibitated = L.layerGroup();
      const restricted = L.layerGroup();
      const danger = L.layerGroup();
      const training = L.layerGroup();
      const CTA = L.layerGroup();
      let areaTooltip = null; // Global variable to track the area tooltip
      const airwayLabelLayer = L.layerGroup();
      let airwayLabelsVisible = false;
      let activeTextMarker = null; // current selected marker
      let pendingClearMarker = null; // captured on mousedown (pre-blur)
      const PEN_CURSOR = "pen-cursor.png";
      let latlngs = [];
      //--------------convert coordinates decimal numbers

      latlngs = rawCoords
        .map(([latDMS, lonDMS]) => [
          convertDMSToDecimal(latDMS),
          convertDMSToDecimal(lonDMS),
        ])
        .filter(([lat, lon]) => lat !== null && lon !== null);

      //10nm final extended lines ------------

      const runwayCoords = {
        OMAA_31L: [
          ["242518N", "0544001E"],
          ["241909N", "0544841E"],
        ],
        OMAA_31R: [
          ["242632N", "0544012E"],
          ["242024N", "0544852E"],
        ],
        OMAA_13L: [
          ["242754N", "0543817E"],
          ["243403N", "0542938E"],
        ],
        OMAA_13R: [
          ["242639N", "0543806E"],
          ["243248N", "0542927E"],
        ],

        OMAD_31: [
          ["242510N", "0542814E"],
          ["241900N", "0543651E"],
        ],
        OMAD_13: [
          ["242614N", "0542644E"],
          ["243225N", "0541806E"],
        ],

        OMAL_19: [
          ["241647N", "0553642E"],
          ["242641N", "0553807E"],
        ],
        OMAL_01: [
          ["241438N", "0553624E"],
          ["240443N", "0553459E"],
        ],

        //"OMAM_13L": [["241530N", "0543200E"], ["242132N", "0542315E"]],
        //"OMAM_13R": [["241427N", "0543212E"], ["242029N", "0542327E"]],
        //"OMAM_31L": [["241315N", "0543355E"], ["240714N", "0544240E"]],
        //"OMAM_31R": [["241418N", "0543343E"], ["240816N", "0544227E"]],

        OMBY_13: [
          ["241729N", "0523416E"],
          ["242414N", "0522611E"],
        ],
        OMBY_31: [
          ["241633.46N", "0523522.45E"],
          ["240948N", "0524327E"],
        ],

        OMAS_31: [
          ["250802.32N", "0525247.65E"],
          ["250131N", "0530110E"],
        ],
        OMAS_13: [
          ["250834N", "0525207E"],
          ["251504N", "0524344E"],
        ],

        OMDB_12L: [
          ["251600N", "0552047E"],
          ["252113N", "0551122E"],
        ],
        OMDB_12R: [
          ["251522N", "0552129E"],
          ["252035N", "0551204E"],
        ],
        OMDB_30L: [
          ["251407N", "0552345E"],
          ["250853N", "0553310E"],
        ],
        OMDB_30R: [
          ["251446N", "0552300E"],
          ["250933N", "0553225E"],
        ],

        OMDW_30: [
          ["245310N", "0551049E"],
          ["244757N", "0552012E"],
        ],
        OMDW_12: [
          ["245426N", "0550831E"],
          ["245938N", "0545907E"],
        ],
        //"OMDW_31": [["245143N", "0551005E"], ["244631N", "0551929E"]], //1838m
        //"OMDW_13": [["245214N", "0550909E"], ["245726N", "0545944E"]], //1838m

        OMSJ_30: [
          ["251914N", "0553208E"],
          ["251352N", "0554127E"],
        ],
        OMSJ_12: [
          ["252025N", "0553006E"],
          ["252547N", "0552046E"],
        ],

        OMRK_16: [
          ["253747N", "0555602E"],
          ["254726N", "0555308E"],
        ],
        OMRK_34: [
          ["253549N", "0555638E"],
          ["252610N", "0555931E"],
        ],

        OMFJ_11: [
          ["250707N", "0561825E"],
          ["251056N", "0560813E"],
        ],
        OMFJ_29: [
          ["250620N", "0562029E"],
          ["250230N", "0563040E"],
        ],
        //"OMFJ_11R" :[["250652N", "0561845E"], ["251041N", "0560834E"]],
        //"OMFJ_29L" :[["250614N", "0562026E"], ["250224N", "0563037E"]],

        SIR_12: [
          ["255458N", "0543145E"],
          ["260054N", "0542248E"],
        ],
        SIR_30: [
          ["255411N", "0543258E"],
          ["254815N", "0544154E"],
        ],

        KIS_27R: [
          ["263136N", "0535957E"],
          ["263045N", "0541105E"],
        ],
        KIS_09L: [
          ["263146N", "0535746E"],
          ["263237N", "0534638E"],
        ],
        //"KIS_27L": [["263126N", "0535957E"], ["263035N", "0541104E"]],
        //"KIS_09R": [["263136N", "0535745E"], ["263227N", "0534637E"]],

        MCT_08R: [
          ["233531N", "0581618E"],
          ["233439N", "0580526E"],
        ],
        MCT_26L: [
          ["233542N", "0581824E"],
          ["233633N", "0582916E"],
        ],
        //"MCT_08L": [["233621N", "0581529E"], ["233528N", "0580437E"]],
        //"MCT_26R": [["233632N", "0581744E"], ["233724N", "0582836E"]],

        OOSH_15: [
          ["242409N", "0563702E"],
          ["243312N", "0563223E"],
        ],
        OOSH_33: [
          ["242211N", "0563802E"],
          ["241308N", "0564241E"],
        ],

        BND_12L: [
          ["271357N", "0562315E"],
          ["272248N", "0562828E"],
        ],
        BNE_03R: [
          ["271211N", "0562213E"],
          ["270320N", "0561701E"],
        ],

        QSM_23: [
          ["264601N", "0555507E"],
          ["265232N", "0560337E"],
        ],
        QSM_05: [
          ["264432N", "0555310E"],
          ["263802N", "0554441E"],
        ],

        DOH_16L: [
          ["251746N", "0513632E"],
          ["252703N", "0513226E"],
        ],
        DOH_34R: [
          ["251520N", "0513736E"],
          ["250603N", "0514142E"],
        ],
        DOH_16R: [
          ["251728N", "0513523E"],
          ["252645N", "0513118E"],
        ],
        DOH_34L: [
          ["251519N", "0513619E"],
          ["250602N", "0514024E"],
        ],

        BAH_12L: [
          ["261644N", "0503710E"],
          ["262209N", "0502748E"],
        ],
        BAH_30R: [
          ["261546N", "0503852E"],
          ["261021N", "0504814E"],
        ],
      };

      //sector coordinates
      const southCoords = [
        ["252629.4279N", "0524901.1237E"],
        ["251727.2300N", "0531010.5921E"],
        ["251028.0206N", "0532257.8798E"],
        ["245849.4608N", "0534229.3001E"],
        ["250412.9847N", "0535018.1858E"],
        ["245723.3151N", "0540231.4151E"],
        ["245234.9377N", "0540545.5866E"],
        ["245033.3087N", "0541052.3203E"],
        ["250339.4072N", "0544513.1108E"],
        ["244618.3182N", "0552117.0064E"],
        ["244334.4990N", "0551013.7592E"],
        ["243913.4400N", "0545229.7502E"],
        ["242300.0058N", "0541138.5536E"],
        ["242716.7810N", "0535734.9107E"],
        ["243600.0000N", "0531800.0000E"],
        ["244600.0000N", "0523759.9999E"],
        ["244600.0000N", "0522959.9999E"],
        ["244744.3023N", "0522002.9275E"],
        ["251037.0000N", "0523706.9999E"],
        ["252629.4279N", "0524901.1237E"],
      ];
      const limaCoords = [
        ["242716.7810N", "0535734.9107E"],
        ["243600.0000N", "0531800.0000E"],
        ["244600.0000N", "0523759.9999E"],
        ["244600.0000N", "0522959.9999E"],
        ["244744.3023N", "0522002.9275E"],
        ["240300.0000N", "0514659.9997E"],
        ["225600.0000N", "0523500.0000E"],
        ["223556.5997N", "0551544.6472E"],
        ["224200.0000N", "0551200.0000E"],
        ["234428.0000N", "0553023.0000E"],
        ["234730.0000N", "0552312.0000E"],
        ["240000.0000N", "0550000.0000E"],
        ["241035.8675N", "0544416.6401E"],
        ["241520.9775N", "0543711.8410E"],
        ["241930.0000N", "0543100.0000E"],
        ["241805.0000N", "0542246.0000E"],
        ["242300.0058N", "0541138.5536E"],
        ["242716.7810N", "0535734.9107E"],
      ];
      const bravoCoords = [
        ["244618.3182N", "0552117.0064E"],
        ["244334.4990N", "0551013.7592E"],
        ["243913.4400N", "0545229.7502E"],
        ["242300.0058N", "0541138.5536E"],
        ["241805.0000N", "0542246.0000E"],
        ["241930.0000N", "0543100.0000E"],
        ["241520.9775N", "0543711.8410E"],
        ["241035.8675N", "0544416.6401E"],
        ["240000.0000N", "0550000.0000E"],
        ["234730.0000N", "0552312.0000E"],
        ["234428.0000N", "0553023.0000E"],
        ["240000.0000N", "0553500.0000E"],
        ["242638.0000N", "0560135.0000E"],
        ["244618.3182N", "0552117.0064E"],
      ];
      const golfCoords = [
        ["251727.2300N", "0531010.5921E"],
        ["251028.0206N", "0532257.8798E"],
        ["244707.3259N", "0540157.3156E"],
        ["243848.6795N", "0542254.4400E"],
        ["242300.0058N", "0541138.5536E"],
        ["242716.7810N", "0535734.9107E"],
        ["243600.0000N", "0531800.0000E"],
        ["243820.9309N", "0530840.8314E"],
        ["245649.9309N", "0531415.2342E"],
        ["250230.4394N", "0530516.3033E"],
        ["251037.0000N", "0523706.9999E"],
        ["251727.2300N", "0531010.5921E"],
      ];
      const alphaCoords = [
        ["242638.0000N", "0560135.0000E"],
        ["240000.0000N", "0553500.0000E"],
        ["230227.0000N", "0551800.0000E"],
        ["230318.0000N", "0551327.0000E"],
        ["234730.0000N", "0552312.0000E"],
        ["240000.0000N", "0550000.0000E"],
        ["241035.8675N", "0544416.6401E"],
        ["241520.9775N", "0543711.8410E"],
        ["243913.4400N", "0545229.7502E"],
        ["244334.4990N", "0551013.7592E"],
        ["242638.0000N", "0560135.0000E"],
      ];
      const northCoords = [
        ["260400.0000N", "0535700.0000E"],
        ["254517.0000N", "0545647.0000E"],
        ["263406.0000N", "0541800.0000E"],
        ["264554.0000N", "0543610.0000E"],
        ["254331.0000N", "0552600.0000E"],
        ["253800.0000N", "0552000.0000E"],
        ["254135.8064N", "0550842.3936E"],
        ["252355.0000N", "0545522.0000E"],
        ["252814.0965N", "0543904.4502E"],
        ["254332.2605N", "0535708.1354E"],
        ["255450.0000N", "0532541.0000E"],
        ["260400.0000N", "0535700.0000E"],
      ];
      const mikeCoords = [
        ["254135.8064N", "0550842.3936E"],
        ["253800.0000N", "0552000.0000E"],
        ["262100.0000N", "0560600.0000E"],
        ["253600.0000N", "0561300.0000E"],
        ["252826.6958N", "0561738.3041E"],
        ["252808.0000N", "0563613.0000E"],
        ["250804.1040N", "0563547.0022E"],
        ["250810.0000N", "0563002.0000E"],
        ["250000.0000N", "0563500.0000E"],
        ["245608.0000N", "0563113.0000E"],
        ["244218.0000N", "0565415.0000E"],
        ["242218.0000N", "0563418.0000E"],
        ["243844.0000N", "0561342.0000E"],
        ["242638.0000N", "0560135.0000E"],
        ["250339.4072N", "0544513.1108E"],
        ["252355.0000N", "0545522.0000E"],
        ["254135.8064N", "0550842.3936E"],
      ];
      const westCoords = [
        ["255450.0000N", "0532541.0000E"],
        ["260400.0000N", "0535700.0000E"],
        ["254135.8064N", "0550842.3936E"],
        ["252355.0000N", "0545522.0000E"],
        ["252814.0965N", "0543904.4502E"],
        ["254332.2605N", "0535708.1354E"],
        ["255450.0000N", "0532541.0000E"],
      ];
      const centralCoords = [
        ["255450.0000N", "0532541.0000E"],
        ["254332.2605N", "0535708.1354E"],
        ["252814.0965N", "0543904.4502E"],
        ["252355.0000N", "0545522.0000E"],
        ["250339.4072N", "0544513.1108E"],
        ["245033.3087N", "0541052.3203E"],
        ["245234.9377N", "0540545.5866E"],
        ["245723.3151N", "0540231.4151E"],
        ["250412.9847N", "0535018.1858E"],
        ["245849.4608N", "0534229.3001E"],
        ["251028.0206N", "0532257.8798E"],
        ["251727.2300N", "0531010.5921E"],
        ["251037.0000N", "0523706.9999E"],
        ["252629.4279N", "0524901.1237E"],
        ["254900.0000N", "0530600.0000E"],
        ["255450.0000N", "0532541.0000E"],
      ];
      const deltaCoords = [
        ["254332.2605N", "0535708.1354E"],
        ["252814.0965N", "0543904.4502E"],
        ["252355.0000N", "0545522.0000E"],
        ["250548.0528N", "0544617.3882E"],
        ["250339.4072N", "0544513.1108E"],
        ["250118.4318N", "0543901.6006E"],
        ["243848.6795N", "0542254.4400E"],
        ["244707.3259N", "0540157.3156E"],
        ["251028.0206N", "0532257.8798E"],
        ["252535.0905N", "0533458.4084E"],
        ["254332.2605N", "0535708.1354E"],
      ];
      const hotelCoords = [
        ["254135.8064N", "0550842.3936E"],
        ["253800.0000N", "0552000.0000E"],
        ["251430.0000N", "0553449.0000E"],
        ["245614.2304N", "0552015.9927E"],
        ["244334.4990N", "0551013.7592E"],
        ["243913.4400N", "0545229.7502E"],
        ["241520.9775N", "0543711.8410E"],
        ["241930.0000N", "0543100.0000E"],
        ["241805.0000N", "0542246.0000E"],
        ["242300.0058N", "0541138.5536E"],
        ["243848.6795N", "0542254.4400E"],
        ["250118.4318N", "0543901.6006E"],
        ["250339.4072N", "0544513.1108E"],
        ["250548.0528N", "0544617.3882E"],
        ["252355.0000N", "0545522.0000E"],
        ["254135.8064N", "0550842.3936E"],
      ];
      const eastCoords = [
        ["243844.0000N", "0561342.0000E"],
        ["242638.0000N", "0560135.0000E"],
        ["244334.4990N", "0551013.7592E"],
        ["245614.2304N", "0552015.9927E"],
        ["251430.0000N", "0553449.0000E"],
        ["251050.5564N", "0560704.8139E"],
        ["250810.0511N", "0563001.9833E"],
        ["250000.0000N", "0563500.0000E"],
        ["245608.0000N", "0563113.0000E"],
        ["244218.0000N", "0565415.0000E"],
        ["242218.0000N", "0563418.0000E"],
        ["243844.0000N", "0561342.0000E"],
      ];
      const yankeeCoords = [
        ["250810.0000N", "0563002.0000E"],
        ["250006.2648N", "0563505.7475E"],
        ["245608.0000N", "0563113.0000E"],
        ["244913.4524N", "0564244.6367E"],
        ["243031.3688N", "0562400.6678E"],
        ["243844.0000N", "0561342.0000E"],
        ["244617.8166N", "0555938.9015E"],
        ["250141.0000N", "0555700.0000E"],
        ["250811.8360N", "0555918.3100E"],
        ["251050.5564N", "0560704.8139E"],
        ["251546.8257N", "0560815.8996E"],
        ["250810.0000N", "0563002.0000E"],
      ];
      const romeoCoords = [
        ["253800.0000N", "0552000.0000E"],
        ["262100.0000N", "0560600.0000E"],
        ["253600.0000N", "0561300.0000E"],
        ["252826.6958N", "0561738.3041E"],
        ["252808.0000N", "0563613.0000E"],
        ["250804.1040N", "0563547.0022E"],
        ["250810.0000N", "0563002.0000E"],
        ["251050.5564N", "0560704.8139E"],
        //["250811.8360N", "0555918.3100E"],
        ["251050.5564N", "0560704.8139E"],
        ["251430.0000N", "0553449.0000E"],
        ["253800.0000N", "0552000.0000E"],
      ];
      /*
      const kboxCoords = [
      ["251727.2300N", "0531010.5921E"],
      ["251037.0000N", "0523706.9999E"],
      ["252629.4279N", "0524901.1237E"],
      ];
      */

      const highSectors = ["S", "B", "L", "N", "M", "C"];
      const lowSectors = ["G", "A", "W", "D", "H", "E", "Y", "R"];

      const sectorMeta = {
        S: {
          coords: southCoords,
          color: "dodgerblue",
          label: ["245110.45N", "0525951.89E"],
        },
        L: {
          coords: limaCoords,
          color: "plum",
          label: ["235606.37N", "0534706.36E"],
        },
        B: {
          coords: bravoCoords,
          color: "gold",
          label: ["242709.99N", "0552646.12E"],
        },
        G: {
          coords: golfCoords,
          color: "yellow",
          label: ["245024.97N", "0533029.73E"],
        },
        A: {
          coords: alphaCoords,
          color: "#FF7F50",
          label: ["241634.49N", "0545751.99E"],
        },
        N: {
          coords: northCoords,
          color: "#6F83FC",
          label: ["260037.33N", "0540542.58E"],
        },
        M: {
          coords: mikeCoords,
          color: "#C8D66B",
          label: ["251447.71N", "0553434.53E"],
        },
        W: {
          coords: westCoords,
          color: "orange",
          label: ["254634.55N", "0542249.11E"],
        },
        C: {
          coords: centralCoords,
          color: "crimson",
          label: ["253248.09N", "0532640.51E"],
        },
        D: {
          coords: deltaCoords,
          color: "violet",
          label: ["251250.51N", "0541340.96E"],
        },
        H: {
          coords: hotelCoords,
          color: "#CADAE0",
          label: ["250340.15N", "0545612.33E"],
        },
        E: {
          coords: eastCoords,
          color: "cyan",
          label: ["245325.82N", "0554642.07E"],
        },
        Y: {
          coords: yankeeCoords,
          color: "khaki",
          label: ["245635.63N", "0561226.84E"],
        },
        R: {
          coords: romeoCoords,
          color: "#E478D7",
          label: ["253905.58N", "0555041.26E"],
        },
      };

      const rawSectorCoords = Object.fromEntries(
        Object.entries(sectorMeta).map(([code, v]) => [code, v.coords]),
      );

      const sectorColors = Object.fromEntries(
        Object.entries(sectorMeta).map(([code, v]) => [code, v.color]),
      );

      // New: preferred label positions (optional per sector)
      const sectorLabelCoords = Object.fromEntries(
        Object.entries(sectorMeta)
          .filter(([_, v]) => v.label)
          .map(([code, v]) => [code, v.label]),
      );
      // Convert all to decimal
      for (const [key, coordList] of Object.entries(rawSectorCoords)) {
        sectorPolygons[key] = coordList.map(([latDMS, lonDMS]) => [
          convertDMSToDecimal(latDMS),
          convertDMSToDecimal(lonDMS),
        ]);
      }

      const SidStar = {
        AA820: ["243127.2N", "0543121.3E"],
        AA824: ["244605.8N", "0543435.8E"],
        AA827: ["243315.8N", "0544907.3E"],
        AA834: ["242200.0N", "0545443.3E"],
        AA836: ["242407.5N", "0545441.5E"],
        AA839: ["241526.5N", "0545353.1E"],
        AA842: ["242419.6N", "0545020.0E"],
        AD814: ["241441.8N", "0544331.1E"],
        AD813: ["241321.4N", "0545204.0E"],
        EGSUP: ["242155.0N", "0542139.3E"],
        IMTUP: ["241922.3N", "0550345.3E"],
        ITKOV: ["241718.3N", "0545116.3E"],
        ITLIV: ["244505.3N", "0544921.7E"],
        ITREN: ["241222.8N", "0545810.1E"],
        KUVIN: ["243940.1N", "0542635.7E"],
        LONUP: ["243608.8N", "0544604.3E"],
        MURSU: ["244820.3N", "0544011.6E"],
        MUSUL: ["244047.8N", "0541503.0E"],
        OBMUK: ["244403.1N", "0542930.4E"],
        OBTOL: ["243621.9N", "0542424.4E"],
        PATAM: ["242947.6N", "0545531.7E"],
        PEGEB: ["241921.4N", "0545718.3E"],
        RABDU: ["242407.0N", "0543845.9E"],
        RUKOS: ["242324.7N", "0543018.8E"],
        UKPAP: ["243701.8N", "0545236.8E"],
        ULALA: ["242432.4N", "0545119.9E"],
        VEGIR: ["241148.3N", "0544636.4E"],
      };

      const sid12_13 = {
        DAXIB_AA_13: ["AA836", "PATAM", "UKPAP", "ITLIV", "MURSU", "DAXIB"],
        DAXIB_AD_13: [
          "AD814",
          "AD813",
          "VEGIR",
          "RUKOS",
          "EGSUP",
          "MUSUL",
          "DAXIB",
        ],
        BOSEV_AA_13: [
          "ULALA",
          "AA834",
          "ITKOV",
          "VEGIR",
          "RUKOS",
          "EGSUP",
          "MUSUL",
          "BOSEV",
        ],
        TULON_AA_13: ["AA836", "PATAM", "UKPAP", "ITLIV", "TULON"],
        KANIP_AA_13: ["ITKOV", "AA839", "ITREN", "KANIP"],
        ATUDO_AA_13: ["ITKOV", "AA839", "PEGEB", "AA842", "RABDU", "ATUDO"],
        KANIP_AA_31: [
          "AA820",
          "OBTOL",
          "KUVIN",
          "OBMUK",
          "AA824",
          "MURSU",
          "ITLIV",
          "LONUP",
          "AA827",
          "IMTUP",
          "KANIP",
        ],
      };

      const extraPoints = {
        ADV: ["242508.3N", "0544023.7E"],
        ALGUX: ["242247N", "0541209E"],
        ALKAN: ["255224N", "0521625E"],
        ALNEV: ["244601N", "0534122E"],
        ALPOB: ["254218N", "0530055E"],
        ALRAR: ["254058.2N", "0550149.4E"],
        ALSEM: ["252705N", "0524336E"],
        ALSIL: ["252911.1N", "0554639.4E"],
        AMBOV: ["253439N", "0543512E"],
        AMBOV: ["253439N", "0543512E"],
        ANVIX: ["244655.0N", "0555616.0E"],
        ASNAX: ["245659N", "0524054E"],
        ASNEK: ["255630.7N", "0554904.7E"],
        ASNIB: ["243982N", "0572109E"],
        ASPAK: ["262115.49N", "0522257E"],
        ASPED: ["240036N", "0553154E"],
        ASRAT: ["242114N", "0535944E"],
        ASTOG: ["252822N", "0525025E"],
        ATUDO: ["241708.0N", "0543432.0E"],
        BAH: ["261625N", "0503801E"],
        BND: ["271182N", "0562201E"],
        BONAN: ["260200.60N", "0515505.41E"],
        BOPEK: ["230098N", "0520012E"],
        BOPIT: ["235947N", "0540404E"],
        BOPOV: ["262429.69N", "0515043.17E"],
        BOSEV: ["245013.3N", "0540448.8E"],
        BOTAM: ["240245N", "0565333E"],
        BOXOT: ["251039N", "0531817E"],
        BUBAS: ["245964N", "0570004E"],
        BUNDU: ["250024N", "0522924E"],
        DANOK: ["234220N", "0533111E"],
        DANUX: ["223608N", "0541596E"],
        DAPER: ["254536N", "0545751E"],
        DAPOK: ["235994N", "0572999E"],
        DASLO: ["254562N", "0523048E"],
        DATOB: ["253053.0N", "0544656.9E"],
        DATUT: ["263354N", "0533563E"],
        DAVMO: ["255127.0N", "0553900.0E"],
        DAXIB: ["245446.5N", "0540901.1E"],
        DEGNU: ["242757N", "0570622E"],
        DEGSO: ["261060.39N", "0531960.17E"],
        DENSA: ["263197N", "0542933E"],
        DESVU: ["242222N", "0554253E"],
        DETGU: ["252623.9N", "0553604.6E"],
        DIXAM: ["254151N", "0543557E"],
        DOH: ["251500N", "0513658E"],
        DXB: ["251517N", "0552187E"],
        EGMIT: ["263367N", "0530842E"],
        EGPEP: ["255746.8N", "0555822.5E"],
        EGPOG: ["244727N", "0531950E"],
        EGROK: ["235289N", "0560144E"],
        EGROP: ["245211N", "0543625E"],
        EGTAG: ["250856N", "0545652E"],
        ELEPO: ["243211N", "0544410E"],
        ELIGA: ["242121N", "0530148E"],
        ELIRA: ["262109N", "0534504E"],
        ELOBI: ["250782N", "0521760E"],
        ELOVU: ["245721.3N", "0542017.5E"],
        ELUDA: ["235107N", "0552905E"],
        EMATA: ["242315N", "0565734E"],
        EMERU: ["244829.0N", "0550303.0E"],
        EMISA: ["254658.35N", "0514206.60E"],
        EMIXI: ["242105N", "0520019E"],
        EMOPI: ["252620.0N", "0560900.0E"],
        EMOTA: ["255254N", "0542414E"],
        ENANO: ["252360.2N", "0522560.38E"],
        ENEGA: ["250556N", "0560601E"],
        ESROM: ["232424N", "0525729E"],
        FJV: ["250602.6N", "0562116.4E"],
        GABKO: ["260404N", "0554755E"],
        GERAR: ["240601N", "0573628E"],
        GERUL: ["250001.4N", "0542644.4E"],
        GEVIV: ["244118N", "0545000E"],
        GEXAN: ["241295N", "0565681E"],
        GIBIB: ["255507N", "0541712E"],
        GIDIL: ["251770N", "0564939E"],
        GIDIS: ["243600.0N", "0555600.0E"],
        GIDOB: ["244445.3N", "0535952.6E"],
        GISMO: ["244743N", "0562236E"],
        GODKI: ["254122N", "0534347E"],
        GOGMI: ["230226N", "0553198E"],
        GOLGU: ["231051N", "0523109E"],
        GOLPA: ["242330.0N", "0535854.0E"],
        GOMTA: ["251115N", "0563447E"],
        GONVI: ["254239.8N", "0545630.5E"],
        IMGOV: ["221846N", "0533640E"],
        IMGUX: ["252950N", "0531428E"],
        IMKUD: ["241513N", "0535956E"],
        IMLIP: ["243648N", "0543549E"],
        IMLOT: ["251714N", "0570806E"],
        IMPED: ["245824.5N", "0560406.2E"],
        ITBON: ["251426N", "0555257E"],
        ITBUL: ["254910N", "0541227E"],
        ITKEV: ["250104N", "0534526E"],
        ITKUN: ["223751N", "0553956E"],
        ITLAP: ["254925N", "0555010E"],
        ITMUB: ["255932N", "0522404E"],
        ITOMI: ["250152N", "0541151E"],
        ITRAX: ["241248.0N", "0554749.0E"],
        IVOXI: ["251239.6N", "0552513.1E"],
        IVURO: ["251940N", "0560915E"],
        KANIP: ["241040.0N", "0552042.0E"],
        KAPAX: ["254229N", "0515131E"],
        KAPUM: ["245815N", "0533450E"],
        KATUS: ["251599N", "0574701E"],
        KATIT: ["224928N", "0522923E"],
        KAXOB: ["245423N", "0532450E"],
        KHM: ["264578N", "0555446E"],
        KIPOK: ["243611N", "0560719E"],
        KIROP: ["243000.00N", "0574700.00E"],
        KIS: ["263151N", "0535774E"],
        KIVUS: ["254522N", "0540032E"],
        KOBIM: ["233315N", "0562702E"],
        KUGTO: ["243231N", "0542224E"],
        KULBA: ["251326N", "0560153E"],
        KUMLA: ["262615N", "0520837E"],
        KUMSI: ["245050N", "0523619E"],
        KUMUN: ["254000N", "0551512E"],
        KUPMA: ["245148N", "0562648E"],
        KUPRO: ["250805N", "0523513E"],
        KUPSA: ["250475N", "0521186E"],
        KURTA: ["234209N", "0554901E"],
        KURTU: ["252211N", "0554625E"],
        KUSBA: ["251634N", "0532847E"],
        KUSEN: ["251828.0N", "0562340.0E"],
        KUTLI: ["245151.3N", "0545618.0E"],
        KUVDA: ["244309N", "0543909E"],
        LABOP: ["261912N", "520449E"],
        LABRI: ["240344.0N", "0553842.0E"],
        LABSA: ["230189N", "0555509E"],
        LAGTA: ["250602N", "0553315E"],
        LAKLU: ["232259N", "0570402E"],
        LALDO: ["251806N", "0563600E"],
        LEVNA: ["261901N", "0533320E"],
        LONUT: ["241520N", "0530149E"],
        LORID: ["245552.5N", "0543904.1E"],
        LOVEM: ["252645.4N", "0551440.4E"],
        LUBAT: ["250223N", "0561749E"],
        LUDAM: ["255508N", "0535859E"],
        LUDID: ["230227N", "0551800E"],
        LVA: ["264799N", "0532317E"],
        MCT: ["233547N", "0581561E"],
        MEDPO: ["222436N", "0520786E"],
        MEKNA: ["233315N", "0560825E"],
        MEKRI: ["243122.8N", "0535500.0E"],
        MEMTU: ["232517N", "0552443E"],
        MENSA: ["245750N", "0563249E"],
        MIBRU: ["250321N", "0524540E"],
        MIGMA: ["225058N", "0512782E"],
        MIROT: ["250608.8N", "0543048.8E"],
        MISEG: ["252134N", "0555205E"],
        MITIX: ["251746.4N", "0550729.7E"],
        MIVEK: ["245240N", "0561516E"],
        MOBET: ["264411N", "0560913E"],
        MOBUL: ["251559N", "0541841E"],
        MODOG: ["261007N", "0515935E"],
        MOGIM: ["244053N", "0542820E"],
        MURGU: ["243212.8N", "0560319.9E"],
        MUSAP: ["241754N", "0555245E"],
        MUSEN: ["241429N", "0543236E"],
        MUXIT: ["230229N", "0523024E"],
        NABIX: ["251241.1N", "0543147.3E"],
        NABUN: ["240301.8N", "0545021.3E"],
        NADNI: ["251915.2N", "0555658.9E"],
        NADSO: ["244996N", "0574944E"],
        NALNU: ["244737N", "0560925E"],
        NALPO: ["255602N", "0532945E"],
        NAPMA: ["241250N", "0550312E"],
        NOBTO: ["235525.0N", "0551840.0E"],
        NOLSU: ["251248.0N", "0560737.8E"],
        NORGA: ["250352N", "0555415E"],
        NOSMI: ["241795N", "0563003E"],
        OBNET: ["260032N", "0534514E"],
        OBREV: ["250200N", "0551135E"],
        OBVOM: ["241503N", "0515552E"],
        ODKUN: ["242608N", "0544017E"],
        OMDW: ["245372E", "0550951E"],
        OOSH: ["242300N", "0563731E"],
        ORBOL: ["245134N", "0542348E"],
        ORKOB: ["245309N", "0562421E"],
        ORLUP: ["260686N", "0523226E"],
        ORMID: ["253354N", "0525434E"],
        ORNEL: ["240311.7N", "0551942.1E"],
        ORPAX: ["242628.0N", "0534533.0E"],
        ORSAR: ["260430N", "0535730E"],
        ORSIS: ["252801N", "0521661E"],
        OTIKI: ["253229N", "0541441E"],
        OVONA: ["252443N", "0524739E"],
        OXARI: ["252535N", "0533458E"],
        PAPAR: ["264000N", "0542700E"],
        PASOV: ["243841N", "0565037E"],
        PATAT: ["261613N", "0560059E"],
        PAVAG: ["251546N", "0554042E"],
        PAXIM: ["240274N", "0561652E"],
        PEDOG: ["242225.4N", "0555333.7E"],
        PEDUL: ["244116N", "0560205E"],
        PEKEM: ["224648N", "0535942E"],
        PURLI: ["253644N", "0532436E"],
        PURDA: ["210808N", "0510349E"],
        PURNI: ["243806N", "0574390E"],
        PUSOT: ["253919N", "0542011E"],
        PUTIB: ["251900N", "0525755E"],
        PUTSO: ["232062N", "0565336E"],
        PUVAL: ["253558.0N", "0554258.0E"],
        PUXIL: ["244117N", "0563145E"],
        RABLA: ["261505.73N", "0514833.68E"],
        RADEB: ["261167N", "0554731E"],
        RAGDO: ["252212N", "0535106E"],
        RALMI: ["254505N", "0533033E"],
        RAPNO: ["241452N", "0541559E"],
        RESAR: ["253711N", "0522346E"],
        RETAS: ["235754.0N", "0553423.0E"],
        REVAV: ["250909N", "0541012E"],
        REXEV: ["251502.3N", "0560136.7E"],
        RIBOT: ["230844N", "0522428E"],
        RIDAP: ["252553.7N", "0543701.2E"],
        RIGIL: ["230146N", "0551430E"],
        RORON: ["252053N", "0530916E"],
        ROSAN: ["263129.13N", "0515220.05E"],
        ROTAG: ["255388N", "0523635E"],
        ROVOS: ["241825.0N", "0552143.0E"],
        RUDAT: ["244605.1N", "0561714.1E"],
        RUDUK: ["252408N", "0541650E"],
        RUGIS: ["245916N", "0530340E"],
        RUKOR: ["250823N", "0554603E"],
        RURAL: ["243045N", "0543156E"],
        SENPA: ["251959.6N", "0543210.5E"],
        SERDU: ["264725N", "0545764E"],
        SERSA: ["251945N", "0553118E"],
        SIGMO: ["240710N", "0545837E"],
        SIR: ["255451N", "0543211E"],
        SISOB: ["253150N", "0534509E"],
        SIXIV: ["242009N", "0550439E"],
        SODEX: ["234954N", "0553202E"],
        SOGAN: ["263915N", "0515408E"],
        SOKAK: ["255131N", "0534251E"],
        SOLUD: ["243223N", "0564421E"],
        SUTVO: ["251531N", "0562153E"],
        SUVDU: ["243501N", "0542410E"],
        TAGDU: ["252258N", "0532153E"],
        TANSU: ["224136N", "0542828E"],
        TAPRA: ["242607N", "0563803E"],
        TARBO: ["244385N", "0574664E"],
        TARDI: ["243418N", "0560915E"],
        TATLA: ["254753N", "0544008E"],
        TOMSO: ["260619N", "0530224E"],
        TONKI: ["242645.1N", "0544851.2E"],
        TONVO: ["250500.0N", "0563200.0E"],
        TOSNA: ["251612N", "0524116E"],
        TOTKU: ["253534N", "0540410E"],
        TOVIV: ["253302N", "0551942E"],
        TOVOX: ["245342N", "0522429E"],
        TUBGO: ["242403N", "0551219E"],
        TUDIS: ["251009N", "0550825E"],
        TUKSI: ["252006N", "0560525E"],
        TULON: ["245511.4N", "0544739.1E"],
        TULBU: ["230009N", "571846E"],
        TUMAK: ["255031N", "0531108E"],
        UKILI: ["243815.5N", "0535636.4E"],
        UKNAV: ["244307N", "0542955E"],
        UKNEP: ["262145N", "0524830E"],
        UKRAG: ["233056N", "0552306E"],
        UKUBU: ["261447N", "0524060.5E"],
        UKUVO: ["251228N", "0534707E"],
        UKVAK: ["245147N", "0553329E"],
        UKVUP: ["261967N", "0540892E"],
        ULIVA: ["252647N", "0540611E"],
        ULODA: ["243530N", "0545301E"],
        UMAMI: ["245113.7N", "0560223.3E"],
        UMEVU: ["250545N", "0530653E"],
        UMIBU: ["242331N", "0543027E"],
        VAVIM: ["241535.1N", "0553622.9E"],
        VATIG: ["243659.0N", "0533241.0E"],
        VAXAS: ["244308N", "0561807E"],
        VEDED: ["260558.26N", "0514627.91E"],
        VEDOM: ["260116N", "0524494E"],
        VEGEK: ["251837N", "0540803E"],
        VEKAL: ["250333.5N", "0550340.5E"],
        VEKOV: ["245750N", "0544925E"],
        VELAK: ["261307N", "0521821E"],
        VELAM: ["255426.12N", "0514347.13E"],
        VNKT: ["274777N", "0852162E"],
        VIDP: ["283412N", "0770673E"],
        VUTAN: ["255026N", "0515230E"],
        VUTEB: ["253644.6N", "0545149.4E"],
        VELOD: ["234618N", "0573458E"],
        VUXOD: ["242005N", "0543625E"],
      };

      const airwayLabel = {
        G666: [
          { coord: ["255049.86N", "0535942.60E"], rotate: 80, arrow: "right" },
          { coord: ["251439.23N", "0540857.34E"], rotate: 80, arrow: "right" },
        ],
        M677: [
          { coord: ["260701.11N", "0532946.29E"], rotate: 24, arrow: "right" },
          { coord: ["254518.45N", "0542510.78E"], rotate: 17, arrow: "right" },
          { coord: ["252310.64N", "0553931.13E"], rotate: 8, arrow: "right" },
          { coord: ["251818.27N", "0562903.22E"], rotate: 2, arrow: "both" },
        ],
        "M677-L223": [
          { coord: ["253214.05N", "0550205.59E"], rotate: 25, arrow: "right" },
        ],
        P559: [
          { coord: ["260213.23N", "0531326.78E"], rotate: 25, arrow: "right" },
          { coord: ["254234.12N", "0540944.15E"], rotate: 20, arrow: "right" },
          { coord: ["253542.62N", "0544346.84E"], rotate: -8, arrow: "right" },
        ],
        P307: [
          { coord: ["251751.08N", "0553546.50E"], rotate: 25, arrow: "right" },
          { coord: ["251502.69N", "0554719.24E"], rotate: 8, arrow: "right" },
          { coord: ["250850.86N", "0561958.91E"], rotate: 20, arrow: "right" },
        ],
        "P559-Q322": [
          { coord: ["253656.63N", "0542750.11E"], rotate: 19, arrow: "right" },
        ],
        R784: [
          { coord: ["255943.95N", "0540730.76E"], rotate: 28, arrow: "right" },
          { coord: ["253717.73N", "0551003.98E"], rotate: 25, arrow: "right" },
          { coord: ["253135.30N", "0553047.03E"], rotate: 10, arrow: "right" },
          { coord: ["252328.83N", "0561420.09E"], rotate: 30, arrow: "right" },
        ],
        L223: [
          { coord: ["254258.97N", "0544516.64E"], rotate: 48, arrow: "right" },
          { coord: ["252141.82N", "0551831.81E"], rotate: 55, arrow: "right" },
          { coord: ["245118.44N", "0555058.84E"], rotate: 43, arrow: "right" },
        ],
        N318: [
          { coord: ["253245.55N", "0523214.53E"], rotate: 30, arrow: "right" },
          { coord: ["251501.15N", "0530737.58E"], rotate: 25, arrow: "right" },
          //{coord: ["245407.01N", "0535013.08E"], rotate: 18, arrow: "right"},
          { coord: ["244417.79N", "0541944.22E"], rotate: 22, arrow: "right" },
          { coord: ["242451.66N", "0545637.96E"], rotate: 33, arrow: "right" },
          { coord: ["240759.92N", "0552731.15E"], rotate: 23, arrow: "right" },
        ],
        Q569: [
          { coord: ["252342.33N", "0550236.47E"], rotate: 57, arrow: "right" },
        ],
        Q321: [
          { coord: ["252839.47N", "0553030.16E"], rotate: 26, arrow: "right" },
        ],

        N685: [
          { coord: ["252637.41N", "0522008.74E"], rotate: 28, arrow: "right" },
          { coord: ["251115.34N", "0525317.61E"], rotate: 25, arrow: "right" },
          //{coord: ["250125.57N", "0532304.79E"], rotate: 17, arrow: "right"},
          { coord: ["245114.43N", "0534747.30E"], rotate: 31, arrow: "right" },
          { coord: ["241724.53N", "0545516.82E"], rotate: 32, arrow: "right" },
          { coord: ["235946.23N", "0552911.75E"], rotate: 24, arrow: "right" },
        ],
        Q415: [
          { coord: ["250048.07N", "0531440.62E"], rotate: 35, arrow: "right" },
          { coord: ["244241.41N", "0534754.15E"], rotate: 31, arrow: "right" },
          { coord: ["244712.00N", "0551433.13E"], rotate: -16, arrow: "right" },
          { coord: ["250030.02N", "0561119.06E"], rotate: -17, arrow: "right" },
        ],
        Z522: [
          { coord: ["245250.19N", "0533743.46E"], rotate: 64, arrow: "right" },
        ],
        N300: [
          { coord: ["250122.57N", "0525412.78E"], rotate: 15, arrow: "right" },
          { coord: ["244748.38N", "0541033.34E"], rotate: -18, arrow: "right" },
          { coord: ["250403.42N", "0552238.08E"], rotate: -11, arrow: "right" },
          { coord: ["251418.95N", "0561534.97E"], rotate: -11, arrow: "right" },
        ],
        B415: [
          { coord: ["245446.97N", "0524948.78E"], rotate: 16, arrow: "right" },
          { coord: ["242513.92N", "0544856.92E"], rotate: 19, arrow: "right" },
        ],
        Q666: [
          { coord: ["244635.95N", "0533228.29E"], rotate: 3, arrow: "right" },
        ],
        "B415-Q415": [
          { coord: ["243522.75N", "0540936.26E"], rotate: 13, arrow: "right" },
        ],
        T560: [
          { coord: ["235744.11N", "0552356.17E"], rotate: 57, arrow: "right" },
        ],
        Q572: [
          { coord: ["252314.09N", "0552302.55E"], rotate: 27, arrow: "right" },
        ],
        M428: [
          { coord: ["251711.03N", "0561648.09E"], rotate: 19, arrow: "right" },
        ],
        L305: [
          { coord: ["252533.84N", "0523454.50E"], rotate: -12, arrow: "right" },
          { coord: ["253907.26N", "0533429.08E"], rotate: -15, arrow: "right" },
        ],
        M318: [
          { coord: ["231811.38N", "0524524.52E"], rotate: -29, arrow: "both" },
          { coord: ["240812.55N", "0542026.18E"], rotate: -29, arrow: "both" },
          { coord: ["245006.97N", "0544404.46E"], rotate: -56, arrow: "right" },
          { coord: ["254313.08N", "0553022.91E"], rotate: -48, arrow: "right" },
        ],
        M550: [
          { coord: ["230717.01N", "0521936.16E"], rotate: -17, arrow: "both" },
        ],

        M628: [
          { coord: ["225547.24N", "0544436.12E"], rotate: -12, arrow: "both" },
        ],
        G783: [
          { coord: ["225345.13N", "0545613.27E"], rotate: -25, arrow: "both" },
          { coord: ["234154.36N", "0552621.06E"], rotate: -74, arrow: "both" },
          { coord: ["241024.56N", "0553449.53E"], rotate: -75, arrow: "both" },
          { coord: ["241921.97N", "0554000.52E"], rotate: -50, arrow: "left" },
        ],
        L710: [
          { coord: ["231823.79N", "0552706.40E"], rotate: 72, arrow: "right" },
        ],
        R401: [
          { coord: ["240517.57N", "0555126.25E"], rotate: -85, arrow: "right" },
          { coord: ["244122.86N", "0555607.61E"], rotate: -90, arrow: "both" },
          { coord: ["250013.30N", "0555440.00E"], rotate: -96, arrow: "right" },
          { coord: ["253904.10N", "0555052.94E"], rotate: -95, arrow: "right" },
        ],
        Q308: [
          { coord: ["240806.94N", "0553921.54E"], rotate: -46, arrow: "right" },
          { coord: ["242743.78N", "0555851.41E"], rotate: -46, arrow: "right" },
          { coord: ["244912.74N", "0562023.13E"], rotate: -46, arrow: "right" },
        ],
        Q568: [
          { coord: ["244243.47N", "0560831.06E"], rotate: -82, arrow: "right" },
        ],
        Q323: [
          { coord: ["251630.17N", "0552830.87E"], rotate: 2, arrow: "right" },
        ],
        Q312: [
          { coord: ["250439.59N", "0541820.28E"], rotate: 32, arrow: "right" },
        ],
        L519: [
          { coord: ["260721.69N", "0555943.76E"], rotate: -84, arrow: "left" },
          { coord: ["254153.98N", "0554608.50E"], rotate: -66, arrow: "left" },
          { coord: ["250654.65N", "0551135.95E"], rotate: -27, arrow: "left" },
          { coord: ["244734.71N", "0545344.79E"], rotate: -60, arrow: "left" },
        ],
        L313: [
          { coord: ["254721.29N", "0555912.22E"], rotate: 86, arrow: "right" },
        ],
        Q317: [
          { coord: ["243709.47N", "0543053.36E"], rotate: 81, arrow: "left" },
        ],
        Q311: [
          { coord: ["250749.35N", "0551901.71E"], rotate: -44, arrow: "left" },
          { coord: ["244029.84N", "0545749.66E"], rotate: -59, arrow: "left" },
          { coord: ["240826.79N", "0545000.86E"], rotate: 87, arrow: "right" },
        ],
        Q322: [
          { coord: ["254440.57N", "0541558.33E"], rotate: 55, arrow: "right" },
          { coord: ["252924.36N", "0545652.30E"], rotate: 9, arrow: "right" },
        ],
        Y552: [
          { coord: ["243536.54N", "0552107.75E"], rotate: -55, arrow: "right" },
          //{coord: ["252924.36N", "0545652.30E"], rotate: 09, arrow: "right"},
        ],
        M762: [
          { coord: ["243225.21N", "0563040.29E"], rotate: 44, arrow: "left" },
        ],
        B540: [
          { coord: ["244444.45N", "0563938.07E"], rotate: 34, arrow: "left" },
        ],
        T509: [
          { coord: ["245041.87N", "0563927.86E"], rotate: 50, arrow: "left" },
        ],
        N317: [
          { coord: ["250731.45N", "0561630.88E"], rotate: 35, arrow: "left" },
        ],
        T891: [
          { coord: ["245817.90N", "0562042.69E"], rotate: 57, arrow: "left" },
        ],
        M572: [
          { coord: ["251154.85N", "0562314.58E"], rotate: 2, arrow: "right" },
        ],
        P574: [
          { coord: ["243644.97N", "0563809.50E"], rotate: 40, arrow: "left" },
          { coord: ["252812.33N", "0552354.98E"], rotate: 52, arrow: "left" },
          { coord: ["250114.45N", "0555859.57E"], rotate: 34, arrow: "left" },
        ],
        M564: [
          { coord: ["243929.80N", "0564438.81E"], rotate: 8, arrow: "left" },
          { coord: ["244546.82N", "0561258.48E"], rotate: 31, arrow: "left" },
        ],
        P699: [
          { coord: ["251717.69N", "0554924.83E"], rotate: -13, arrow: "left" },
          { coord: ["251055.35N", "0544335.61E"], rotate: 10, arrow: "left" },
          { coord: ["253150.35N", "0530438.98E"], rotate: 10, arrow: "left" },
        ],
        M557: [
          { coord: ["252143.79N", "0545239.41E"], rotate: 16, arrow: "left" },
          { coord: ["254730.06N", "0532154.55E"], rotate: 16, arrow: "left" },
        ],
        N571: [
          { coord: ["250011.94N", "0562501.13E"], rotate: 19, arrow: "left" },
          { coord: ["251022.54N", "0553618.88E"], rotate: 12, arrow: "left" },
          //{coord: ["251117.25N", "0551602.77E"], rotate: -09, arrow: "left"},
          { coord: ["251454.19N", "0545055.64E"], rotate: 16, arrow: "left" },
          { coord: ["253933.01N", "0531236.69E"], rotate: 15, arrow: "left" },
        ],
        "N571-P699": [
          { coord: ["251117.25N", "0551602.77E"], rotate: -9, arrow: "left" },
        ],
        P899: [
          { coord: ["240940.09N", "0555719.43E"], rotate: 18, arrow: "left" },
          { coord: ["241901.22N", "0551543.93E"], rotate: 7, arrow: "left" },
          { coord: ["242532.91N", "0542117.38E"], rotate: 12, arrow: "left" },
          { coord: ["244819.73N", "0524629.01E"], rotate: 14, arrow: "left" },
        ],
        Q576: [
          { coord: ["250702.12N", "0543910.22E"], rotate: -6, arrow: "left" },
          { coord: ["251842.97N", "0531903.95E"], rotate: 12, arrow: "left" },
        ],
        G462: [
          { coord: ["242842.44N", "0550428.05E"], rotate: 34, arrow: "left" },
          { coord: ["251947.50N", "0534019.18E"], rotate: 51, arrow: "left" },
        ],
        N563: [
          { coord: ["234700.63N", "0553821.86E"], rotate: 25, arrow: "left" },
          { coord: ["241511.70N", "0544449.29E"], rotate: 35, arrow: "left" },
          { coord: ["245648.39N", "0535302.72E"], rotate: 31, arrow: "left" },
          { coord: ["253652.61N", "0530648.42E"], rotate: 45, arrow: "left" },
        ],
        Q565: [
          { coord: ["250135.96N", "0535546.01E"], rotate: 52, arrow: "left" },
        ],
        M430: [
          { coord: ["251743.19N", "0525018.15E"], rotate: -12, arrow: "left" },
        ],
        Q563: [
          { coord: ["245936.06N", "0540302.73E"], rotate: 44, arrow: "left" },
          { coord: ["251957.25N", "0533302.96E"], rotate: 31, arrow: "left" },
        ],
        P440: [
          { coord: ["242117.21N", "0533308.00E"], rotate: 0, arrow: "left" },
        ],
        P555: [
          { coord: ["241512.16N", "0531738.50E"], rotate: 0, arrow: "right" },
        ],
      };

      const airways = {
        A777: ["TONVO", "BUBAS", "NADSO"], //EXTERNAL
        "A791-": ["IMLOT", "GIDIL", "LALDO"], //EXTERNA
        A791: ["LALDO", "GIDIL", "IMLOT", "KATUS"],
        B415: [
          "DOH",
          "KUPSA",
          "BUNDU",
          "ASNAX",
          "EGPOG",
          "UKILI",
          "KUGTO",
          "RURAL",
          "SIXIV",
        ],
        B505: ["LALDO", "NADSO"], //EXTERNAL
        B540: ["GERAR", "DEGNU", "PASOV", "KUPMA", "ORKOB", "MIVEK"],
        B541: ["KIS", "ORSAR"], //EXTERNAL
        G462: [
          "ROVOS",
          "TUBGO",
          "ULODA",
          "KUVDA",
          "ORBOL",
          "UKUVO",
          "OXARI",
          "PURLI",
          "TUMAK",
        ],
        G666: [
          "LVA",
          "DATUT",
          "ELIRA",
          "ORSAR",
          "LUDAM",
          "KIVUS",
          "TOTKU",
          "ULIVA",
          "VEGEK",
          "REVAV",
          "ITOMI",
          "ELOVU",
        ],
        "G783-": [
          "GIDIS",
          "DESVU",
          "VAVIM",
          "ASPED",
          "ELUDA",
          "UKRAG",
          "RIGIL",
          "TANSU",
        ],
        G783: [
          "PURDA",
          "IMGOV",
          "DANUX",
          "TANSU",
          "RIGIL",
          "UKRAG",
          "ELUDA",
          "ASPED",
          "VAVIM",
          "GIDIS",
        ],
        L223: [
          "UKVUP",
          "SIR",
          "TATLA",
          "VUTEB",
          "LOVEM",
          "IVOXI",
          "LAGTA",
          "ANVIX",
          "PEDUL",
          "KIPOK",
          "TARDI",
          "NOSMI",
          "BOTAM",
        ],
        L305: [
          "DOH",
          "ENANO",
          "ALSEM",
          "ASTOG",
          "PURLI",
          "GODKI",
          "KIVUS",
          "ITBUL",
          "EMOTA",
        ],
        L313: ["EGPEP", "KULBA", "IMPED", "KIPOK"],
        L519: [
          "PATAT",
          "EGPEP",
          "ITLAP",
          "PUVAL",
          "DETGU",
          "SERSA",
          "IVOXI",
          "VEKAL",
          "KUTLI",
          "GEVIV",
          "ODKUN",
          "VUXOD",
          "ATUDO",
        ],
        L710: ["UKRAG", "MEMTU", "GOGMI", "ITKUN"],
        L768: ["ALPOB", "ROTAG", "ITMUB", "MODOG", "RABLA"],
        M317: ["RADEB", "SERDU"], //EXTERNAL
        "M318-": ["ATUDO", "MUSEN", "BOPIT", "DANOK", "ESROM", "GOLGU"],
        M318: [
          "PURDA",
          "MEDPO",
          "KATIT",
          "MUXIT",
          "GOLGU",
          "ESROM",
          "DANOK",
          "BOPIT",
          "MUSEN",
          "ATUDO",
          "RURAL",
          "IMLIP",
          "KUVDA",
          "TULON",
          "VEKOV",
          "EGTAG",
          "MITIX",
          "LOVEM",
          "TOVIV",
          "DAVMO",
          "GABKO",
          "RADEB",
          "KHM",
        ],
        M324: ["BND", "MOBET", "PATAT"], //EXTERNAL
        M428: ["IVURO", "SUTVO", "GOMTA", "TARBO"],
        M430: ["OXARI", "TAGDU", "RORON", "PUTIB", "TOSNA", "DOH"],
        M550: ["MIGMA", "BOPEK", "RIBOT", "GOLGU"],
        M557: [
          "IVOXI",
          "MITIX",
          "RIDAP",
          "OTIKI",
          "TOTKU",
          "GODKI",
          "RALMI",
          "TUMAK",
        ],
        M564: ["PASOV", "PUXIL", "VAXAS", "NALNU", "UMAMI"],
        M572: ["NOLSU", "GOMTA"],
        M628: ["MIGMA", "KATIT", "PEKEM", "RIGIL"],
        "M628-": ["LABSA", "GOGMI", "LUDID", "RIGIL", "PEKEM", "KATIT"],
        "M677-": ["LALDO", "KUSEN", "IVURO", "TUKSI"],
        M677: [
          "SOGAN",
          "UKNEP",
          "DEGSO",
          "OBNET",
          "LUDAM",
          "ITBUL",
          "DIXAM",
          "VUTEB",
          "LOVEM",
          "KURTU",
          "MISEG",
          "TUKSI",
          "IVURO",
          "KUSEN",
          "LALDO",
        ],
        M762: ["VELOD", "GEXAN", "TAPRA", "VAXAS", "RUDAT", "MIVEK"],
        N300: [
          "DOH",
          "KUPRO",
          "MIBRU",
          "RUGIS",
          "KAXOB",
          "GIDOB",
          "ORBOL",
          "LORID",
          "VEKOV",
          "OBREV",
          "LAGTA",
          "RUKOR",
          "NOLSU",
          "SUTVO",
          "LALDO",
        ],
        "N300-": ["RUKOR", "LAGTA", "OBREV"],
        N317: ["MENSA", "NOLSU", "REXEV", "NADNI"],
        N318: [
          "VELAM",
          "VUTAN",
          "RESAR",
          "OVONA",
          "PUTIB",
          "BOXOT",
          "KAPUM",
          "BOSEV",
          "MOGIM",
          "IMLIP",
          "ELEPO",
          "SIXIV",
          "KANIP",
          "LABRI",
          "EGROK",
          "LAKLU",
        ],
        N563: [
          "TULBU",
          "MEKNA",
          "KURTA",
          "SODEX",
          "ELUDA",
          "NOBTO",
          "SIGMO",
          "VUXOD",
          "UMIBU",
          "KUGTO",
          "BOSEV",
          "ITKEV",
          "KUSBA",
          "TAGDU",
          "IMGUX",
          "ALPOB",
        ],
        N571: [
          "KIROP",
          "ASNIB",
          "MENSA",
          "LUBAT",
          "ENEGA",
          "RUKOR",
          "IVOXI",
          "TUDIS",
          "SENPA",
          "RUDUK",
          "ULIVA",
          "SISOB",
          "PURLI",
          "ALPOB",
        ],
        N685: [
          "EMISA",
          "KAPAX",
          "ORSIS",
          "ENANO",
          "TOSNA",
          "UMEVU",
          "KAPUM",
          "GIDOB",
          "SUVDU",
          "RURAL",
          "ODKUN",
          "NAPMA",
          "ORNEL",
          "RETAS",
          "KOBIM",
          "PUTSO",
        ],
        P307: ["SERSA", "PAVAG", "ITBON", "KULBA", "NOLSU", "TONVO", "PURNI"],
        P440: ["ALGUX", "ASRAT", "ELIGA", "EMIXI"],
        P555: ["OBVOM", "LONUT", "IMKUD", "RAPNO", "ATUDO"],
        P559: [
          "ROSAN",
          "KUMLA",
          "ASPAK",
          "UKUBU",
          "TOMSO",
          "NALPO",
          "SOKAK",
          "KIVUS",
          "PUSOT",
          "AMBOV",
          "VUTEB",
        ],
        P574: [
          "DAPOK",
          "EMATA",
          "SOLUD",
          "PUXIL",
          "GISMO",
          "MIVEK",
          "IMPED",
          "NORGA",
          "RUKOR",
          "SERSA",
          "TOVIV",
          "KUMUN",
        ],
        "P574-": ["DAPER", "DENSA"],
        P699: [
          "TUKSI",
          "PAVAG",
          "IVOXI",
          "TUDIS",
          "EGTAG",
          "NABIX",
          "MOBUL",
          "VEGEK",
          "RAGDO",
          "OXARI",
          "IMGUX",
          "ORMID",
          "DASLO",
          "ALKAN",
          "BONAN",
          "VEDED",
        ],
        P899: [
          "VELOD",
          "PAXIM",
          "ITRAX",
          "VAVIM",
          "ROVOS",
          "SIXIV",
          "UMIBU",
          "MEKRI",
          "KUMSI",
          "TOVOX",
          "KUPSA",
        ],
        Q308: ["ASPED", "PEDOG", "MURGU", "KIPOK", "RUDAT", "ORKOB"],
        Q311: ["IVOXI", "OBREV", "EMERU", "TONKI", "NABUN"],
        Q312: ["REVAV", "GERUL"],
        Q317: ["RURAL", "UKNAV", "EGROP", "LORID"],
        Q321: ["TOVIV", "DETGU", "KURTU", "NOLSU"],
        Q322: ["AMBOV", "DATOB", "LOVEM"],
        Q322: ["ITBUL", "PUSOT", "AMBOV", "DATOB", "LOVEM"],
        Q323: ["MITIX", "PAVAG"],
        Q415: [
          "UMEVU",
          "KAXOB",
          "ALNEV",
          "UKILI",
          "KUGTO",
          "IMLIP",
          "GEVIV",
          "UKVAK",
          "IMPED",
          "LUBAT",
          "TONVO",
        ],
        Q563: ["DAXIB", "UKUVO", "IMGUX"],
        Q565: ["BOSEV", "UKUVO"],
        Q568: ["KIPOK", "NALNU", "IMPED"],
        Q569: ["VUTEB", "MITIX", "OBREV"],
        Q572: ["ALRAR", "LOVEM", "SERSA"],
        Q576: ["EGTAG", "MIROT", "REVAV", "UKUVO", "KUSBA", "RORON"],
        Q666: ["EGPOG", "ALNEV", "GIDOB"],
        R401: [
          "LABSA",
          "KURTA",
          "MUSAP",
          "PEDOG",
          "GIDIS",
          "ANVIX",
          "NORGA",
          "ITBON",
          "MISEG",
          "ITLAP",
          "ASNEK",
          "GABKO",
        ],
        R784: [
          "EGMIT",
          "LEVNA",
          "ORSAR",
          "GIBIB",
          "EMOTA",
          "TATLA",
          "GONVI",
          "ALRAR",
          "TOVIV",
          "ALSIL",
          "EMOPI",
          "KUSEN",
        ],
        T509: ["PASOV", "MENSA", "FJV"],
        T560: ["ORNEL", "ELUDA"],
        T602: ["TUMAK", "VEDOME", "ORLUP", "VELAK", "LABOP", "BOPOV"],
        T891: ["ORKOB", "LUBAT", "NOLSU"],
        Y552: ["NABUN", "SIGMO", "NAPMA", "TUBGO", "UKVAK", "RUKOR"],
        Z522: ["KAPUM", "ALNEV"],
        //"B547": ["KIS", "SIR"], //EXTERNAL
      };

      const routeSectors = {
        "BUNDU-LABRI": ["S", "B"],
        "BUNDU-RETAS": ["S", "B"],
        "BUNDU-TONVO": ["S", "M"],
        "ITRAX-ALPOB": ["B", "S", "C"],
        "ITRAX-ALPOB": ["B", "S", "C"],
        "ITRAX-ORMID*": ["B", "S", "C"],
        "ITRAX-ORMID": ["B", "S", "C"],
        "ITRAX-TOVOX": ["B", "S", "C"],
        "ITRAX-TUMAK": ["B", "S", "C"],
        "ITRAX-TUMAK*": ["B", "S", "C"],
        "KUPRO-GABKO": ["S", "M"],
        "KUPRO-LALDO*": ["S", "G", "D", "H", "R"],
        "KUPRO-LALDO": ["S", "M"],
        "KUPRO-TONVO": ["S", "M"],
        "LALDO-ALPOB": ["M", "C"],
        "LALDO-ORMID": ["M", "C"],
        "LALDO-TOSNA": ["M", "C"],
        "LALDO-TUMAK": ["M", "C"],
        "LUDID-PEKEM": ["L"],
        "LUDID-TANSU": ["L"],
        "MENSA-ALPOB": ["M", "C"],
        "MENSA-KUMUN": ["M"],
        "MENSA-ORMID": ["M", "C"],
        "MENSA-TOSNA": ["M", "C"],
        "MENSA-TUMAK": ["M", "C"],
        "MUSAP-KUMUN": ["M"],
        "NALPO-GABKO": ["N", "M"],
        "NALPO-LALDO": ["N", "M"],
        "NALPO-TARDI": ["N", "M"],
        "NALPO-TONVO": ["N", "M"],
        "OBNET-GABKO": ["N", "M"],
        "OBNET-LALDO": ["N", "M"],
        "OBNET-TARDI": ["N", "M"],
        "OBNET-TONVO": ["N", "M"],
        "ORSAR-LALDO": ["N", "M"],
        "ORSAR-TARDI": ["N", "M"],
        "ORSAR-TONVO": ["N", "M"],
        "OVONA-LABRI": ["S", "B"],
        "OVONA-RETAS": ["S", "B"],
        "PATAT-ALPOB": ["M", "C"],
        "PATAT-ORMID": ["M", "C"],
        "PATAT-TARDI": ["M"],
        "PATAT-TOSNA": ["M", "C"],
        "PATAT-TUMAK": ["M", "C"],
        "PEKEM-GABKO": ["L", "B", "M"],
        "SIR-LALDO": ["N", "M"],
        "SIR-TARDI": ["N", "M"],
        "SIR-TONVO": ["N", "M"],
        "SODEX-ALPOB": ["B", "S", "C"],
        "SODEX-ORMID": ["B", "S", "C"],
        "SODEX-TOVOX": ["B", "S"],
        "SODEX-TUMAK": ["B", "S", "C"],
        "SOLUD-ALPOB": ["M", "C"],
        "SOLUD-GABKO": ["M"],
        "SOLUD-KUMUN": ["M"],
        "SOLUD-ORMID": ["M", "C"],
        "SOLUD-TUMAK": ["M", "C"],
        "TANSU-GABKO": ["L", "B", "M"],
        "TOSNA-LABRI": ["S", "B"],
        "TOSNA-RETAS": ["S", "B"],
        "OMAA,AD-ALPOB": ["D", "C"],
        "OMAA,AD-GABKO": ["H", "M"],
        "OMAA,AD-KATIT": ["H", "L"],
        "OMAA,AD-KUMUN": ["H", "M"],
        "OMAA,AD-LABRI": ["A"],
        "OMAA,AD-ORMID": ["D", "C"],
        "OMAA,AD-ORSAR": ["D", "W"],
        "OMAA,AD-PEKEM": ["A", "L"],
        "OMAA,AD-RETAS": ["A"],
        "OMAA,AD-RIBOT": ["L"],
        "OMAA,AD-TANSU": ["A", "L"],
        "OMAA,AD-TOVOX": ["G", "S"],
        "OMAA,AD-TUMAK": ["D", "C"],
        "OMAL-ALPOB": ["H", "D", "C"],
        "OMAL-GABKO": ["H", "M"],
        "OMAL-KATIT": ["L"],
        "OMAL-KUMUN": ["H", "M"],
        "OMAL-ORMID": ["H", "D", "C"],
        "OMAL-PEKEM": ["A", "L"],
        "OMAL-RIBOT": ["L"],
        "OMAL-TANSU": ["A", "L"],
        "OMAL-TOVOX": ["H", "G", "S"],
        "OMAL-TUMAK": ["H", "D", "C"],
        "OMDB,DW,SJ-ALPOB": ["D", "C"],
        "OMDB,SJ-GABKO": ["R"],
        "OMDB,DW,SJ-KATIT": ["H", "L"],
        //"OMDB,DW,SJ-KUMUN": [""],
        "OMDB,DW,SJ-MEMTU": ["E", "A", "L"],
        "OMDB,DW,SJ-ORMID": ["D", "C"],
        "OMDB,DW,SJ-ORSAR": ["D", "W"],
        "OMDB,DW,SJ-PEKEM": ["E", "A", "L"],
        "OMDB,DW,SJ-RIBOT": ["H", "L"],
        "OMDB,DW,SJ-TANSU": ["E", "A", "L"],
        "OMDB,DW,SJ-TARDI": ["E"],
        "OMDB,DW,SJ-TOSNA*": ["D", "C"],
        "OMDB,DW,SJ-TOSNA": ["D", "C"],
        "OMDB,DW,SJ-TUMAK": ["D", "C"],
        "OMDB,SJ-GOMTA": ["R"],
        "OMDB,SJ-LALDO": ["R"],
        "OMDW-GABKO": ["H", "R"],
        "OMDW-GOMTA": ["R"],
        "OMDW-LALDO": ["R"],
        "OMFJ-ALPOB": ["R", "H", "D", "C"],
        "OMFJ-GABKO": ["R"],
        "OMFJ-KATIT": ["H", "L"],
        "OMFJ-ORMID": ["R", "H", "D", "C"],
        "OMFJ-PEKEM": ["E", "A", "L"],
        "OMFJ-RIBOT": ["H", "L"],
        "OMFJ-TANSU": ["E", "A", "L"],
        "OMFJ-TONVO": ["R"],
        "OMFJ-TOSNA": ["R", "H", "D", "C"],
        "OMFJ-TUMAK": ["H", "D", "C"],
        "OMRK-ALPOB": ["R", "H", "D", "C"],
        "OMRK-GABKO": ["R"],
        "OMRK-GOMTA": ["R"],
        "OMRK-KATIT": ["H", "L"],
        "OMRK-LALDO": ["R"],
        "OMRK-MEMTU": ["E", "A", "L"],
        "OMRK-ORMID": ["H", "D", "C"],
        "OMRK-PEKEM": ["H", "L"],
        "OMRK-RIBOT": ["H", "L"],
        "OMRK-TANSU": ["E", "A", "L"],
        "OMRK-TARDI": ["E"],
        "OMRK-TOSNA": ["H", "D", "C"],
        "OMRK-TUMAK": ["H", "D", "C"],
        "ASTOG-OMDB": ["C", "W"],
        "ASTOG-OMDW": ["C", "W"],
        "ASTOG-OMFJ": ["C", "W"],
        "ASTOG-OMRK": ["C", "W"],
        "ASTOG-OMSJ": ["C", "W"],
        "BUNDU-OMAA": ["S", "G"],
        "BUNDU-OMAD": ["S", "G"],
        "BUNDU-OMAL": ["S", "G"],
        "ITRAX-OMAA,AD": ["A"],
        "ITRAX-OMAL": ["A"],
        "KATIT-OMAA,AD": ["L"],
        "KATIT-OMAL": ["L"],
        "KATIT-OMDB": ["L", "H"],
        "KATIT-OMDW": ["L"],
        "KATIT-OMRK": ["L", "H"],
        "KATIT-OMSJ": ["L", "H"],
        "KUPRO-OMAA": ["S", "G"],
        "KUPRO-OMAD": ["S", "G"],
        "KUPRO-OMAL": ["S", "G"],
        "MENSA-OMFJ": ["E", "Y"],
        "MENSA-OMRK": ["E", "Y"],
        "MENSA-OMSJ": ["E", "Y"],
        "MUSAP-OMDB": ["E", "Y"],
        "MUSAP-OMDW": ["E", "Y"],
        "MUSAP-OMFJ": ["E", "Y"],
        "MUSAP-OMRK": ["E", "Y"],
        "MUSAP-OMSJ": ["E", "Y"],
        "NALPO-OMDB": ["N", "W"],
        "NALPO-OMDW": ["N", "W"],
        "NALPO-OMDW*": ["N", "D"],
        "NALPO-OMFJ": ["N", "H", "R"],
        "NALPO-OMRK": ["N", "W"],
        "NALPO-OMSJ": ["N", "W"],
        "OBNET-OMDB": ["N", "W"],
        "OBNET-OMDW": ["N", "W"],
        "OBNET-OMDW*": ["N", "D"],
        "OBNET-OMFJ": ["N", "H", "R"],
        "OBNET-OMRK": ["N", "W"],
        "OBNET-OMSJ": ["N", "W"],
        "ORSAR-OMAA": ["N", "D"],
        "ORSAR-OMAA,AD*": ["N", "D"],
        "ORSAR-OMAA,AD": ["N", "H"],
        "ORSAR-OMAD": ["N", "D"],
        "ORSAR-OMAL": ["N", "H"],
        "ORSAR-OMDB": ["N", "W"],
        "ORSAR-OMDW*": ["N", "D"],
        "ORSAR-OMDW": ["N", "W"],
        "ORSAR-OMFJ": ["N", "H", "R"],
        "ORSAR-OMRK": ["N", "W"],
        "ORSAR-OMSJ": ["N", "W"],
        "OVONA-OMAA": ["S", "G"],
        "OVONA-OMAD": ["S", "G"],
        "OVONA-OMAL": ["S", "G", "H"],
        "PASOV-OMDB": ["E", "Y"],
        "PASOV-OMDW": ["E", "Y"],
        "PASOV-OMRK": ["E", "Y"],
        "PASOV-OMSJ": ["E", "Y"],
        "PATAT-OMAA,AD": ["M", "H"],
        "PATAT-OMAL": ["M", "H"],
        "PATAT-OMDB,SJ,DW": ["R"],
        "PATAT-OMFJ": ["R"],
        "PATAT-OMRK": ["R"],
        "PEKEM-OMAA,AD": ["L", "A"],
        "PEKEM-OMAL": ["L", "A"],
        "PEKEM-OMDB": ["L", "A", "E", "Y"],
        "PEKEM-OMDW": ["L", "A", "E", "Y"],
        "PEKEM-OMFJ": ["L", "A", "E", "Y"],
        "PEKEM-OMRK": ["L", "A", "E", "Y"],
        "PEKEM-OMSJ": ["L", "A", "E", "Y"],
        "RIBOT-OMAA,AD": ["L"],
        "RIBOT-OMAL": ["L"],
        "RIBOT-OMDB,SJ": ["L", "H"],
        "RIBOT-OMDW": ["L"],
        "RIBOT-OMRK": ["L", "H"],
        "SODEX-OMAA,AD": ["A"],
        "SODEX-OMAL": ["A"],
        "SOLUD-OMDB": ["E", "Y"],
        "TANSU-OMAA,AD": ["L", "A"],
        "TANSU-OMAL": ["L", "A"],
        "TANSU-OMDB": ["L", "A", "E", "Y"],
        "TANSU-OMDW": ["L", "A", "E"],
        "TANSU-OMFJ": ["L", "A", "E", "Y"],
        "TANSU-OMRK": ["L", "A", "E", "Y"],
        "TANSU-OMSJ": ["L", "A", "E", "Y"],
        "TAPRA-OMDB": ["E", "Y"],
        "TAPRA-OMDW": ["E", "Y"],
        "TOSNA-OMAA": ["S", "G"],
        "TOSNA-OMAD": ["S", "G"],
        "TOSNA-OMAL": ["S", "G", "H"],
        "VAXAS-OMDB": ["E", "Y"],
        "VAXAS-OMDW": ["E", "Y"],
        "VAXAS-OMRK": ["E", "Y"],
        "VAXAS-OMSJ": ["E", "Y"],
        "BUNDU-LABRI-FRA": ["S", "B"],
        "BUNDU-LABRI*-FRA": ["S", "B"],
        "BUNDU-OMAA-FRA": ["S", "G"],
        "BUNDU-OMAD-FRA": ["S", "G"],
        "BUNDU-OMAL-FRA": ["S", "G"],
        "BUNDU-RETAS-FRA": ["S", "B"],
        "BUNDU-TONVO-FRA": ["S", "M"],
        "BUNDU-TONVO*-FRA": ["S", "M"],
        "GISMO-ALPOB-FRA": ["M", "C"],
        "GISMO-GABKO-FRA": ["M"],
        "GISMO-KUMUN-FRA": ["M"],
        "GISMO-ORMID-FRA": ["M", "C"],
        "GISMO-TUMAK-FRA": ["M", "C"],
        "ITRAX-ALPOB-FRA": ["B", "S", "C"],
        "ITRAX-ORMID-FRA": ["B", "S", "C"],
        "ITRAX-TOVOX*-FRA": ["B", "S"],
        "ITRAX-TOVOX-FRA": ["B", "S"],
        "ITRAX-TUMAK-FRA": ["B", "S", "C"],
        "KUPRO-LALDO*-FRA": ["S", "M"],
        "KUPRO-LALDO-FRA": ["S", "M"],
        "KUPRO-TONVO-FRA": ["S", "M"],
        "KUPRO-TONVO*-FRA": ["S", "M"],
        "LALDO-ALPOB-FRA": ["M", "C"],
        "LALDO-ORMID-FRA": ["M", "C"],
        "LALDO-TOSNA-FRA": ["M", "C"],
        "LALDO-TUMAK-FRA": ["M", "C"],
        "MENSA-ALPOB-FRA": ["M", "C"],
        "MENSA-ORMID-FRA": ["M", "C"],
        "MENSA-TOSNA-FRA": ["M", "C"],
        "MENSA-TUMAK-FRA": ["M", "C"],
        "NALPO-LALDO-FRA": ["N", "M"],
        "NALPO-TARDI-FRA": ["N", "M"],
        "NALPO-TARDI*-FRA": ["N", "M"],
        "NALPO-TONVO-FRA": ["N", "M"],
        "OBNET-LALDO-FRA": ["N", "M"],
        "OBNET-TARDI-FRA": ["N", "M"],
        "OBNET-TARDI*-FRA": ["N", "M"],
        "OBNET-TONVO-FRA": ["N", "M"],
        "ORSAR-LALDO-FRA": ["M"],
        "ORSAR-TARDI-FRA": ["M"],
        "ORSAR-TARDI*-FRA": ["M"],
        "ORSAR-TONVO-FRA": ["M"],
        "OVONA-LABRI-FRA": ["S", "B"],
        "OVONA-RETAS-FRA": ["S", "B"],
        "PATAT-ALPOB-FRA": ["M", "C"],
        "PATAT-OMAA ,AD-FRA": ["M", "H"],
        "PATAT-OMAL-FRA": ["M", "H"],
        "PATAT-ORMID-FRA": ["M", "C"],
        "PATAT-TARDI-FRA": ["M"],
        "PATAT-TARDI*-FRA": ["M"],
        "PATAT-TOSNA-FRA": ["M", "C"],
        "PATAT-TUMAK-FRA": ["M", "C"],
        "SIR-LALDO-FRA": ["N", "M"],
        "SIR-TARDI-FRA": ["N", "M"],
        "SIR-TARDI*-FRA": ["N", "M"],
        "SIR-TONVO-FRA": ["N", "M"],
        "SODEX-ALPOB-FRA": ["B", "S", "C"],
        "SODEX-ORMID-FRA": ["B", "S", "C"],
        "SODEX-TOVOX-FRA": ["B", "S"],
        "SODEX-TOVOX*-FRA": ["B", "S"],
        "SODEX-TUMAK-FRA": ["B", "S", "C"],
        "TOSNA-LABRI-FRA": ["S", "B"],
        "TOSNA-RETAS-FRA": ["S", "B"],
      };

      //----------
      const routes = {
        //1.9.3. The following standard routings apply for traffic transiting the FIR below FL 355:
        "BUNDU-LABRI": ["BUNDU", "B415", "SIXIV", "N318", "LABRI"],
        "BUNDU-RETAS": ["BUNDU", "B415", "RURAL", "N685", "RETAS"],
        "BUNDU-TONVO": ["BUNDU", "B415", "KUGTO", "Q415", "TONVO"],
        "ITRAX-ALPOB": ["ITRAX", "P899", "UMIBU", "N563", "ALPOB"],
        "ITRAX-ALPOB": [
          "ITRAX",
          "P899",
          "ROVOS",
          "G462",
          "UKUVO",
          "Q563",
          "IMGUX",
          "N563",
          "ALPOB",
        ],
        "ITRAX-ORMID*": [
          "ITRAX",
          "P899",
          "UMIBU",
          "N563",
          "IMGUX",
          "P699",
          "ORMID",
        ],
        "ITRAX-ORMID": [
          "ITRAX",
          "P899",
          "ROVOS",
          "G462",
          "UKUVO",
          "Q563",
          "IMGUX",
          "P699",
          "ORMID",
        ],
        "ITRAX-TOVOX": ["ITRAX", "P899", "TOVOX"],
        "ITRAX-TUMAK": ["ITRAX", "P899", "ROVOS", "G462", "TUMAK"],
        "ITRAX-TUMAK*": [
          "ITRAX",
          "P899",
          "UMIBU",
          "N563",
          "BOSEV",
          "Q565",
          "UKUVO",
          "G462",
          "TUMAK",
        ],
        "KUPRO-GABKO": ["KUPRO", "N300", "VEKOV", "M318", "GABKO"],
        "KUPRO-LALDO*": [
          "KUPRO",
          "N300",
          "VEKOV",
          "M318",
          "MITIX",
          "Q323",
          "PAVAG",
          "P307",
          "NOLSU",
          "N300",
          "LALDO",
        ],
        "KUPRO-LALDO": ["KUPRO", "N300", "LALDO"],
        "KUPRO-TONVO": ["KUPRO", "N300", "NOLSU", "P307", "TONVO"],
        "LALDO-ALPOB": [
          "LALDO",
          "M677",
          "TUKSI",
          "P699",
          "IVOXI",
          "N571",
          "ALPOB",
        ],
        "LALDO-ORMID": ["LALDO", "M677", "TUKSI", "P699", "ORMID"],
        "LALDO-TOSNA": [
          "LALDO",
          "M677",
          "TUKSI",
          "P699",
          "EGTAG",
          "Q576",
          "RORON",
          "M430",
          "TOSNA",
        ],
        "LALDO-TUMAK": [
          "LALDO",
          "M677",
          "TUKSI",
          "P699",
          "IVOXI",
          "M557",
          "TUMAK",
        ],
        "LUDID-PEKEM": ["LUDID", "M628-", "PEKEM"],
        "LUDID-TANSU": ["LUDID", "M628-", "RIGIL", "G783", "TANSU"],
        "MENSA-ALPOB": ["MENSA", "N571", "ALPOB"],
        "MENSA-KUMUN": ["MENSA", "N571", "RUKOR", "P574", "KUMUN"],
        "MENSA-ORMID": ["MENSA", "N571", "IVOXI", "P699", "ORMID"],
        "MENSA-TOSNA": [
          "MENSA",
          "N571",
          "IVOXI",
          "P699",
          "EGTAG",
          "Q576",
          "RORON",
          "M430",
          "TOSNA",
        ],
        "MENSA-TUMAK": ["MENSA", "N571", "IVOXI", "M557", "TUMAK"],
        "MUSAP-KUMUN": ["MUSAP", "R401", "NORGA", "P574", "KUMUN"],
        "NALPO-GABKO": [
          "NALPO",
          "P559",
          "AMBOV",
          "Q322",
          "LOVEM",
          "M318",
          "GABKO",
        ],
        "NALPO-LALDO": [
          "NALPO",
          "P559",
          "AMBOV",
          "Q322",
          "LOVEM",
          "M677",
          "LALDO",
        ],
        "NALPO-TARDI": [
          "NALPO",
          "P559",
          "AMBOV",
          "Q322",
          "LOVEM",
          "L223",
          "TARDI",
        ],
        "NALPO-TONVO": [
          "NALPO",
          "P559",
          "AMBOV",
          "Q322",
          "LOVEM",
          "Q572",
          "SERSA",
          "P307",
          "TONVO",
        ],
        "OBNET-GABKO": ["DEGSO", "M677", "LOVEM", "M318", "GABKO"],
        "OBNET-LALDO": ["DEGSO", "M677", "LALDO"],
        "OBNET-TARDI": ["DEGSO", "M677", "LOVEM", "L223", "TARDI"],
        "OBNET-TONVO": [
          "DEGSO",
          "M677",
          "LOVEM",
          "Q572",
          "SERSA",
          "P307",
          "TONVO",
        ],
        "ORSAR-LALDO": ["ORSAR", "R784", "KUSEN", "M677", "LALDO"],
        "ORSAR-TARDI": ["ORSAR", "R784", "TATLA", "L223", "TARDI"],
        "ORSAR-TONVO": [
          "ORSAR",
          "R784",
          "TOVIV",
          "Q321",
          "NOLSU",
          "P307",
          "TONVO",
        ],
        "OVONA-LABRI": ["RESAR", "N318", "LABRI"],
        "OVONA-RETAS": ["RESAR", "N318", "KAPUM", "N685", "RETAS"],
        "PATAT-ALPOB": ["PATAT", "L519", "IVOXI", "N571", "ALPOB"],
        "PATAT-ORMID": ["PATAT", "L519", "IVOXI", "P699", "ORMID"],
        "PATAT-TARDI": [
          "PATAT",
          "L519",
          "EGPEP",
          "L313",
          "KIPOK",
          "L223",
          "TARDI",
        ],
        "PATAT-TOSNA": [
          "PATAT",
          "L519",
          "IVOXI",
          "P699",
          "EGTAG",
          "Q576",
          "RORON",
          "M430",
          "TOSNA",
        ],
        "PATAT-TUMAK": ["PATAT", "L519", "IVOXI", "M557", "TUMAK"],
        "PEKEM-GABKO": [
          "PEKEM",
          "M628",
          "RIGIL",
          "G783",
          "ASPED",
          "Q308",
          "PEDOG",
          "R401",
          "GABKO",
        ],
        "SIR-LALDO": ["SIR", "L223", "TATLA", "R784", "KUSEN", "M677", "LALDO"],
        "SIR-TARDI": ["SIR", "L223", "TARDI"],
        "SIR-TONVO": [
          "SIR",
          "L223",
          "TATLA",
          "R784",
          "TOVIV",
          "Q321",
          "NOLSU",
          "P307",
          "TONVO",
        ],
        "SODEX-ALPOB": ["SODEX", "N563", "ALPOB"],
        "SODEX-ORMID": ["SODEX", "N563", "IMGUX", "P699", "ORMID"],
        "SODEX-TOVOX": ["SODEX", "N563", "UMIBU", "P899", "TOVOX"],
        "SODEX-TUMAK": [
          "SODEX",
          "N563",
          "BOSEV",
          "Q565",
          "UKUVO",
          "G462",
          "TUMAK",
        ],
        "SOLUD-ALPOB": ["SOLUD", "P574", "RUKOR", "N571", "ALPOB"],
        "SOLUD-GABKO": ["SOLUD", "P574", "NORGA", "R401", "GABKO"],
        "SOLUD-KUMUN": ["SOLUD", "P574", "KUMUN"],
        "SOLUD-ORMID": [
          "SOLUD",
          "P574",
          "RUKOR",
          "N571",
          "IVOXI",
          "P699",
          "ORMID",
        ],
        "SOLUD-TUMAK": [
          "SOLUD",
          "P574",
          "RUKOR",
          "N571",
          "IVOXI",
          "M557",
          "TUMAK",
        ],
        "TANSU-GABKO": [
          "TANSU",
          "G783",
          "ASPED",
          "Q308",
          "PEDOG",
          "R401",
          "GABKO",
        ],
        "TOSNA-LABRI": ["ORSIS", "N685", "KAPUM", "N318", "LABRI"],
        "TOSNA-RETAS": [
          "ORSIS",
          "N685",
          "UMEVU",
          "Q415",
          "KAXOB",
          "N300",
          "GIDOB",
          "N685",
          "RETAS",
        ],

        //1.9.4. The following standard routings apply for traffic departing UAE airports:
        "OMAA,AD-ALPOB": ["BOSEV", "N563", "ALPOB"],
        "OMAA,AD-GABKO": ["TULON", "M318", "GABKO"],
        "OMAA,AD-KATIT": ["ATUDO", "M318", "KATIT"],
        "OMAA,AD-KUMUN": ["TULON", "M318", "TOVIV", "P574", "KUMUN"],
        "OMAA,AD-LABRI": ["KANIP", "N318", "LABRI"],
        "OMAA,AD-ORMID": ["BOSEV", "N563", "IMGUX", "P699", "ORMID"],
        "OMAA,AD-ORSAR": [
          "DAXIB",
          "Q563",
          "UKUVO",
          "DCT",
          "KIVUS",
          "DCT",
          "LUDAM",
          "DCT",
          "ORSAR",
        ],
        "OMAA,AD-PEKEM": [
          "ORNEL",
          "T560",
          "ELUDA",
          "G783",
          "RIGIL",
          "M628",
          "PEKEM",
        ],
        "OMAA,AD-RETAS": ["ORNEL", "N685", "RETAS"],
        "OMAA,AD-RIBOT": ["ATUDO", "M318", "GOLGU", "M550", "RIBOT"],
        "OMAA,AD-TANSU": ["ORNEL", "T560", "ELUDA", "G783", "TANSU"],
        "OMAA,AD-TOVOX": ["MEKRI", "P899", "TOVOX"],
        "OMAA,AD-TUMAK": ["DAXIB", "Q563", "UKUVO", "G462", "TUMAK"],
        "OMAL-ALPOB": ["ROVOS", "DCT", "ADV", "DCT", "BOSEV", "N563", "ALPOB"],
        "OMAL-GABKO": [
          "ROVOS",
          "G462",
          "ULODA",
          "DCT",
          "TULON",
          "M318",
          "GABKO",
        ],
        "OMAL-KATIT": [
          "ROVOS",
          "DCT",
          "ADV",
          "DCT",
          "VUXOD",
          "L519",
          "ATUDO",
          "M318",
          "KATIT",
        ],
        "OMAL-KUMUN": [
          "ROVOS",
          "G462",
          "ULODA",
          "DCT",
          "TULON",
          "M318",
          "TOVIV",
          "P574",
          "KUMUN",
        ],
        "OMAL-ORMID": [
          "ROVOS",
          "DCT",
          "ADV",
          "DCT",
          "BOSEV",
          "N563",
          "IMGUX",
          "P699",
          "ORMID",
        ],
        "OMAL-PEKEM": ["DCT", "ELUDA", "G783", "RIGIL", "M628", "PEKEM"],
        "OMAL-RIBOT": [
          "ROVOS",
          "DCT",
          "ADV",
          "DCT",
          "VUXOD",
          "L519",
          "ATUDO",
          "M318",
          "GOLGU",
          "M550",
          "RIBOT",
        ],
        "OMAL-TANSU": ["DCT", "ELUDA", "G783", "TANSU"],
        "OMAL-TOVOX": ["ROVOS", "DCT", "ADV", "DCT", "MEKRI", "P899", "TOVOX"],
        "OMAL-TUMAK": [
          "ROVOS",
          "DCT",
          "ADV",
          "DCT",
          "DAXIB",
          "Q563",
          "UKUVO",
          "G462",
          "TUMAK",
        ],
        "OMDB,DW,SJ-ALPOB": ["SENPA", "N571", "ALPOB"],
        "OMDB,DW,SJ-GABKO": ["DAVMO", "M318", "GABKO"],
        "OMDB,DW,SJ-KATIT": ["KUTLI", "L519", "ATUDO", "M318", "KATIT"],
        //"OMDB,DW,SJ-KUMUN": ["DCT", "KUMUN"],
        "OMDB,DW,SJ-MEMTU": [
          "ANVIX",
          "R401",
          "GIDIS",
          "G783-",
          "UKRAG",
          "L710",
          "MEMTU",
        ],
        "OMDB,DW,SJ-ORMID": ["NABIX", "P699", "ORMID"],
        "OMDB,DW,SJ-ORSAR": [
          "RIDAP",
          "M557",
          "TOTKU",
          "DCT",
          "KIVUS",
          "DCT",
          "LUDAM",
          "DCT",
          "ORSAR",
        ],
        "OMDB,DW,SJ-PEKEM": [
          "ANVIX",
          "R401",
          "GIDIS",
          "G783-",
          "RIGIL",
          "M628-",
          "PEKEM",
        ],
        "OMDB,DW,SJ-RIBOT": [
          "KUTLI",
          "L519",
          "ATUDO",
          "M318",
          "GOLGU",
          "M550",
          "RIBOT",
        ],
        "OMDB,DW,SJ-TANSU": ["ANVIX", "R401", "GIDIS", "G783-", "TANSU"],
        "OMDB,DW,SJ-TARDI": ["ANVIX", "L223", "TARDI"],
        "OMDB,DW,SJ-TOSNA*": ["MIROT", "Q576", "RORON", "M430", "TOSNA"],
        "OMDB,DW,SJ-TOSNA": ["NABIX", "P699", "OXARI", "M430", "TOSNA"],
        "OMDB,DW,SJ-TUMAK": ["RIDAP", "M557", "TUMAK"],
        "OMDB,SJ-GOMTA": ["IVURO", "M428", "GOMTA"],
        "OMDB,SJ-LALDO": ["IVURO", "M677", "LALDO"],
        "OMDW-GOMTA": ["NOLSU", "M572", "GOMTA"],
        "OMDW-LALDO": ["NOLSU", "N300", "LALDO"],
        "OMFJ-ALPOB": ["SERSA", "L519", "IVOXI", "N571", "ALPOB"],
        "OMFJ-GABKO": [
          "KUSEN",
          "DCT",
          "EMOPI",
          "DCT",
          "ITLAP",
          "R401",
          "GABKO",
        ],
        "OMFJ-KATIT": ["SERSA", "L519", "ATUDO", "M318", "KATIT"],
        "OMFJ-ORMID": ["SERSA", "L519", "IVOXI", "P699", "ORMID"],
        "OMFJ-PEKEM": ["VAVIM", "G783", "RIGIL", "M628", "PEKEM"],
        "OMFJ-RIBOT": [
          "SERSA",
          "L519",
          "ATUDO",
          "M318",
          "GOLGU",
          "M550",
          "RIBOT",
        ],
        "OMFJ-TANSU": ["VAVIM", "G783-", "TANSU"],
        "OMFJ-TONVO": ["FJV", "DCT", "TONVO"],
        "OMFJ-TOSNA": [
          "SERSA",
          "L519",
          "IVOXI",
          "P699",
          "OXARI",
          "M430",
          "TOSNA",
        ],
        "OMFJ-TUMAK": ["SERSA", "L519", "IVOXI", "M557", "TUMAK"],
        "OMRK-ALPOB": ["PUVAL", "L519", "IVOXI", "N571", "ALPOB"],
        "OMRK-GABKO": ["ASNEK", "R401", "GABKO"],
        "OMRK-GOMTA": [
          "PUVAL",
          "DCT",
          "NADNI",
          "DCT",
          "IVURO",
          "M428",
          "GOMTA",
        ],
        "OMRK-KATIT": ["PUVAL", "L519", "ATUDO", "M318", "KATIT"],
        "OMRK-LALDO": [
          "PUVAL",
          "DCT",
          "NADNI",
          "DCT",
          "IVURO",
          "M677",
          "LALDO",
        ],
        "OMRK-MEMTU": [
          "PUVAL",
          "DCT",
          "RUKOR",
          "DCT",
          "ANVIX",
          "R401",
          "GIDIS",
          "G783-",
          "UKRAG",
          "L710",
          "MEMTU",
        ],
        "OMRK-ORMID": [
          "PUVAL",
          "L519",
          "IVOXI",
          "N571",
          "TUDIS",
          "P699",
          "ORMID",
        ],
        "OMRK-PEKEM": [
          "PUVAL",
          "DCT",
          "RUKOR",
          "DCT",
          "ANVIX",
          "R401",
          "GIDIS",
          "G783-",
          "RIGIL",
          "M628-",
          "PEKEM",
        ],
        "OMRK-RIBOT": [
          "PUVAL",
          "L519",
          "ATUDO",
          "M318",
          "GOLGU",
          "M550",
          "RIBOT",
        ],
        "OMRK-TANSU": [
          "PUVAL",
          "DCT",
          "RUKOR",
          "DCT",
          "ANVIX",
          "R401",
          "GIDIS",
          "G783-",
          "TANSU",
        ],
        "OMRK-TARDI": [
          "PUVAL",
          "DCT",
          "RUKOR",
          "DCT",
          "ANVIX",
          "L223",
          "TARDI",
        ],
        "OMRK-TOSNA": [
          "PUVAL",
          "L519",
          "IVOXI",
          "P699",
          "OXARI",
          "M430",
          "TOSNA",
        ],
        "OMRK-TUMAK": ["PUVAL", "L519", "IVOXI", "M557", "TUMAK"],

        //1.9.5. The following standard routings apply for traffic arriving at UAE international airports.
        "ASTOG-OMDB": ["ENANO", "L305", "ITBUL", "M677", "VUTEB"],
        "ASTOG-OMDW": [
          "ENANO",
          "L305",
          "KIVUS",
          "P559",
          "AMBOV",
          "Q322",
          "DATOB",
        ],
        "ASTOG-OMFJ": ["ENANO", "L305", "EMOTA", "R784", "KUSEN"],
        "ASTOG-OMRK": ["ENANO", "L305", "EMOTA", "R784", "ALSIL"],
        "ASTOG-OMSJ": ["ENANO", "L305", "EMOTA", "R784", "GONVI"],
        "BUNDU-OMAA": ["BUNDU", "B415", "UKILI"],
        "BUNDU-OMAD": ["BUNDU", "B415", "EGPOG", "Q666", "GIDOB"],
        "BUNDU-OMAL": [
          "BUNDU",
          "B415",
          "EGPOG",
          "Q666",
          "GIDOB",
          "DCT",
          "ADV",
          "DCT",
          "KANIP",
        ],
        "ITRAX-OMAA,AD": ["ITRAX", "P899", "ROVOS"],
        "ITRAX-OMAL": ["ITRAX", "DCT", "VAVIM"],
        "KATIT-OMAA,AD": ["KATIT", "M318", "ATUDO"],
        "KATIT-OMAL": ["KATIT", "M318", "ATUDO", "DCT", "ADV", "DCT", "KANIP"],
        "KATIT-OMDB": ["KATIT", "M318", "RURAL", "Q317", "LORID"],
        "KATIT-OMDW": ["KATIT", "M318", "RURAL", "Q317", "LORID"],
        "KATIT-OMRK": [
          "KATIT",
          "M318",
          "RURAL",
          "Q317",
          "LORID",
          "DCT",
          "TOVIV",
          "DCT",
          "ALSIL",
        ],
        "KATIT-OMSJ": ["KATIT", "M318", "RURAL", "Q317", "LORID"],
        "KUPRO-OMAA": ["KUPRO", "N300", "KAXOB", "Q415", "UKILI"],
        "KUPRO-OMAD": ["KUPRO", "N300", "GIDOB"],
        "KUPRO-OMAL": ["KUPRO", "N300", "GIDOB", "DCT", "ADV", "DCT", "KANIP"],
        "MENSA-OMFJ": ["MENSA", "T509", "FJV"],
        "MENSA-OMRK": ["MENSA", "N317", "NADNI"],
        "MENSA-OMSJ": ["MENSA", "N317", "NOLSU"],
        "MUSAP-OMDB": [
          "MUSAP",
          "R401",
          "PEDOG",
          "Q308",
          "KIPOK",
          "Q568",
          "IMPED",
        ],
        "MUSAP-OMDW": ["MUSAP", "R401", "GIDIS"],
        "MUSAP-OMFJ": ["MUSAP", "R401", "PEDOG", "Q308", "RUDAT"],
        "MUSAP-OMRK": [
          "MUSAP",
          "R401",
          "PEDOG",
          "Q308",
          "ORKOB",
          "T891",
          "NOLSU",
          "N317",
          "NADNI",
        ],
        "MUSAP-OMSJ": [
          "MUSAP",
          "R401",
          "PEDOG",
          "Q308",
          "ORKOB",
          "T891",
          "NOLSU",
        ],
        "NALPO-OMDB": ["TOMSO", "P559", "VUTEB"],
        "NALPO-OMDW": ["TOMSO", "P559", "AMBOV", "Q322", "DATOB"],
        "NALPO-OMDW*": ["TOMSO", "P559", "KIVUS", "G666", "ELOVU"],
        "NALPO-OMFJ": [
          "TOMSO",
          "P559",
          "KIVUS",
          "L305",
          "EMOTA",
          "R784",
          "KUSEN",
        ],
        "NALPO-OMRK": [
          "TOMSO",
          "P559",
          "KIVUS",
          "L305",
          "EMOTA",
          "R784",
          "ALSIL",
        ],
        "NALPO-OMSJ": [
          "TOMSO",
          "P559",
          "KIVUS",
          "L305",
          "EMOTA",
          "R784",
          "GONVI",
        ],
        "OBNET-OMDB": ["DEGSO", "M677", "VUTEB"],
        "OBNET-OMDW": ["DEGSO", "M677", "ITBUL", "Q322", "DATOB"],
        "OBNET-OMDW*": ["DEGSO", "M677", "LUDAM", "G666", "ELOVU"],
        "OBNET-OMFJ": [
          "DEGSO",
          "M677",
          "ITBUL",
          "L305",
          "EMOTA",
          "R784",
          "KUSEN",
        ],
        "OBNET-OMRK": [
          "DEGSO",
          "M677",
          "ITBUL",
          "L305",
          "EMOTA",
          "R784",
          "ALSIL",
        ],
        "OBNET-OMSJ": [
          "DEGSO",
          "M677",
          "ITBUL",
          "L305",
          "EMOTA",
          "R784",
          "GONVI",
        ],
        "ORSAR-OMAA": ["ORSAR", "DCT", "UKILI"],
        "ORSAR-OMAA,AD*": ["ORSAR", "G666", "ELOVU"],
        "ORSAR-OMAA,AD": [
          "ORSAR",
          "R784",
          "TATLA",
          "L223",
          "VUTEB",
          "Q569",
          "OBREV",
          "Q311",
          "EMERU",
        ],
        "ORSAR-OMAD": ["ORSAR", "DCT", "GIDOB"],
        "ORSAR-OMAL": [
          "ORSAR",
          "R784",
          "TATLA",
          "L223",
          "VUTEB",
          "Q569",
          "OBREV",
          "Q311",
          "TONKI",
          "DCT",
          "KANIP",
        ],
        "ORSAR-OMDB": ["ORSAR", "R784", "TATLA", "L223", "VUTEB"],
        "ORSAR-OMDW*": ["ORSAR", "G666", "ELOVU"],
        "ORSAR-OMDW": ["ORSAR", "R784", "GONVI"],
        "ORSAR-OMFJ": ["ORSAR", "R784", "KUSEN"],
        "ORSAR-OMRK": ["ORSAR", "R784", "ALSIL"],
        "ORSAR-OMSJ": ["ORSAR", "R784", "GONVI"],
        "OVONA-OMAA": [
          "RESAR",
          "N318",
          "KAPUM",
          "Z522",
          "ALNEV",
          "Q415",
          "UKILI",
        ],
        "OVONA-OMAD": ["RESAR", "N318", "KAPUM", "N685", "GIDOB"],
        "OVONA-OMAL": [
          "RESAR",
          "N318",
          "KAPUM",
          "N685",
          "GIDOB",
          "DCT",
          "ADV",
          "DCT",
          "KANIP",
        ],
        "PASOV-OMDB": ["PASOV", "B540", "MIVEK", "P574", "IMPED"],
        "PASOV-OMDW": ["PASOV", "M564", "UMAMI"],
        "PASOV-OMRK": [
          "PASOV",
          "B540",
          "ORKOB",
          "T891",
          "NOLSU",
          "N317",
          "NADNI",
        ],
        "PASOV-OMSJ": ["PASOV", "B540", "ORKOB", "T891", "NOLSU"],
        "PATAT-OMAA,AD": ["PATAT", "L519", "IVOXI", "Q311", "EMERU"],
        "PATAT-OMAL": [
          "PATAT",
          "L519",
          "IVOXI",
          "Q311",
          "TONKI",
          "DCT",
          "KANIP",
        ],
        "PATAT-OMDB,SJ,DW": ["PATAT", "L519", "PUVAL"],
        "PATAT-OMFJ": [
          "PATAT",
          "L519",
          "EGPEP",
          "DCT",
          "EMOPI",
          "R784",
          "KUSEN",
        ],
        "PATAT-OMRK": ["PATAT", "L519", "EGPEP"],
        "PEKEM-OMAA,AD": [
          "PEKEM",
          "M628",
          "RIGIL",
          "G783",
          "VAVIM",
          "P899",
          "ROVOS",
        ],
        "PEKEM-OMAL": ["PEKEM", "M628", "RIGIL", "G783", "VAVIM"],
        "PEKEM-OMDB": [
          "PEKEM",
          "M628",
          "RIGIL",
          "G783",
          "ASPED",
          "Q308",
          "KIPOK",
          "Q568",
          "IMPED",
        ],
        "PEKEM-OMDW": [
          "PEKEM",
          "M628",
          "RIGIL",
          "G783",
          "ASPED",
          "Q308",
          "PEDOG",
          "R401",
          "GIDIS",
        ],
        "PEKEM-OMFJ": [
          "PEKEM",
          "M628",
          "RIGIL",
          "G783",
          "ASPED",
          "Q308",
          "RUDAT",
        ],
        "PEKEM-OMRK": [
          "PEKEM",
          "M628",
          "RIGIL",
          "G783",
          "ASPED",
          "Q308",
          "ORKOB",
          "T891",
          "NOLSU",
          "N317",
          "NADNI",
        ],
        "PEKEM-OMSJ": [
          "PEKEM",
          "M628",
          "RIGIL",
          "G783",
          "ASPED",
          "Q308",
          "ORKOB",
          "T891",
          "NOLSU",
        ],
        "RIBOT-OMAA,AD": ["RIBOT", "M550", "GOLGU", "M318", "ATUDO"],
        "RIBOT-OMAL": [
          "RIBOT",
          "M550",
          "GOLGU",
          "M318",
          "ATUDO",
          "DCT",
          "ADV",
          "DCT",
          "KANIP",
        ],
        "RIBOT-OMDB,SJ": [
          "RIBOT",
          "M550",
          "GOLGU",
          "M318",
          "RURAL",
          "Q317",
          "LORID",
        ],
        "RIBOT-OMDW": [
          "RIBOT",
          "M550",
          "GOLGU",
          "M318",
          "RURAL",
          "Q317",
          "LORID",
        ],
        "RIBOT-OMRK": [
          "RIBOT",
          "M550",
          "GOLGU",
          "M318",
          "RURAL",
          "Q317",
          "LORID",
          "DCT",
          "TOVIV",
          "DCT",
          "ALSIL",
        ],
        "SODEX-OMAA,AD": ["SODEX", "N563", "NOBTO"],
        "SODEX-OMAL": ["SODEX", "N563", "ELUDA", "G783", "VAVIM"],
        "SOLUD-OMDB": ["SOLUD", "P574", "GISMO", "P574", "IMPED"],
        "TANSU-OMAA,AD": ["TANSU", "G783", "VAVIM", "P899", "ROVOS"],
        "TANSU-OMAL": ["TANSU", "G783", "VAVIM"],
        "TANSU-OMDB": [
          "TANSU",
          "G783",
          "ASPED",
          "Q308",
          "KIPOK",
          "Q568",
          "IMPED",
        ],
        "TANSU-OMDW": [
          "TANSU",
          "G783",
          "ASPED",
          "Q308",
          "PEDOG",
          "R401",
          "GIDIS",
        ],
        "TANSU-OMFJ": ["TANSU", "G783", "ASPED", "Q308", "RUDAT"],
        "TANSU-OMRK": [
          "TANSU",
          "G783",
          "ASPED",
          "Q308",
          "ORKOB",
          "T891",
          "NOLSU",
          "N317",
          "NADNI",
        ],
        "TANSU-OMSJ": [
          "TANSU",
          "G783",
          "ASPED",
          "Q308",
          "ORKOB",
          "T891",
          "NOLSU",
        ],
        "TAPRA-OMDB": ["TAPRA", "M762", "MIVEK", "P574", "IMPED"],
        "TAPRA-OMDW": ["TAPRA", "M762", "VAXAS", "M564", "UMAMI"],
        "TOSNA-OMAA": ["ORSIS", "N685", "UMEVU", "Q415", "UKILI"],
        "TOSNA-OMAD": ["ORSIS", "N685", "GIDOB"],
        "TOSNA-OMAL": ["ORSIS", "N685", "GIDOB", "DCT", "ADV", "DCT", "KANIP"],
        "VAXAS-OMDB": ["VAXAS", "M762", "MIVEK", "P574", "IMPED"],
        "VAXAS-OMDW": ["VAXAS", "M564", "UMAMI"],
        "VAXAS-OMRK": [
          "VAXAS",
          "M762",
          "RUDAT",
          "Q308",
          "ORKOB",
          "T891",
          "NOLSU",
          "N317",
          "NADNI",
        ],
        "VAXAS-OMSJ": [
          "VAXAS",
          "M762",
          "RUDAT",
          "Q308",
          "ORKOB",
          "T891",
          "NOLSU",
        ],

        //FRA routes-------------------------
        "BUNDU-LABRI-FRA": ["BUNDU", "DCT", "LABRI"],
        "BUNDU-LABRI*-FRA": ["BUNDU", "B415", "UKILI", "DCT", "LABRI"],
        "BUNDU-OMAA-FRA": ["BUNDU", "DCT", "EGPOG", "B415", "UKILI"],
        "BUNDU-OMAD-FRA": ["BUNDU", "DCT", "EGPOG", "Q666", "GIDOB"],
        "BUNDU-OMAL-FRA": [
          "BUNDU",
          "DCT",
          "EGPOG",
          "Q666",
          "GIDOB",
          "DCT",
          "ADV",
          "DCT",
          "KANIP",
        ],
        "BUNDU-RETAS-FRA": ["BUNDU", "DCT", "NAPMA", "N685", "RETAS"],
        "BUNDU-TONVO-FRA": ["BUNDU", "DCT", "GIDOB", "DCT", "TONVO"],
        "BUNDU-TONVO*-FRA": ["BUNDU", "B415", "UKILI", "DCT", "TONVO"],
        "GISMO-ALPOB-FRA": ["GISMO", "DCT", "TUDIS", "N571", "ALPOB"],
        "GISMO-GABKO-FRA": ["GISMO", "DCT", "GABKO"],
        "GISMO-KUMUN-FRA": ["GISMO", "DCT", "KUMUN"],
        "GISMO-ORMID-FRA": ["GISMO", "DCT", "EGTAG", "P699", "ORMID"],
        "GISMO-TUMAK-FRA": ["GISMO", "DCT", "MITIX", "M557", "TUMAK"],
        "ITRAX-ALPOB-FRA": [
          "ITRAX",
          "DCT",
          "ORBOL",
          "G462",
          "UKUVO",
          "Q563",
          "IMGUX",
          "N563",
          "ALPOB",
        ],
        "ITRAX-ORMID-FRA": [
          "ITRAX",
          "DCT",
          "ORBOL",
          "G462",
          "UKUVO",
          "Q563",
          "IMGUX",
          "P699",
          "ORMID",
        ],
        "ITRAX-TOVOX*-FRA": ["ITRAX", "DCT", "UMIBU", "P899", "TOVOX"],
        "ITRAX-TOVOX-FRA": ["ITRAX", "DCT", "TOVOX"],
        "ITRAX-TUMAK-FRA": ["ITRAX", "DCT", "ORBOL", "G462", "TUMAK"],
        "KUPRO-LALDO*-FRA": ["KUPRO", "N300", "GIDOB", "DCT", "LALDO"],
        "KUPRO-LALDO-FRA": ["KUPRO", "DCT", "GIDOB", "DCT", "LALDO"],
        "KUPRO-TONVO-FRA": ["KUPRO", "DCT", "GIDOB", "DCT", "TONVO"],
        "KUPRO-TONVO*-FRA": ["KUPRO", "N300", "GIDOB", "DCT", "TONVO"],
        "LALDO-ALPOB-FRA": ["LALDO", "DCT", "TUDIS", "N571", "ALPOB"],
        "LALDO-ORMID-FRA": ["LALDO", "DCT", "EGTAG", "P699", "ORMID"],
        "LALDO-TOSNA-FRA": [
          "LALDO",
          "DCT",
          "EGTAG",
          "Q576",
          "RORON",
          "M430",
          "TOSNA",
        ],
        "LALDO-TUMAK-FRA": ["LALDO", "DCT", "MITIX", "M557", "TUMAK"],
        "MENSA-ALPOB-FRA": ["MENSA", "DCT", "TUDIS", "N571", "ALPOB"],
        "MENSA-ORMID-FRA": ["MENSA", "DCT", "EGTAG", "P699", "ORMID"],
        "MENSA-TOSNA-FRA": [
          "MENSA",
          "DCT",
          "EGTAG",
          "Q576",
          "RORON",
          "M430",
          "TOSNA",
        ],
        "MENSA-TUMAK-FRA": ["MENSA", "DCT", "MITIX", "M557", "TUMAK"],
        "NALPO-LALDO-FRA": ["NALPO", "DCT", "LALDO"],
        "NALPO-TARDI-FRA": ["NALPO", "DCT", "LOVEM", "DCT", "TARDI"],
        "NALPO-TARDI*-FRA": [
          "NALPO",
          "DCT",
          "LOVEM",
          "DCT",
          "ANVIX",
          "L223",
          "TARDI",
        ],
        "NALPO-TONVO-FRA": ["NALPO", "DCT", "TONVO"],
        "OBNET-LALDO-FRA": ["OBNET", "DCT", "TOVIV", "DCT", "LALDO"],
        "OBNET-TARDI-FRA": ["OBNET", "DCT", "IVOXI", "DCT", "TARDI"],
        "OBNET-TARDI*-FRA": [
          "OBNET",
          "DCT",
          "IVOXI",
          "DCT",
          "ANVIX",
          "L223",
          "TARDI",
        ],
        "OBNET-TONVO-FRA": ["OBNET", "DCT", "TONVO"],
        "ORSAR-LALDO-FRA": [
          "ORSAR",
          "DCT",
          "GIBIB",
          "DCT",
          "TOVIV",
          "DCT",
          "LALDO",
        ],
        "ORSAR-TARDI-FRA": ["ORSAR", "DCT", "LAGTA", "DCT", "TARDI"],
        "ORSAR-TARDI*-FRA": [
          "ORSAR",
          "DCT",
          "LAGTA",
          "DCT",
          "ANVIX",
          "L223",
          "TARDI",
        ],
        "ORSAR-TONVO-FRA": ["ORSAR", "DCT", "GIBIB", "DCT", "TONVO"],
        "OVONA-LABRI-FRA": ["OVONA", "DCT", "KAPUM", "DCT", "LABRI"],
        "OVONA-RETAS-FRA": ["OVONA", "DCT", "NAPMA", "N685", "RETAS"],
        "PATAT-ALPOB-FRA": ["PATAT", "DCT", "TUDIS", "N571", "ALPOB"],
        "PATAT-OMAA ,AD-FRA": [
          "PATAT",
          "DCT",
          "ITLAP",
          "L519",
          "IVOXI",
          "Q311",
          "EMERU",
        ],
        "PATAT-OMAL-FRA": [
          "PATAT",
          "DCT",
          "ITLAP",
          "L519",
          "IVOXI",
          "Q311",
          "TONKI",
          "DCT",
          "KANIP",
        ],
        "PATAT-ORMID-FRA": ["PATAT", "DCT", "EGTAG", "P699", "ORMID"],
        "PATAT-TARDI-FRA": ["PATAT", "DCT", "TARDI"],
        "PATAT-TARDI*-FRA": ["PATAT", "DCT", "ANVIX", "L223", "TARDI"],
        "PATAT-TOSNA-FRA": [
          "PATAT",
          "DCT",
          "EGTAG",
          "Q576",
          "RORON",
          "M430",
          "TOSNA",
        ],
        "PATAT-TUMAK-FRA": ["PATAT", "DCT", "MITIX", "M557", "TUMAK"],
        "SIR-LALDO-FRA": [
          "SIR",
          "DCT",
          "TATLA",
          "DCT",
          "TOVIV",
          "DCT",
          "LALDO",
        ],
        "SIR-TARDI-FRA": ["SIR", "DCT", "TARDI"],
        "SIR-TARDI*-FRA": ["SIR", "DCT", "ANVIX", "L223", "TARDI"],
        "SIR-TONVO-FRA": ["SIR", "DCT", "TATLA", "DCT", "TONVO"],
        "SODEX-ALPOB-FRA": ["SODEX", "DCT", "BOSEV", "N563", "ALPOB"],
        "SODEX-ORMID-FRA": [
          "SODEX",
          "DCT",
          "BOSEV",
          "N563",
          "IMGUX",
          "P699",
          "ORMID",
        ],
        "SODEX-TOVOX-FRA": ["SODEX", "DCT", "UMIBU", "DCT", "TOVOX"],
        "SODEX-TOVOX*-FRA": ["SODEX", "DCT", "UMIBU", "P899", "TOVOX"],
        "SODEX-TUMAK-FRA": [
          "SODEX",
          "DCT",
          "BOSEV",
          "Q565",
          "UKUVO",
          "G462",
          "TUMAK",
        ],
        "TOSNA-LABRI-FRA": ["ORSIS", "N685", "TOSNA", "DCT", "LABRI"],
        "TOSNA-RETAS-FRA": [
          "ORSIS",
          "N685",
          "TOSNA",
          "DCT",
          "NAPMA",
          "N685",
          "RETAS",
        ],
      };

      const CFL_XFL = {
        "ASTOG-OMDB": { CFL: "F210 or Below", XFL: "A100" },
        "ASTOG-OMDW": { CFL: "F210 or Below", XFL: "F160" },
        "ASTOG-OMFJ": { CFL: "F210 or Below", XFL: "A100" },
        "ASTOG-OMRK": { CFL: "F210 or Below", XFL: "A100" },
        "ASTOG-OMSJ": { CFL: "F210 or Below", XFL: "A090" },
        "BUNDU-OMAA": { CFL: "F350 or Below", XFL: "A120" },
        "BUNDU-OMAD": { CFL: "F350 or Below", XFL: "A100" },
        "OMAA,AD-GABKO": {
          CFL: "F150",
          XFL: "RFL",
          REMARKS: "FPL remarks = 'K' (Krachi FIR)",
        },
        "BUNDU-LABRI": {
          CFL: "RFL / F270 if Dep Doha",
          XFL: "RFL",
          REMARKS:
            "Overflying Muscat FIR or with destination other than OOMS/OOMN/OOSH",
        },
        "BUNDU-RETAS": {
          CFL: "RFL / F270 if Dep Doha",
          XFL: "F330 or Below",
          REMARKS:
            "Destinations OOMS/OOMN/OOSH. <br>F330 or below for OOMS/OOMN and F230 for OOSH",
        },
        "BUNDU-TONVO": {
          CFL: "RFL / F270 if Dep Doha",
          XFL: "RFL",
          REMARKS:
            " Available levels over TONVO are F270 and above. <br>Traffic shall cross UKILI F230 or above and GEVIV F270 or above",
        },
        "OMAA,AD-TUMAK": { CFL: "F150", XFL: "RFL" },
        "OMAA,AD-ORMID": {
          CFL: "F150",
          XFL: "F260 or Below Crusing",
          REMARKS: "Destinations: OBBI, OBBS, OBKH, OEDF and OEDR",
        },
        "NALPO-OMFJ": {
          CFL: "F310",
          XFL: "F100",
          REMARKS: "N-H: F250, H-R: F190",
        },
      };

      // Array (sector info library) to store rows ------------------
      const sectorData = [
        { sector: "SOUTH", limit: "GND - F600", freq: "128.250" },
        { sector: "LIMA", limit: "GND - F600", freq: "125.925" },
        { sector: "BRAVO", limit: "GND - F600", freq: "119.325" },
        { sector: "NORTH", limit: "GND - F600", freq: "132.150" },
        { sector: "MIKE", limit: "GND - F600", freq: "132.550" },
        { sector: "CENTRAL", limit: "GND - F600", freq: "124.375" },
        { sector: "DELTA", limit: "GND - F255", freq: "120.900" },
        { sector: "HOTEL", limit: "GND - F255", freq: "128.125" },
        { sector: "ALPHA", limit: "GND - F255", freq: "129.500" },
        { sector: "EAST", limit: "GND - F255", freq: "125.375" },
        { sector: "ROMEO", limit: "GND - F255", freq: "124.850" },
        { sector: "GOLF", limit: "GND - F245", freq: "120.525" },
        { sector: "WEST", limit: "GND - F245", freq: "119.300" },
        { sector: "YANKEE", limit: "A095 - F195", freq: "118.925" },
      ];

      // Sector Frequency Library
      const sectFreq = [
        { frqName: "OMAA-C / 124.4", pin: ["240243.58N", "0550505.46E"] },
        /*{ frqName: "G / 120.525", pin: ["244350.07N", "0531028.57E"] },
      { frqName: "S / 128.25", pin: ["244801.92N", "0523545.62E"] },
      {
      frqName: "A / 129.5",
      freq: "B / 119.325",
      condition: "L / 125.925",
      pin: ["240006.44N", "0544055.49E"],
      },
      {
      frqName: "N / 132.15",
      pin: ["260804.75N", "0532333.16E"],
      },
      {
      frqName: "W / 119.3",
      pin: ["254824.40N", "0541704.78E"],
      },*/
        {
          frqName: "OMDB W / 124.9",
          freq: "",
          condition: "",
          pin: ["253710.07N", "0545600.46E"],
        },
        {
          frqName: "OMDB E / 124.9",
          freq: "",
          condition: "",
          pin: ["250004.31N", "0554157.58E"],
        },
        {
          frqName: "OMDW/SJ-DPN / 124.675",
          freq: "",
          condition: "",
          pin: ["253357.69N", "0553321.70E"],
        },
        {
          frqName: "OMDW/DM-DPS / 121.025",
          pin: ["250319.37N", "0543236.72E"],
        },
        {
          frqName: "OMFJ-APP / 129.4",
          freq: "OMFJ-TWR / 126.6",
          condition: "",
          pin: ["252701.52N", "0562143.49E"],
        },
        {
          frqName: "OMDW/DM-AMR / 124.025",
          freq: "",
          condition: "",
          pin: ["244831.28N", "0553133.54E"],
        },
        {
          frqName: "OMRK / 118.25",
          freq: "",
          condition: "",
          pin: ["254324.23N", "0555418.12E"],
        },
        {
          frqName: "OMAA-W / 128.1",
          freq: "",
          condition: "",
          pin: ["243553.29N", "0540329.76E"],
        },
        {
          frqName: "OBBB-EH / 132.12",
          freq: "OTDF-ANL / 135.725",
          condition: "",
          pin: ["260313.80N", "0525017.37E"],
        },
        {
          frqName: "OBBB-EL / 132.85",
          freq: "OTDF-TMN / 121.1",
          condition: "OTDF-ASH /136.475",
          pin: ["254516.27N", "0523257.90E"],
        },
        {
          frqName: "OIIX-5 / 120.3",
          freq: "",
          condition: "",
          pin: ["262103.32N", "0553602.55E"],
        },
        {
          frqName: "OIIX-4 / 133.4",
          freq: "",
          condition: "",
          pin: ["261612.39N", "0535935.71E"],
        },
        {
          frqName: "OEJD / 120.55",
          freq: "OEJD / 134.5-PURDA",
          condition: "OEJD / 132.9-MIGMA",
          pin: ["224751.34N", "0525542.03E"],
        },
        {
          frqName: "OTDF-TMS / 120.675",
          freq: "",
          condition: "",
          pin: ["251352.50N", "0521308.77E"],
        },
        {
          frqName: "OOMM-C / 124.7",
          freq: "",
          condition: "",
          pin: ["241532.62N", "0560145.91E"],
        },
        {
          frqName: "OOMM-N / 119.8",
          freq: "",
          condition: "",
          pin: ["251018.88N", "0564104.96E"],
        },
        // Add more entries as needed
      ];

      //hold info library --------------------------------
      const holdingLibrary = [
        {
          point: "ITLAP",
          heading: 204,
          leg: 6,
          turn: "Left",
          outboundHeading: 24,
          limit: "A100 - F180",
        },
        {
          point: "VUTEB",
          heading: 107,
          leg: 8,
          turn: "Right",
          outboundHeading: 287,
          limit: "A100 - F250",
        },
        {
          point: "IMPED",
          heading: 298,
          leg: 8,
          turn: "Right",
          outboundHeading: 118,
          limit: "A100 - F250",
        },
        {
          point: "ALNEV",
          heading: 117,
          leg: 8,
          turn: "Right",
          outboundHeading: 297,
          limit: "A100 - F220",
        },
        {
          point: "ROVOS",
          heading: 280,
          leg: 7,
          turn: "Right",
          outboundHeading: 100,
          limit: "A100 - F150",
        },
      ];

      // --- Prohibited Category  Library ------------------------

      const prohibitatedAreas = [
        {
          shapeName: "P48 UNL_GND",
          shapeType: "circle",
          coords: ["243850.46N", "0550715.30E"],
          radiusNm: 5,
          limit: "Argoob",
          type: "Permanent, Military activity extremely hazardous to aircraft",
        },
        {
          shapeName: "P108 FL220_GND",
          shapeType: "circle",
          coords: ["244041N", "0544152E"],
          radiusNm: 3,
          limit: "Tawilah",
          type: "Permanent, Controlled by Air Operations Center.",
        },

        //sample of rectangle shape
        /*{shapeName: "Rectangle A3", shapeType: "rectangle",
      corner1: ["252400N","0562000E"],
      corner2: ["252500N","0562100E"],
      limit: "Surface – 8,000ft",
      type: "Danger"
      }*/
      ];

      // --- Restricted Category Library -----------------------
      const restrictedAreas = [
        {
          shapeName: "OIR38 12,000Ft_AMSL-GND",
          shapeType: "circle",
          coords: ["255420N", "0543320E"],
          radiusNm: 12,
          limit: "Siri_Island",
          type: "Permanent",
        },
        {
          shapeName: "R51 FL300_FL155",
          shapeType: "polygon",
          coords: [
            ["245630.00N", "0551155.00E"],
            ["244755.14N", "0554814.67E"],
            ["244303.89N", "0554813.77E"],
            ["244044.20N", "0554813.34E"],
            ["243500.00N", "0554413.00E"],
            ["242923.17N", "0554558.61E"],
            ["242437.88N", "0554124.58E"],
            ["242943.38N", "0551411.55E"],
            ["243429.76N", "0551331.68E"],
            ["243335.74N", "0550548.57E"],
            ["243447.39N", "0550401.23E"],
            ["243824.15N", "0550147.31E"],
            ["244009.93N", "0550137.10E"],
            ["245630.00N", "0551155.00E"],
          ],
          limit: "Minhad_Trng_Area",
          type: "Activity notified by UAE ACC, When active: Controlled by AL MAKTOUM RADAR,\n Contact 124.025 MHz before entering Military jet training",
        },
        {
          shapeName: "R53 FL155_GND",
          shapeType: "polygon",
          coords: [
            ["244134.55N", "0551221.09E"],
            ["244030.00N", "0551430.00E"],
            ["243453.00N", "0552421.00E"],
            ["243500.00N", "0552700.00E"],
            ["243500.41N", "0553519.70E"],
            ["243500.00N", "0554413.00E"],
            ["242324.51N", "0554750.88E"],
            ["242534.00N", "0553628.00E"],
            ["242804.83N", "0552301.05E"],
            ["242943.38N", "0551411.55E"],
            ["243429.76N", "0551331.68E"],
            ["244134.55N", "0551221.09E"],
          ],
          limit: "Minhad_Trng_Area",
          type: "Activity notified by UAE ACC, When active: Controlled by DUBAI SOUTH RADAR,\n Contact 120.400 MHz before entering Military jet training",
        },
        {
          shapeName: "R67 FL300-9,500Ft_AGL",
          shapeType: "polygon",
          coords: [
            ["253530N", "0562150E"],
            ["252500N", "0562150E"],
            ["252500N", "0555958E"],
            ["252800N", "0554500E"],
            ["255230N", "0560130E"],
            ["255316N", "0560729E"],
            ["253549N", "0561011E"],
            ["253613N", "0561945E"],
            ["253530N", "0562150E"],
          ],
          limit: "Ras_Al_Kheimah",
          type: "Activity notified by UAE ACC, High level military jet training",
        },
        {
          shapeName: "R90 FL185-2,000Ft_AGL",
          shapeType: "polygon",
          coords: [
            ["234730N", "0552312E"],
            ["234428N", "0553023E"],
            ["232332N", "0552406E"],
            ["230723N", "0551420E"],
            ["234730N", "0552312E"],
          ],
          limit: "Burami South",
          type: "Permanent, Controlled by UAE Air Force",
        },
      ];

      // -Danger Category Library ---
      const dangerAreas = [
        /*{
      shapeName: "Circle C1",
      shapeType: "circle",
      coords: ["251200N","0554000E"],
      radiusNm: 2,
      limit: "FL60 – FL120",
      type: "Temporary"
      },*/
        {
          shapeName: "D22 FL300_GND",
          shapeType: "polygon",
          coords: [
            ["250330N", "0541625E"],
            ["251200N", "0542210E"],
            ["250713N", "0543130E"],
            ["245830N", "0542545E"],
            ["250330N", "0541625E"],
          ],
          limit: "Sea_Range_Charlie",
          type: "NOTAM, Air to Air towed target gunnery and Naval gunnery practice,\n Controlled by UAE ACC ",
        },
        {
          shapeName: "D24 FL220_GND",
          shapeType: "polygon",
          coords: [
            ["243429.76N", "0551331.68E"],
            ["242931.08N", "0551413.26E"],
            ["242839.42N", "0550708.58E"],
            ["243008.88N", "0550517.88E"],
            ["243328.80N", "0550449.32E"],
            ["243429.76N", "0551331.68E"],
          ],
          limit: "Bargat_Al_Hagat",
          type: "NOTAM - Controlled by AUH APP",
        },
      ];

      // -Training Category Library ---
      const trainingAreas = [
        {
          shapeName: "TRNG_A",
          shapeType: "polygon",
          coords: [
            ["253026N", "0533441E"],
            ["252203N", "0532838E"],
            ["250534N", "0535616E"],
            ["251355N", "0540220E"],
            ["253026N", "0533441E"],
          ],
          limit: "13,000ft AMSL - 6,000ft AMSL",
          type: "Civil Training Flights, Activity notified by UAE ACC,\n When active: Controlled by UAE ACC, Contact: 120.525 Mhz",
        },
        {
          shapeName: "TRNG_B",
          shapeType: "polygon",
          coords: [
            ["251341N", "0532237E"],
            ["252203N", "0532838E"],
            ["250534N", "0535616E"],
            ["245711N", "0535012E"],
            ["251341N", "0532237E"],
          ],
          limit: "13,000ft AMSL - 6,000ft AMSL",
          type: "Civil Training Flights, Activity notified by UAE ACC,\n When active: Controlled by UAE ACC, Contact: 120.525 Mhz",
        },
      ];

      const ctaAreas = [
        {
          shapeName: "OMFJ CTA_I",
          shapeType: "dynamicShape",
          closed: true,
          steps: [
            // Start point
            { type: "point", coord: ["253605.65N", "0562151.39E"] },

            {
              type: "arc",
              center: ["250600N", "0562103E"],
              radiusNm: 30,
              to: ["243644.15N", "0562847.71E"],
              clockwise: true,
            },

            // Straight lines
            { type: "line", to: ["250600N", "0562103E"] },
            { type: "line", to: ["252603.78N", "0562135.23E"] },
            { type: "line", to: ["253605.65N", "0562151.39E"] },
          ],
          limit: "9,500 FT AMSL / 1,500 FT AMSL",
          type: "Class: C",
        },
        {
          shapeName: "OMFJ CTA_II",
          shapeType: "dynamicShape",
          closed: true,
          steps: [
            // Start point
            { type: "point", coord: ["244606.37N", "0562357.52E"] },

            // Arc clockwise, radius 20NM, centered at ...
            {
              type: "arc",
              center: ["250600N", "0562103E"],
              radiusNm: 20,
              to: ["245420.06N", "0560307.82E"],
              clockwise: true,
            },

            // Straight lines
            { type: "line", to: ["251014N", "0560656E"] },
            { type: "line", to: ["252300N", "0561000E"] },
            { type: "line", to: ["252318.22N", "0560952.37E"] },

            // Second arc clockwise, radius 20NM, same center
            {
              type: "arc",
              center: ["250600N", "0562103E"],
              radiusNm: 20,
              to: ["252603.78N", "0562135.23E"],
              clockwise: true,
            },

            // Lines back to center and start
            { type: "line", to: ["250600N", "0562103E"] },
            { type: "line", to: ["244606.37N", "0562357.52E"] },
          ],
          limit: "9,500 FT AMSL / 2,000 FT AMSL",
          type: "Class: C",
        },
        {
          shapeName: "OMAA_RADAR CENTRAL",
          shapeType: "dynamicShape",
          closed: true, // polygon closes back to first point
          steps: [
            { type: "point", coord: ["241805N", "0542246E"] },
            { type: "line", to: ["242541N", "0542730E"] },
            { type: "line", to: ["242506N", "0543726E"] },
            { type: "line", to: ["243629N", "0544349E"] },
            { type: "line", to: ["244203N", "0544656E"] },
            { type: "line", to: ["245302N", "0545358E"] },
            { type: "line", to: ["244702N", "0550556E"] },
            { type: "line", to: ["244520N", "0550450E"] },
            { type: "line", to: ["244011N", "0550137E"] },
            { type: "line", to: ["243827N", "0550147E"] },

            // First arc (counter-clockwise, 5NM radius)
            {
              type: "arc",
              center: ["243850N", "0550715E"],
              radiusNm: 5,
              //from: ["243827N", "0550147E"],
              to: ["243420N", "0550452E"],
              clockwise: false,
            },
            { type: "line", to: ["243050N", "0550920E"] },
            { type: "line", to: ["243030N", "0551000E"] },
            { type: "line", to: ["242803N", "0552300E"] },
            { type: "line", to: ["241630N", "0552129E"] },
            { type: "line", to: ["235019N", "0551800E"] },
            { type: "line", to: ["240000N", "0550000E"] },
            { type: "line", to: ["241930N", "0543100E"] },
            { type: "line", to: ["241805N", "0542246E"] },
          ],
          limit: "FL 155 / 1,500 FT AMSL* Class : C",
          type: "1,500 FT AMSL / GND Class : G",
        },
        {
          shapeName: "OMAA_RADAR WEST",
          shapeType: "polygon",
          coords: [
            ["242800N", "0535500E"],
            ["243500N", "0535500E"],
            ["244536N", "0540032E"],
            ["245800N", "0541200E"],
            ["245700N", "0542446E"],
            ["245500N", "0545000E"],
            ["245302N", "0545358E"],
            ["244203N", "0544656E"],
            ["243629N", "0544349E"],
            ["242506N", "0543726E"],
            ["242541N", "0542730E"],
            ["241805N", "0542246E"],
            ["242424N", "0540828E"],
          ],
          limit: "FL 155 / 1,500 FT AMSL* Class : C",
          type: "1,500 FT AMSL / GND Class : G",
        },
        {
          shapeName: "OMAA_RADAR NORTH",
          shapeType: "dynamicShape",
          closed: true, // polygon closes back to first point
          steps: [
            { type: "point", coord: ["245302N", "0545358E"] },
            { type: "line", to: ["244702N", "0550556E"] },
            { type: "line", to: ["244520N", "0550450E"] },
            { type: "line", to: ["244011N", "0550137E"] },
            { type: "line", to: ["243827N", "0550147E"] },

            // First arc (counter-clockwise, 5NM radius)
            {
              type: "arc",
              center: ["243850N", "0550715E"],
              radiusNm: 5,
              //from: ["243827N", "0550147E"],
              to: ["243420N", "0550452E"],
              clockwise: false,
            },
            { type: "line", to: ["243050N", "0550920E"] },
            { type: "line", to: ["243030N", "0551000E"] },
            { type: "line", to: ["242803N", "0552300E"] },
            { type: "line", to: ["241630N", "0552129E"] },
            { type: "line", to: ["242046N", "0550523E"] },
            { type: "line", to: ["243741N", "0544209E"] },
            // Second arc (counter-clockwise, 3NM radius)
            {
              type: "arc",
              center: ["244041N", "0544152E"],
              radiusNm: 3,
              //from: ["243741N", "0544209E"],
              to: ["244256N", "0544403E"],
              clockwise: false,
            },
            { type: "line", to: ["245302N", "0545358E"] }, // closes the polygon
          ],
          limit: "3,000 FT AMSL / 1,500 FT AMSL Class : C",
          type: "1,500 FT AMSL / GND Class : G",
        },
        {
          shapeName: "OMAA_RADAR EAST", //OMAL AREA
          shapeType: "polygon",
          coords: [
            ["243500N", "0552700E"],
            ["243500N", "0555000E"],
            ["243500N", "0560000E"],
            ["243028N", "0560525E"],
            ["240000N", "0553500E"],
            ["234428N", "0553023E"],
            ["234730N", "0552312E"],
            ["235019N", "0551800E"],
            ["241630N", "0552129E"],
            ["242803N", "0552300E"],
          ],
          limit: "9,500 FT AMSL / 2,000 FT AMSL Class : C",
          type: "2,000 FT AMSL / GND Class : G",
        },
        {
          shapeName: "OMDB CTA_X",
          shapeType: "polygon",
          coords: [
            ["254135N", "0550842E"],
            ["252355N", "0545522E"],
            ["252659N", "0544348E"],
            ["254453N", "0545818E"],
          ],
          limit: "8,500 FT AMSL / 1,500 FT AMSL Class: C",
          type: "1,500 FT AMSL / GND Class: G",
        },
        {
          shapeName: "OMRK CTA",
          shapeType: "polygon",
          coords: [
            ["255800N", "0560000E"],
            ["252318N", "0560952E"],
            ["252300N", "0561000E"],
            ["252000N", "0560600E"],
            ["251900N", "0555300E"],
            ["252800N", "0554500E"],
            ["255500N", "0553805E"],
            ["255800N", "0560000E"],
          ],
          limit: "6,500 FT AMSL / 1,500 FT AMSL",
          type: "CLASS: C",
        },
      ];

      const routeMap = {};
      for (const key in routes) {
        const [from, to] = key.split("-");
        if (!routeMap[from]) routeMap[from] = {};
        routeMap[from][to] = routes[key];
      }

      //-----display created route in following colors
      const airwayColors = [
        "#F7663F",
        "#3DA0F1",
        "#52E747",
        "#FBD329",
        "#7373F1",
        "#17F5CB",
        "#F79E3F",
        "#93C3C7",
        "#C2E747",
        "#CD29FB",
      ];

      const extraLatLngs = Object.entries(extraPoints)
        .map(([name, [latDMS, lonDMS]]) => ({
          name,
          lat: convertDMSToDecimal(latDMS),
          lon: convertDMSToDecimal(lonDMS),
        }))
        .filter((pt) => pt.lat !== null && pt.lon !== null);

      // ===================== Geometry / Geo Utilities =====================
      const Geo = {
        R: 6371000, // meters

        toRad(deg) {
          return (deg * Math.PI) / 180;
        },

        toDeg(rad) {
          return (rad * 180) / Math.PI;
        },

        nmToMeters(nm) {
          return nm * 1852;
        },

        // initial bearing from (lat1,lon1) to (lat2,lon2) in degrees 0..360
        bearing(lat1, lon1, lat2, lon2) {
          const dLon = this.toRad(lon2 - lon1);
          const φ1 = this.toRad(lat1);
          const φ2 = this.toRad(lat2);

          const y = Math.sin(dLon) * Math.cos(φ2);
          const x =
            Math.cos(φ1) * Math.sin(φ2) -
            Math.sin(φ1) * Math.cos(φ2) * Math.cos(dLon);

          return (this.toDeg(Math.atan2(y, x)) + 360) % 360;
        },

        // great-circle distance in meters
        haversineMeters(lat1, lon1, lat2, lon2) {
          const dLat = this.toRad(lat2 - lat1);
          const dLon = this.toRad(lon2 - lon1);
          const φ1 = this.toRad(lat1);
          const φ2 = this.toRad(lat2);

          const a =
            Math.sin(dLat / 2) ** 2 +
            Math.cos(φ1) * Math.cos(φ2) * Math.sin(dLon / 2) ** 2;

          return this.R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        },

        haversineNm(lat1, lon1, lat2, lon2) {
          return this.haversineMeters(lat1, lon1, lat2, lon2) / 1852;
        },

        // arc points around a center between start and end points
        arcPoints(
          centerLat,
          centerLon,
          radiusNm,
          startLat,
          startLon,
          endLat,
          endLon,
          clockwise = true,
        ) {
          const radius = this.nmToMeters(radiusNm);

          const lat1 = this.toRad(centerLat);
          const lon1 = this.toRad(centerLon);

          // bearing from center to any point
          const bearingTo = (lat, lon) => {
            const dLon = this.toRad(lon - centerLon);
            const y = Math.sin(dLon) * Math.cos(this.toRad(lat));
            const x =
              Math.cos(lat1) * Math.sin(this.toRad(lat)) -
              Math.sin(lat1) * Math.cos(this.toRad(lat)) * Math.cos(dLon);
            return (Math.atan2(y, x) * 180) / Math.PI;
          };

          const startBearing = bearingTo(startLat, startLon);
          const endBearing = bearingTo(endLat, endLon);

          const normalize = (b) => ((b % 360) + 360) % 360;
          let start = normalize(startBearing);
          let end = normalize(endBearing);

          if (clockwise && end < start) end += 360;
          if (!clockwise && start < end) start += 360;

          const step = 2;
          const latlngs = [];

          for (
            let b = start;
            clockwise ? b <= end : b >= end;
            b += clockwise ? step : -step
          ) {
            const brad = this.toRad(b);

            const lat = Math.asin(
              Math.sin(lat1) * Math.cos(radius / this.R) +
                Math.cos(lat1) * Math.sin(radius / this.R) * Math.cos(brad),
            );

            const lon =
              lon1 +
              Math.atan2(
                Math.sin(brad) * Math.sin(radius / this.R) * Math.cos(lat1),
                Math.cos(radius / this.R) - Math.sin(lat1) * Math.sin(lat),
              );

            latlngs.push([this.toDeg(lat), this.toDeg(lon)]);
          }

          return latlngs;
        },
      };

      // map creation and zoom rate--------------------------
      const map = L.map("map", {
        zoomControl: false,
        attributionControl: true,
        scrollWheelZoom: true,
        wheelPxPerZoomLevel: 100, // <-- Increase this for smoother zoom
        zoomSnap: 0, //  allow fractional zoom
        zoomDelta: 0.3, //  smallest step = 0.1
        doubleClickZoom: false,
      }).setView(latlngs[0], 7);

      let countryOutlineLayer;

      function loadCountryOutlines() {
        if (countryOutlineLayer) return;

        const geo = window.NE_COUNTRIES;
        if (!geo) {
          console.error("NE_COUNTRIES not loaded. Check script include path.");
          return;
        }

        countryOutlineLayer = L.geoJSON(geo, {
          style: {
            color: "pink",
            weight: 0.4,
            fillOpacity: 0,
            opacity: 1,
            interactive: false,
          },
        }).addTo(map);
      }

      let countryOutlinesVisible = true;

      function setCountryOutlinesVisible(visible) {
        countryOutlinesVisible = !!visible;

        if (countryOutlinesVisible) {
          loadCountryOutlines();
          if (countryOutlineLayer && !map.hasLayer(countryOutlineLayer)) {
            countryOutlineLayer.addTo(map);
          }
        } else {
          if (countryOutlineLayer && map.hasLayer(countryOutlineLayer)) {
            map.removeLayer(countryOutlineLayer);
          }
        }
      }

      //text box pane important after map creation-----
      // after map creation
      if (!map.getPane("textPane")) map.createPane("textPane");
      const textPane = map.getPane("textPane");
      textPane.style.zIndex = 10000;
      textPane.style.pointerEvents = "auto";

      // wire toggles for areas----------------------------
      toggleLayerByCheckbox("toggleProhibitated", prohibitated);
      toggleLayerByCheckbox("toggleRestricted", restricted);
      toggleLayerByCheckbox("toggleDanger", danger);
      toggleLayerByCheckbox("toggleTraining", training);
      toggleLayerByCheckbox("toggleCTA", CTA);

      // ----tool manager --------------
      const ToolManager = (() => {
        const tools = {};
        let active = null;

        function register(name, tool) {
          tools[name] = tool;
        }
        function setActive(name) {
          if (active && tools[active]?.onDeactivate)
            tools[active].onDeactivate();
          active = name || null;
          if (active && tools[active]?.onActivate) tools[active].onActivate();
        }

        function dispatch(fn, e) {
          if (!active) return;
          const t = tools[active];
          if (t && typeof t[fn] === "function") return t[fn](e);
        }
        //return { register, setActive, dispatch };
        return { register, setActive, dispatch, getActive: () => active };
      })();

      function dispatchToolEvent(fn, e) {
        const before = ToolManager.getActive?.() || null;

        ToolManager.dispatch(fn, e);

        const after = ToolManager.getActive?.() || null;
        if (after !== before) {
          state.ui.activeTool = after;
          state.ui.cursor = cursorForTool(after);
          syncToolUI();
        }
      }

      map.on("click", (e) => dispatchToolEvent("onClick", e));
      map.on("mousemove", (e) => dispatchToolEvent("onMouseMove", e));
      map.on("contextmenu", (e) => dispatchToolEvent("onRightClick", e));
      map.on("dblclick", (e) => dispatchToolEvent("onDoubleClick", e));
      map.on("mousedown", (e) => dispatchToolEvent("onMouseDown", e));
      map.on("mouseup", (e) => dispatchToolEvent("onMouseUp", e));

      map.on("touchstart", (e) => dispatchToolEvent("onMouseDown", e));
      map.on("touchmove", (e) => dispatchToolEvent("onMouseMove", e));
      map.on("touchend", (e) => dispatchToolEvent("onMouseUp", e));
      map.on("touchcancel", (e) => dispatchToolEvent("onMouseUp", e));

      //--------------draw main FIR boundary------------------------

      let firBoundary = L.polyline(latlngs, {
        color: "yellow",
        weight: 1.2,
        dashArray: "3 3",
      }).addTo(map);

      //=======================state objects------------

      const state = {
        rbl: {
          active: false,
          anchor: null,
          previewLine: null,
          previewTooltip: null,
          objects: [], // [{line, tooltip}]
        },

        measure: {
          points: [],
          line: null,
          preview: null,
          tooltip: null,
          all: [], // [{line, tooltip}]
        },

        pen: {
          active: false,
          drawing: false,
          currentLine: null,
          all: [], // [polyline]
        },

        text: {
          active: false,
          markers: [], // [marker]
        },

        eraser: {
          active: false,
          lastEraseAt: 0,
        },

        ui: {
          activeTool: null,
          cursor: "",
          routePanelOpen: true,
        },
      };

      // danger area toggle helper (checkbox ↔ layerGroup)--------
      function toggleLayerByCheckbox(checkboxId, layerOrGroup) {
        const cb = document.getElementById(checkboxId);
        if (!cb) return;

        const apply = () => {
          if (cb.checked) {
            if (!map.hasLayer(layerOrGroup)) map.addLayer(layerOrGroup);
          } else {
            if (map.hasLayer(layerOrGroup)) map.removeLayer(layerOrGroup);
          }
        };

        cb.addEventListener("change", apply);
        apply(); // initial sync
      }

      //Clear logic helper (remove layers + empty array)
      function clearLayerArray(arr, mapRef = map) {
        if (!Array.isArray(arr)) return [];
        for (const layer of arr) {
          if (layer) mapRef.removeLayer(layer);
        }
        return [];
      }

      function clearLineTooltipArray(arr, mapRef = map) {
        if (!Array.isArray(arr)) return [];
        for (const obj of arr) {
          if (!obj) continue;
          if (obj.line) mapRef.removeLayer(obj.line);
          if (obj.tooltip) mapRef.removeLayer(obj.tooltip);
        }
        return [];
      }

      //Unified “active tool UI” helpers (cursor + button highlight)
      const TOOL_UI = {
        activeBorder: "#FBC965",
        activeColor: "#FBC965",
      };

      function setButtonActive(btn, isActive) {
        if (!btn) return;
        btn.style.borderColor = isActive ? TOOL_UI.activeBorder : "";
        btn.style.color = isActive ? TOOL_UI.activeColor : "";
      }

      function setMapCursor(cursor) {
        map.getContainer().style.cursor = cursor || "";
      }

      //One “wire clear button” helper (super useful)
      function wireClearButton(buttonId, clearFn) {
        const btn = document.getElementById(buttonId);
        if (!btn) return;
        btn.addEventListener("click", clearFn);
      }

      function cursorForTool(toolName) {
        switch (toolName) {
          case "measure":
          case "rbl":
          case "pen":
            return "crosshair";
          case "text":
            return "text";
          default:
            return "";
        }
      }

      // --- UI ONLY --- (DOM TOUCHING) //here
      /* //if checkbox is selected ---map layers -- text color green
            function updateMapLayerButtonState() {
              const btn = document.getElementById("toggleMapLayerBtn");
              if (!btn) return;

              const anyChecked = [
                "mlBorders",
                "mlRunways",
                "mlFixes",
                "mlAwyLabels",
                "mlAirspace",
              ].some((id) => document.getElementById(id)?.checked);

              btn.style.color = anyChecked ? "#b4f59d" : "";
            }
      */
      function syncToolUI() {
        const active = state.ui.activeTool;

        setButtonActive(rblBtn, active === "rbl");
        setButtonActive(measureBtn, active === "measure");
        setButtonActive(penBtn, active === "pen");
        setButtonActive(textBtn, active === "text");

        setMapCursor(state.ui.cursor);
      }

      function syncRoutePanelUI() {
        const routePanel = document.getElementById("routePanel");
        const tooltips = document.getElementById("tooltipContainer");
        const btn = document.getElementById("toggleRoutePanelBtn");
        if (!btn) return;

        const open = !!state.ui.routePanelOpen;

        if (routePanel) routePanel.classList.toggle("is-hidden", !open);
        if (tooltips) tooltips.classList.toggle("is-hidden", !open);

        btn.style.top = "44px";
        btn.style.left = open ? "171px" : "3px";

        btn.classList.toggle("is-open", open);
        btn.classList.toggle("is-closed", !open);

        btn.title = open ? "Collapse Route Panel" : "Expand Route Panel";
        btn.setAttribute("aria-expanded", open ? "true" : "false");
      }

      function applyCoordLabelColor() {
        document.querySelectorAll(".coord-label").forEach((el) => {
          el.style.color = coordLabelColor;
        });
      }
      function applyAirwayColor() {
        airwayLayers.forEach((line) => {
          if (line && line.setStyle) line.setStyle({ color: airwayColor });
        });
      }

      // --- STATE ONLY --- (NO DOM TOUCHING)

      function setRoutePanelOpen(open) {
        state.ui.routePanelOpen = !!open;
      }

      function uiToggleRoutePanel() {
        state.ui.routePanelOpen = !state.ui.routePanelOpen;
        syncRoutePanelUI();
      }

      function setActiveToolState(toolNameOrNull) {
        ToolManager.setActive(toolNameOrNull);

        const active = ToolManager.getActive?.() || null;
        state.ui.activeTool = active;
        state.ui.cursor = cursorForTool(active);

        return active;
      }

      function uiSetActiveTool(toolNameOrNull) {
        setActiveToolState(toolNameOrNull);
        syncToolUI();
      }

      function expandRoute(routeSeq, airwaysDict) {
        const expanded = [];

        for (let i = 0; i < routeSeq.length; i++) {
          const item = routeSeq[i];

          if (airwaysDict[item]) {
            let entry = null;
            let exit = null;

            // Look back for entry point
            for (let j = i - 1; j >= 0; j--) {
              if (!airwaysDict[routeSeq[j]]) {
                entry = routeSeq[j];
                break;
              }
            }

            // Look forward for exit point
            for (let j = i + 1; j < routeSeq.length; j++) {
              if (!airwaysDict[routeSeq[j]]) {
                exit = routeSeq[j];
                break;
              }
            }

            const airway = airwaysDict[item];
            let s = airway.indexOf(entry);
            let e = airway.indexOf(exit);

            if (s !== -1 && e !== -1) {
              let segment = airway.slice(Math.min(s, e), Math.max(s, e) + 1);
              if (s > e) segment.reverse();
              if (expanded.length && expanded.at(-1) === segment[0])
                segment.shift();
              expanded.push(...segment);
            }
          } else {
            if (!expanded.includes(item)) expanded.push(item);
          }
        }
        return expanded;
      }

      //--------polulate route pair buttons based on sectors selected--------------
      function filterRoutes(type) {
        currentRouteFilter = type;
        document
          .querySelectorAll(".filter-btn")
          .forEach((btn) => btn.classList.remove("selected"));
        document
          .querySelector(`.filter-btn[onclick="filterRoutes('${type}')"]`)
          .classList.add("selected");
        populateRouteButtons();
      }

      //-------------------------------------------
      function getSelectedSectors() {
        return Array.from(
          document.querySelectorAll(
            '#sectorOptions input[type="checkbox"]:checked',
          ),
        ).map((cb) => cb.value);
      }

      //--------sector button toggle-show hide checklists--------------

      function toggleSectorPanel() {
        const sectorPanel = document.getElementById("sectorPanel");
        const sectorHeader = document.getElementById("sectorHeader");

        if (sectorVisible) {
          sectorPanel.classList.remove("active");
          sectorHeader.textContent = "Sectors ▸";
        } else {
          sectorPanel.classList.add("active");
          sectorHeader.textContent = "Sectors ▼";
        }

        sectorVisible = !sectorVisible;
      }

      //------populate route pair buttons on the map UI---------------------------------

      function populateRouteButtons() {
        const list = document.getElementById("routeList");
        list.innerHTML = "";

        const selectedSectors = getSelectedSectors();

        const routePairs = [];

        Object.entries(routes).forEach(([key, value]) => {
          const isFRA = key.endsWith("-FRA");

          // Filter logic by route type
          const [from, to] = key.split("-");
          const isArr = to.startsWith("OM");
          const isDep = from.startsWith("OM");
          const isOvf = !isArr && !isDep;

          let matchesType = false;
          if (currentRouteFilter === "FRA") {
            matchesType = isFRA;
          } else if (currentRouteFilter === "Arr") {
            matchesType = isArr && !isFRA;
          } else if (currentRouteFilter === "Dep") {
            matchesType = isDep && !isFRA;
          } else if (currentRouteFilter === "Ovf") {
            matchesType = isOvf && !isFRA;
          }

          if (!matchesType) return;

          //Filter by sector---------------
          if (selectedSectors.length > 0) {
            const routeSectorTags = routeSectors[key] || [];
            const intersects = routeSectorTags.some((tag) =>
              selectedSectors.includes(tag),
            );
            if (!intersects) return;
          }

          const label = isFRA ? key.replace("-FRA", "") : key;
          routePairs.push({ fullKey: key, label });
        });

        routePairs.sort((a, b) => a.label.localeCompare(b.label));

        routePairs.forEach(({ fullKey, label }) => {
          const btn = document.createElement("button");
          btn.textContent = label;
          btn.onclick = () => {
            document
              .querySelectorAll("#routeList button")
              .forEach((b) => b.classList.remove("selected-route"));
            btn.classList.add("selected-route");

            displayExpandedRouteByKey(fullKey);
          };
          list.appendChild(btn);
        });
      }

      //-----------------------------
      function setExtraLabelColor(color) {
        coordLabelColor = color; // optional but keeps state consistent
        extraLabelMarkers.forEach((label) => {
          const el = label.getElement();
          if (el) el.style.color = color;
        });
      }

      //zoom slider------------
      const zoomSlider = document.getElementById("zoomSlider");
      const zoomValue = document.getElementById("zoomValue");

      zoomSlider.addEventListener("input", () => {
        const z = parseFloat(zoomSlider.value);

        map.setZoom(z);

        // display value safely
        zoomValue.textContent = z.toFixed(1);
      });

      //--------------draw main FIR boundary------------------------

      function drawEquilateralTriangle(center, size) {
        const [lat, lon] = center;

        // Convert size (in degrees) to approximate deltas
        const height = size;
        const halfBase = size / Math.sqrt(3); // equilateral triangle rule

        const top = [lat + height / 2, lon];
        const left = [lat - height / 2, lon - halfBase];
        const right = [lat - height / 2, lon + halfBase];

        return L.polygon([top, left, right], {
          color: "grey",
          weight: 1.5,
          fill: false,
        }).addTo(map);
      }

      //----------draw airway lines between points-thin grey line--------------------------

      function drawAirways() {
        if (airwaysDrawn) return;
        airwaysDrawn = true;

        Object.entries(airways).forEach(([routeName, pointNames]) => {
          const latlngs = pointNames
            .map((name) => extraPoints[name])
            .filter((pt) => pt)
            .map((pt) => [
              convertDMSToDecimal(pt[0]),
              convertDMSToDecimal(pt[1]),
            ]);

          if (latlngs.length >= 2) {
            const line = L.polyline(latlngs, {
              color: airwayColor, // ✅ use variable
              weight: 1.3,
              opacity: 0.5,
              interactive: false, // ✅ prevents cursor turning into pointer
            }).addTo(map);

            airwayLayers.push(line); // ✅ store it
          }
        });
      }

      //---------------draw fix triangles----------------------

      function renderTriangles() {
        if (!trianglesVisible) return; //(must exist globally)

        triangleLayers.forEach((layer) => map.removeLayer(layer));
        triangleLayers = [];

        const zoom = map.getZoom();
        const baseSize = 0.05;
        const scale = Math.pow(2, 7 - zoom);
        const size = baseSize * scale;

        extraLatLngs.forEach((pt) => {
          const triangle = drawEquilateralTriangle([pt.lat, pt.lon], size);
          triangleLayers.push(triangle);
        });
      }

      //toggle airspace--------------------------

      function setFirBoundaryVisible(visible) {
        firBoundaryVisible = !!visible;
        if (!firBoundary) return;
        if (firBoundaryVisible) {
          if (!map.hasLayer(firBoundary)) map.addLayer(firBoundary);
        } else {
          if (map.hasLayer(firBoundary)) map.removeLayer(firBoundary);
        }
      }

      function setAirwayLinesVisible(visible) {
        airwayLinesVisible = !!visible;

        if (airwayLinesVisible) {
          if (!airwaysDrawn) drawAirways();
          airwayLayers.forEach((layer) => {
            if (layer && !map.hasLayer(layer)) map.addLayer(layer);
          });
        } else {
          airwayLayers.forEach((layer) => {
            if (layer && map.hasLayer(layer)) map.removeLayer(layer);
          });
        }
      }

      function trianglesZoomHandler() {
        if (trianglesVisible) renderTriangles();
      }

      function setTrianglesVisible(visible) {
        trianglesVisible = !!visible;

        if (trianglesVisible) {
          renderTriangles();
          map.off("zoomend", trianglesZoomHandler);
          map.on("zoomend", trianglesZoomHandler);
        } else {
          map.off("zoomend", trianglesZoomHandler);
          triangleLayers.forEach((layer) => {
            if (layer) map.removeLayer(layer);
          });
          triangleLayers = [];
        }
      }

      function setAirspaceVisible(visible) {
        airspaceVisible = !!visible;
        setFirBoundaryVisible(airspaceVisible);
        setTrianglesVisible(airspaceVisible);
        setAirwayLinesVisible(airspaceVisible);
      }

      //----optimizing code--------
      function expandDynamicShape(shape) {
        const steps = shape.steps;
        const result = [];
        let current = null;

        steps.forEach((step) => {
          if (step.type === "point") {
            const latlng = dmsToLatLng(step.coord[0], step.coord[1]);
            current = latlng;
            result.push(latlng);
          } else if (step.type === "line") {
            const target = dmsToLatLng(step.to[0], step.to[1]);
            current = target;
            result.push(target);
          } else if (step.type === "arc") {
            const center = dmsToLatLng(step.center[0], step.center[1]);
            const to = dmsToLatLng(step.to[0], step.to[1]);
            const arcPts = Geo.arcPoints(
              center[0],
              center[1],
              step.radiusNm,
              current[0],
              current[1],
              to[0],
              to[1],
              step.clockwise,
            );
            result.push(...arcPts);
            current = to;
          }
        });

        // if closed polygon, make sure last = first
        if (shape.closed && result.length > 1) {
          const first = result[0];
          const last = result[result.length - 1];
          if (first[0] !== last[0] || first[1] !== last[1]) {
            result.push(first);
          }
        }

        return result;
      }

      // draw holding patterns ------------------

      function drawHoldingPattern(
        pointName,
        inboundHeadingDeg,
        legLengthNm = 10,
        turn = "right",
        turnRadiusNm = 2,
        limit = "",
      ) {
        const pt = extraPoints[pointName];
        if (!pt) {
          console.warn("Point not found:", pointName);
          return;
        }

        const lat = convertDMSToDecimal(pt[0]);
        const lon = convertDMSToDecimal(pt[1]);
        const fix = L.latLng(lat, lon);

        // Conversion helpers
        const nmToDegLat = 1 / 60;
        const nmToDegLon = (nm, lat) =>
          nm / (60 * Math.cos((lat * Math.PI) / 180));

        // Headings
        const inboundRad = (inboundHeadingDeg * Math.PI) / 180;
        const outboundHeadingDeg = (inboundHeadingDeg + 180) % 360;
        const outboundRad = (outboundHeadingDeg * Math.PI) / 180;

        // Turn direction factor (+1 for right/clockwise, -1 for left/counter-clockwise)
        const dir = turn.toLowerCase() === "right" ? 1 : -1;

        // Arc builder
        function buildArc(center, startAngle, turnDir, radiusNm, steps = 20) {
          const arcPts = [];
          const step = (Math.PI / steps) * turnDir;
          for (let i = 0; i <= steps; i++) {
            const ang = startAngle + i * step;
            const dx = Math.sin(ang) * radiusNm;
            const dy = Math.cos(ang) * radiusNm;
            const la = center.lat + dy * nmToDegLat;
            const lo = center.lng + nmToDegLon(dx, center.lat);
            arcPts.push([la, lo]);
          }
          return arcPts;
        }

        // --- Build racetrack ---

        // 1. First 180° turn at fix
        const perp_offset = turn.toLowerCase() === "right" ? 90 : -90;
        const perpDir = inboundHeadingDeg + perp_offset;
        const perpRad = (perpDir * Math.PI) / 180;

        const northNm = Math.cos(perpRad) * turnRadiusNm;
        const eastNm = Math.sin(perpRad) * turnRadiusNm;

        const centerLat = lat + northNm * nmToDegLat;
        const centerLng = lon + nmToDegLon(eastNm, lat);
        const center = L.latLng(centerLat, centerLng);

        const startAngle = perpRad + Math.PI;
        const firstArc = buildArc(center, startAngle, dir, turnRadiusNm);

        // Arc end = start of outbound leg
        const arcEnd = firstArc[firstArc.length - 1];

        // 2. Outbound leg (reciprocal)
        const northNmOut = Math.cos(outboundRad) * legLengthNm;
        const eastNmOut = Math.sin(outboundRad) * legLengthNm;

        const outboundEndLat = arcEnd[0] + northNmOut * nmToDegLat;
        const outboundEndLng = arcEnd[1] + nmToDegLon(eastNmOut, arcEnd[0]);
        const outboundEnd = [outboundEndLat, outboundEndLng];

        // 3. Second 180° turn
        const perpDir2 = outboundHeadingDeg + perp_offset;
        const perpRad2 = (perpDir2 * Math.PI) / 180;

        const northNm2 = Math.cos(perpRad2) * turnRadiusNm;
        const eastNm2 = Math.sin(perpRad2) * turnRadiusNm;

        const center2Lat = outboundEnd[0] + northNm2 * nmToDegLat;
        const center2Lng = outboundEnd[1] + nmToDegLon(eastNm2, outboundEnd[0]);
        const center2 = L.latLng(center2Lat, center2Lng);

        const startAngle2 = perpRad2 + Math.PI;
        const secondArc = buildArc(center2, startAngle2, dir, turnRadiusNm);

        // 4. Inbound leg → back to fix
        const patternPts = [
          ...firstArc,
          outboundEnd,
          ...secondArc.slice(1),
          [fix.lat, fix.lng],
        ];

        // --- Draw holding race cource pattern line ---
        const holdLine = L.polyline(patternPts, {
          color: "red",
          weight: 2,
          dashArray: "6 4",
        }).addTo(map);
        holdingLayers.push(holdLine);

        // --- hold area marker yellow circle with tooltip ---
        const fixMarker = L.circleMarker(fix, {
          radius: 4,
          color: "yellow",
          weight: 2,
          fillColor: "black",
          fillOpacity: 1,
        })
          .bindTooltip(
            `<b>${pointName}</b> - (${turn})<br>Inbound: ${inboundHeadingDeg}°<br>Outbound: ${outboundHeadingDeg}°<br>
      Limit: ${limit || "N/A"}`,
            {
              permanent: true,
              direction: "top",
              offset: [-40, -40],
              className: "holding-tooltip",
            },
          )
          .addTo(map);
        holdingLayers.push(fixMarker);
        holdingMarkers.push(fixMarker);

        // --- Arrow on outbound leg ---
        const midOutboundLat = (arcEnd[0] + outboundEnd[0]) / 2;
        const midOutboundLng = (arcEnd[1] + outboundEnd[1]) / 2;
        const midOutboundPoint = L.latLng(midOutboundLat, midOutboundLng);

        const arrowRotation = outboundHeadingDeg; // arrow pointing in outbound direction

        const arrowIcon = L.divIcon({
          className: "",
          iconSize: [16, 16],
          iconAnchor: [8, 8],
          html: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
      width="16" height="16"
      style="transform: rotate(${arrowRotation}deg); fill: yellow;">
      <path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/>
      </svg>`,
        });

        // --- Arrow on inbound leg ---
        const arc2End = secondArc[secondArc.length - 1]; // end of 2nd arc
        const inboundMidLat = (arc2End[0] + fix.lat) / 2;
        const inboundMidLng = (arc2End[1] + fix.lng) / 2;
        const inboundMidPoint = L.latLng(inboundMidLat, inboundMidLng);

        const inboundRotation = inboundHeadingDeg; // arrow pointing in inbound direction

        const inboundArrowIcon = L.divIcon({
          className: "",
          iconSize: [16, 16],
          iconAnchor: [8, 8],
          html: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
      width="16" height="16"
      style="transform: rotate(${inboundRotation}deg); fill: yellow;">
      <path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/>
      </svg>`,
        });

        const inboundArrowMarker = L.marker(inboundMidPoint, {
          icon: inboundArrowIcon,
        }).addTo(map);
        holdingLayers.push(inboundArrowMarker);

        const arrowMarker = L.marker(midOutboundPoint, {
          icon: arrowIcon,
        }).addTo(map);
        holdingLayers.push(arrowMarker);
      }

      // Draw/Clear all holdings ------------------------------------------------
      function drawAllHoldings() {
        holdingLibrary.forEach((h) =>
          drawHoldingPattern(h.point, h.heading, h.leg, h.turn, 2, h.limit),
        );
      }

      function clearAllHoldings() {
        holdingLayers.forEach((l) => map.removeLayer(l));
        holdingLayers = [];
        holdingMarkers = [];
      }

      //clear all OMP/R/D training areas when clear button is clicked--------------
      //let drawnAreaLayers = [];
      function clearAreas() {
        const checkboxes = [
          document.getElementById("toggleProhibitated"),
          document.getElementById("toggleRestricted"),
          document.getElementById("toggleDanger"),
          document.getElementById("toggleTraining"),
          document.getElementById("toggleCTA"),
          document.getElementById("toggleDetails"),
        ];
        checkboxes.forEach((checkbox) => {
          checkbox.checked = false;
        });

        // Remove all area layers from the map
        if (prohibitated) map.removeLayer(prohibitated);
        if (restricted) map.removeLayer(restricted);
        if (danger) map.removeLayer(danger);
        if (training) map.removeLayer(training);
        if (CTA) map.removeLayer(CTA);

        // Hide the areaDetailsPanel if it’s visible
        const areaDetailsPanel = document.getElementById("areaDetailsPanel");
        if (areaDetailsPanel) {
          areaDetailsPanel.style.display = "none";
        }
      }

      runwayLayers = []; // Clear existing layers
      for (const [runway, coords] of Object.entries(runwayCoords)) {
        const latlngs = coords.map((coord) => [
          convertDMSToDecimal(coord[0]),
          convertDMSToDecimal(coord[1]),
        ]);
        const polyline = L.polyline(latlngs, {
          color: "#00ADD6", //rwy color
          weight: 1, // Thick line
          dashArray: "4 2",
          opacity: 0.8,
        }).addTo(map);
        runwayLayers.push(polyline);
      }

      // Toggle Runway Lines--------------
      function setRunwaysVisible(visible) {
        runwaysVisible = !!visible;

        runwayLayers.forEach((layer) => {
          if (runwaysVisible) map.addLayer(layer);
          else map.removeLayer(layer);
        });
        /*
              const btn = document.getElementById("toggleRunwaysBtn");
              if (btn) btn.style.color = runwaysVisible ? "#b4f59d" : "#c2c2c0";
      */
      }

      function toggleRunwayLines() {
        setRunwaysVisible(!runwaysVisible);
      }

      // Create layer groups for danger areas ---------
      //draw ares depending upon their physical shapes-circle or polygon or rectangle-------------
      function renderAreas(areaList, layerGroup, color) {
        areaList.forEach((area) => {
          let shape;
          let center;

          switch (area.shapeType) {
            case "circle":
              if (!Array.isArray(area.coords) || area.coords.length !== 2) {
                console.error(`Invalid coords for circle "${area.shapeName}"`);
                return;
              }
              center = dmsToLatLng(...area.coords);
              shape = L.circle(center, {
                radius: Geo.nmToMeters(area.radiusNm),
                color,
                weight: 1,
                fill: true,
                fillOpacity: 0.1,
              }).addTo(layerGroup);
              break;

            case "polygon":
              if (!Array.isArray(area.coords) || area.coords.length < 3) {
                console.error(`Invalid coords for polygon "${area.shapeName}"`);
                return;
              }
              const latlngs = area.coords.map(([lat, lon]) =>
                dmsToLatLng(lat, lon),
              );
              shape = L.polygon(latlngs, {
                color,
                weight: 1,
                fill: true,
                fillOpacity: 0.05,
              }).addTo(layerGroup);
              center = shape.getBounds().getCenter();
              break;

            case "rectangle":
              if (
                !Array.isArray(area.corner1) ||
                !Array.isArray(area.corner2)
              ) {
                console.error(
                  `Invalid corners for rectangle "${area.shapeName}"`,
                );
                return;
              }
              const corner1 = dmsToLatLng(...area.corner1);
              const corner2 = dmsToLatLng(...area.corner2);
              shape = L.rectangle([corner1, corner2], {
                color,
                weight: 1,
                fill: true,
                fillOpacity: 0.05,
              }).addTo(layerGroup);
              center = shape.getBounds().getCenter();
              break;

            case "dynamicShape":
              const latlngsDyn = expandDynamicShape(area);
              if (!latlngsDyn || latlngsDyn.length < 2) {
                console.error(`Invalid dynamicShape "${area.shapeName}"`);
                return;
              }
              shape = area.closed
                ? L.polygon(latlngsDyn, {
                    color,
                    weight: 1.5,
                    fillOpacity: 0.1,
                  })
                : L.polyline(latlngsDyn, { color, weight: 1.5 });
              shape.addTo(layerGroup);
              center = shape.getBounds().getCenter();
              break;

            default:
              console.error(`Unknown shapeType "${area.shapeType}"`);
              return;
          }

          if (center) {
            // Label
            L.marker(center, {
              icon: L.divIcon({
                className: "area-label",
                html: `<div style="color:${color}; font-weight:bold;">${area.shapeName}</div>`,
                iconSize: [0, 0],
              }),
            }).addTo(layerGroup);

            // Tooltip/details on click
            shape.on("click", () => showAreaDetails(area, color));
          }
        });
      }

      renderAreas(prohibitatedAreas, prohibitated, "#FFFF66"); //yellow
      renderAreas(restrictedAreas, restricted, "#FEB476"); //orange
      renderAreas(dangerAreas, danger, "#FFBDFF"); //pink
      renderAreas(trainingAreas, training, "#BDEEEF"); //light blue
      renderAreas(ctaAreas, CTA, "#84ACEC"); //light purple

      //create tooltip- for danger areas variable color-----------
      function showAreaDetails(area, color) {
        if (!document.getElementById("toggleDetails").checked) return;

        const panel = document.getElementById("areaDetailsPanel");
        const nameEl = document.getElementById("areaName");
        const limitEl = document.getElementById("areaLimit");
        const typeEl = document.getElementById("areaType");

        const safeNormalize = (v) =>
          typeof normalize === "function" ? normalize(v) : v;

        const format = (v) =>
          safeNormalize(v ?? "")
            .trim()
            .replace(/\n/g, "<br>")
            .replace(/\s+/g, " ");

        nameEl.textContent = area.shapeName.trim();
        limitEl.innerHTML = format(area.limit);
        typeEl.innerHTML = format(area.type);

        const c = color || "";
        nameEl.style.color = c;
        limitEl.style.color = c;
        typeEl.style.color = c;

        panel.style.display = "block";
      }

      // Layer group for frequency markers
      // Function to add frequency markers to the map
      function addFreqMarkers() {
        freqLayer.clearLayers(); // Clear existing markers before adding new ones
        sectFreq.forEach((freq) => {
          const [lat, lon] = dmsToLatLng(freq.pin[0], freq.pin[1]); // Assuming dmsToLatLng is defined
          let parts = [];
          if (freq.frqName) parts.push(freq.frqName);
          if (freq.condition) parts.push(freq.condition);
          if (freq.freq) parts.push(freq.freq);
          const html = `<div class="freq-label">${parts.join("<br>")}</div>`;
          const marker = L.marker([lat, lon], {
            pane: "popupPane", // puts marker above tooltips
            icon: L.divIcon({
              className: "freq-marker",
              html: html,
              iconSize: [0, 0], // Adjust based on content
            }),
          }).addTo(freqLayer);
        });
        map.addLayer(freqLayer);
      }

      // Function to remove frequency markers from the map
      function removeFreqMarkers() {
        map.removeLayer(freqLayer);
      }

      // airway names toggle--------------------

      Object.entries(airwayLabel).forEach(([name, positions]) => {
        positions.forEach(({ coord, rotate = 0, arrow = "none" }) => {
          const latlng = dmsToLatLng(...coord);

          const tooltip = L.tooltip({
            permanent: true,
            direction: "center",
            offset: [0, 0],
            interactive: true,
            className: "airway-name-tooltip",
          }).setLatLng(latlng).setContent(`
      <div class="airway-name-inner"
      style="transform: rotate(${rotate}deg);">
      ${arrow === "left" ? '<span class="airway-arrow left"></span>' : ""}
      ${name}
      ${arrow === "right" ? '<span class="airway-arrow right"></span>' : ""}
      </div>
      `);
          tooltip.on("click", () => {
            highlightSingleAirway(name);
          });

          airwayLabelLayer.addLayer(tooltip);
        });
      });

      /*
            const airwayBtn = document.getElementById("airwayLabelBtn");

           airwayBtn.addEventListener("click", () => {
              airwayLabelsVisible = !airwayLabelsVisible;

              if (airwayLabelsVisible) {
                airwayLabelLayer.addTo(map);
                airwayBtn.style.color = "#B4F59D";
              } else {
                map.removeLayer(airwayLabelLayer);
                airwayBtn.style.borderColor = "";
                airwayBtn.style.color = "";
              }
            });
      */
      function setAwyLabelsVisible(visible) {
        airwayLabelsVisible = !!visible;

        // const airwayBtn = document.getElementById("airwayLabelBtn");
        if (airwayLabelsVisible) {
          airwayLabelLayer.addTo(map);
          if (airwayBtn) airwayBtn.style.color = "#B4F59D";
        } else {
          map.removeLayer(airwayLabelLayer);
          if (airwayBtn) {
            airwayBtn.style.borderColor = "";
            airwayBtn.style.color = "";
          }
        }
      }
      /*
            function toggleAwyLabels() {
              setAwyLabelsVisible(!airwayLabelsVisible);
            }
      */
      //display coordinates of corss hair on the center of the map-----------

      const centerCoords = document.getElementById("centerCoords");
      L.DomEvent.disableClickPropagation(centerCoords);

      function formatDMS(lat, lon) {
        function toDMS(deg, latlon) {
          const abs = Math.abs(deg);
          const d = Math.floor(abs);
          const m = Math.floor((abs - d) * 60);
          const s = ((abs - d - m / 60) * 3600).toFixed(2);
          if (latlon === "lat") {
            return `${String(d).padStart(2, "0")}${String(m).padStart(
              2,
              "0",
            )}${String(s).padStart(5, "0")} ${deg >= 0 ? "N" : "S"}`;
          } else {
            return `${String(d).padStart(3, "0")}${String(m).padStart(
              2,
              "0",
            )}${String(s).padStart(5, "0")} ${deg >= 0 ? "E" : "W"}`;
          }
        }
        return [
          `"${toDMS(lat, "lat").replace(" ", "")}"`,
          `"${toDMS(lon, "lon").replace(" ", "")}"`,
        ];
      }

      function updateCenterCoords() {
        const center = map.getCenter();
        const [latStr, lonStr] = formatDMS(center.lat, center.lng);
        document.getElementById("centerCoords").value = `${latStr}, ${lonStr}`;
      }

      // Update on move and once at start
      map.on("move", updateCenterCoords);
      updateCenterCoords();

      // ======================= RBL TOOL (FULLY STATE-BASED) =======================

      // ---------- Ensure state shape exists ----------
      state.rbl ??= {
        active: false,
        anchor: null,
        previewLine: null,
        previewTooltip: null,
        objects: [], // [{ line, tooltip }]
      };

      // ---------- Button wiring ----------
      const toggleBtn = document.getElementById("toggleRoutePanelBtn");
      if (toggleBtn) toggleBtn.addEventListener("click", uiToggleRoutePanel);

      syncRoutePanelUI(); // initial render

      // initial render
      syncRoutePanelUI();

      const rblBtn = document.getElementById("rblToolBtn");

      // Toggle RBL tool via ToolManager (single source of truth)
      rblBtn.addEventListener("click", () => {
        uiSetActiveTool(ToolManager.getActive() === "rbl" ? null : "rbl");
      });

      // Clear ALL finalized RBLs (state-based)
      wireClearButton("clearRblBtn", () => {
        state.rbl.objects = clearLineTooltipArray(state.rbl.objects);
      });

      // ---------- Register tool ----------
      ToolManager.register("rbl", {
        onActivate() {
          const r = state.rbl;
          r.active = true;
          r.anchor = null;

          // Clean any stale preview
          removeRblPreview();
        },

        onDeactivate() {
          state.rbl.active = false;
          state.rbl.anchor = null;
          removeRblPreview();
        },

        // Right-click cancels in-progress (before finalizing)
        onRightClick(e) {
          const r = state.rbl;
          if (!r.active) return;

          // Only cancel if we are mid-draw (anchor exists)
          if (!r.anchor) return;

          // Cancel preview + reset anchor
          removeRblPreview();
          r.anchor = null;
        },

        onClick(e) {
          const r = state.rbl;
          if (!r.active) return;

          // 1st click: set anchor + start preview
          if (!r.anchor) {
            r.anchor = e.latlng;

            r.previewLine = L.polyline([r.anchor], {
              color: "white",
              weight: 1,
              dashArray: "4 4",
              interactive: false,
            }).addTo(map);

            r.previewTooltip = L.tooltip({
              permanent: false,
              direction: "top",
              offset: [10, -10],
              className: "rbl-tooltip",
            })
              .setLatLng(r.anchor)
              .setContent("—/—")
              .addTo(map);

            return;
          }

          // 2nd click: finalize
          const end = e.latlng;

          const brg = Geo.bearing(r.anchor.lat, r.anchor.lng, end.lat, end.lng);
          const distNm = Geo.haversineNm(
            r.anchor.lat,
            r.anchor.lng,
            end.lat,
            end.lng,
          );

          const radial = Math.round(brg).toString().padStart(3, "0");
          const dme = Math.round(distNm).toString().padStart(3, "0");

          const finalLine = L.polyline([r.anchor, end], {
            color: "lime",
            weight: 1.5,
            interactive: false,
          }).addTo(map);

          const twoThirdPoint = L.latLng(
            (r.anchor.lat + 3 * end.lat) / 4,
            (r.anchor.lng + 3 * end.lng) / 4,
          );

          const finalTooltip = L.tooltip({
            permanent: true,
            direction: "top",
            offset: [0, 0],
            className: "rbl-tooltip",
          })
            .setLatLng(twoThirdPoint)
            .setContent(`${radial} / ${dme}`)
            .addTo(map);

          r.objects.push({ line: finalLine, tooltip: finalTooltip });

          // Reset for next RBL
          removeRblPreview();
          r.anchor = null;
        },

        onMouseMove(e) {
          const r = state.rbl;
          if (!r.active || !r.anchor || !r.previewLine || !r.previewTooltip)
            return;

          r.previewLine.setLatLngs([r.anchor, e.latlng]);

          const brg = Geo.bearing(
            r.anchor.lat,
            r.anchor.lng,
            e.latlng.lat,
            e.latlng.lng,
          );
          const distNm = Geo.haversineNm(
            r.anchor.lat,
            r.anchor.lng,
            e.latlng.lat,
            e.latlng.lng,
          );

          const radial = Math.round(brg).toString().padStart(3, "0");
          const dme = Math.round(distNm).toString().padStart(3, "0");

          r.previewTooltip.setLatLng(e.latlng).setContent(`${radial} / ${dme}`);
        },
      });

      // ---------- Helpers ----------
      function removeRblPreview() {
        const r = state.rbl;
        if (r.previewLine) {
          map.removeLayer(r.previewLine);
          r.previewLine = null;
        }
        if (r.previewTooltip) {
          map.removeLayer(r.previewTooltip);
          r.previewTooltip = null;
        }
      }

      // ======================= MULTI-POINT MEASURE (STATE-BASED) =======================
      const measureBtn = document.getElementById("measureBtn");

      wireClearButton("clearMeasuresBtn", () => {
        state.measure.all = clearLineTooltipArray(state.measure.all);
        resetMeasure(); // clears in-progress
      });

      measureBtn.addEventListener("click", () => {
        uiSetActiveTool(
          ToolManager.getActive() === "measure" ? null : "measure",
        );
      });

      // Register MEASURE tool
      ToolManager.register("measure", {
        onActivate() {
          // optional: prevent dblclick zoom while measuring
          if (map.doubleClickZoom) map.doubleClickZoom.disable();
        },

        onDeactivate() {
          // IMPORTANT: stop any in-progress measure cleanly
          resetMeasure();

          // optional: restore dblclick zoom
          if (map.doubleClickZoom) map.doubleClickZoom.enable();
        },

        onDoubleClick(e) {
          // finalize measurement if we have at least 2 points
          if (!measurePoints || measurePoints.length < 2) return;
          finalizeMeasure();
        },

        onClick(e) {
          const m = state.measure;
          const latlng = e.latlng;

          m.points.push(latlng);

          if (!m.line) {
            m.line = L.polyline([latlng], {
              color: "orange",
              weight: 1.5,
              interactive: false,
            }).addTo(map);
          } else {
            m.line.addLatLng(latlng);
          }

          // Remove old preview when a point is fixed
          if (m.preview) {
            map.removeLayer(m.preview);
            m.preview = null;
          }

          updateMeasureTooltip(); // confirmed-only so far (same as your code)
        },

        onMouseMove(e) {
          const m = state.measure;
          if (m.points.length === 0) return;

          const latlngs = [...m.points, e.latlng];

          if (!m.preview) {
            m.preview = L.polyline(latlngs, {
              color: "white",
              weight: 1,
              dashArray: "4 4",
              interactive: false,
            }).addTo(map);
          } else {
            m.preview.setLatLngs(latlngs);
          }

          // EXACT same behavior: tooltip shows predicted total while moving
          updateMeasureTooltip(e.latlng);
        },

        // right click = cancel if 1 point, finalize if >=2 (same behavior you had)
        onRightClick() {
          const m = state.measure;
          if (m.points.length < 2) {
            resetMeasure();
            return;
          }
          finalizeMeasure();
        },

        // double click finalize (same as before)
        onDoubleClick() {
          const m = state.measure;
          if (m.points.length < 2) return;
          finalizeMeasure();
        },
      });

      function resetMeasure() {
        const m = state.measure;

        if (m.line) {
          map.removeLayer(m.line);
          m.line = null;
        }
        if (m.tooltip) {
          map.removeLayer(m.tooltip);
          m.tooltip = null;
        }
        if (m.preview) {
          map.removeLayer(m.preview);
          m.preview = null;
        }
        m.points = [];
      }

      function updateMeasureTooltip(previewEnd = null) {
        const m = state.measure;

        // Calculate total distance
        let totalMeters = 0;
        const pts = [...m.points];
        if (previewEnd) pts.push(previewEnd);

        for (let i = 1; i < pts.length; i++) {
          totalMeters += pts[i - 1].distanceTo(pts[i]);
        }
        const totalNm = (totalMeters / 1852).toFixed(1);

        // Place tooltip 2/3 along the path instead of halfway
        const targetDistance = totalMeters * (5 / 6);
        let traveled = 0;
        let midPoint = pts[0];

        for (let i = 1; i < pts.length; i++) {
          const segDist = pts[i - 1].distanceTo(pts[i]);
          if (traveled + segDist >= targetDistance) {
            const ratio = (targetDistance - traveled) / segDist;
            const lat = pts[i - 1].lat + ratio * (pts[i].lat - pts[i - 1].lat);
            const lng = pts[i - 1].lng + ratio * (pts[i].lng - pts[i - 1].lng);
            midPoint = L.latLng(lat, lng);
            break;
          }
          traveled += segDist;
        }

        if (!m.tooltip) {
          m.tooltip = L.tooltip({
            permanent: true,
            direction: "top",
            offset: [0, 0],
            className: "measure-tooltip",
          })
            .setLatLng(midPoint)
            .setContent(`${totalNm} Nm`)
            .addTo(map);
        } else {
          m.tooltip.setLatLng(midPoint).setContent(`${totalNm} Nm`);
        }
      }

      function finalizeMeasure() {
        const m = state.measure;

        if (m.line && m.tooltip) {
          // Distance should only be based on confirmed points
          let totalMeters = 0;
          for (let i = 1; i < m.points.length; i++) {
            totalMeters += m.points[i - 1].distanceTo(m.points[i]);
          }
          const totalNm = (totalMeters / 1852).toFixed(1);

          // Recompute tooltip position on finalized line only
          const targetDistance = totalMeters * (5 / 6);
          let traveled = 0;
          let midPoint = m.points[0];

          for (let i = 1; i < m.points.length; i++) {
            const segDist = m.points[i - 1].distanceTo(m.points[i]);
            if (traveled + segDist >= targetDistance) {
              const ratio = (targetDistance - traveled) / segDist;
              const lat =
                m.points[i - 1].lat +
                ratio * (m.points[i].lat - m.points[i - 1].lat);
              const lng =
                m.points[i - 1].lng +
                ratio * (m.points[i].lng - m.points[i - 1].lng);
              midPoint = L.latLng(lat, lng);
              break;
            }
            traveled += segDist;
          }

          m.tooltip.setLatLng(midPoint).setContent(`${totalNm} Nm`);

          m.all.push({ line: m.line, tooltip: m.tooltip });
        }

        // Reset active drawing
        m.line = null;
        m.tooltip = null;
        if (m.preview) {
          map.removeLayer(m.preview);
          m.preview = null;
        }
        m.points = [];
      }

      // ======================= PEN / FREEFORM (STATE-BASED) =======================

      // Ensure state exists (matches your state object)
      state.pen ??= {
        active: false,
        drawing: false,
        currentLine: null,
        all: [],
      };

      // Pen button toggles ToolManager
      penBtn.addEventListener("click", () => {
        uiSetActiveTool(ToolManager.getActive() === "pen" ? null : "pen");
      });

      // Clear Pen
      wireClearButton("clearPenBtn", () => {
        state.pen.all = clearLayerArray(state.pen.all);
        state.pen.drawing = false;
        state.pen.currentLine = null;
      });

      const mapEl = map.getContainer();

      let lastRightClickTime = 0;
      const DBL_CLICK_MS = 300;

      mapEl.addEventListener(
        "mousedown",
        (e) => {
          // Right mouse only
          if (e.button !== 2) return;

          const now = performance.now();

          if (now - lastRightClickTime < DBL_CLICK_MS) {
            // Right-button double click detected
            uiSetActiveTool(ToolManager.getActive() === "pen" ? null : "pen");

            lastRightClickTime = 0;
            e.preventDefault();
          } else {
            lastRightClickTime = now;
          }
        },
        { passive: false },
      );

      ToolManager.register("pen", {
        onActivate() {
          const p = state.pen;
          p.active = true;
          p.drawing = false;
          p.currentLine = null;

          const mapContainer = map.getContainer();

          // Disable gestures that conflict with drawing
          map.doubleClickZoom.disable();
          map.scrollWheelZoom.disable();
          mapContainer.style.touchAction = "none";

          // ---- helpers ----
          const touchLatLng = (ev) => {
            const t = ev.touches?.[0] || ev.changedTouches?.[0];
            return t ? map.mouseEventToLatLng(t) : null;
          };

          const startDrawAt = (latlng) => {
            if (!latlng) return;

            p.drawing = true;
            p.currentLine = L.polyline([latlng], {
              color: "red",
              weight: 1.5,
              opacity: 0.9,
              interactive: false,
            }).addTo(map);

            p.all.push(p.currentLine);
          };

          const addPointAt = (latlng) => {
            if (!latlng || !p.currentLine) return;
            p.currentLine.addLatLng(latlng);
          };

          const endDraw = () => {
            p.drawing = false;
            p.currentLine = null;
            if (p.active) map.dragging.enable();
          };

          // ---- MOUSE (PC) ----
          p._mouseDownHandler = (ev) => {
            if (!state.pen.active) return;
            if (ev.button !== 0) return; // left click only
            map.dragging.disable();
          };

          p._mouseUpHandler = () => {
            if (!state.pen.active) return;
            map.dragging.enable();
          };

          mapContainer.addEventListener("mousedown", p._mouseDownHandler);
          mapContainer.addEventListener("mouseup", p._mouseUpHandler);

          // ---- TOUCH (iPad) - capture BEFORE Leaflet ----
          p._touchStart = (ev) => {
            if (!state.pen.active) return;

            // allow 2-finger pan/zoom gestures
            if (ev.touches && ev.touches.length > 1) return;

            ev.preventDefault();
            ev.stopPropagation();

            map.dragging.disable();
            startDrawAt(touchLatLng(ev));
          };

          p._touchMove = (ev) => {
            if (!state.pen.active || !p.drawing) return;

            if (ev.touches && ev.touches.length > 1) return;

            ev.preventDefault();
            ev.stopPropagation();

            addPointAt(touchLatLng(ev));
          };

          p._touchEnd = (ev) => {
            if (!state.pen.active) return;

            ev.preventDefault();
            ev.stopPropagation();

            endDraw();
          };

          // IMPORTANT: passive:false + capture:true is what makes iOS obey preventDefault
          mapContainer.addEventListener("touchstart", p._touchStart, {
            passive: false,
            capture: true,
          });
          mapContainer.addEventListener("touchmove", p._touchMove, {
            passive: false,
            capture: true,
          });
          mapContainer.addEventListener("touchend", p._touchEnd, {
            passive: false,
            capture: true,
          });
          mapContainer.addEventListener("touchcancel", p._touchEnd, {
            passive: false,
            capture: true,
          });
        },

        onDeactivate() {
          const p = state.pen;
          p.active = false;
          p.drawing = false;
          p.currentLine = null;

          const mapContainer = map.getContainer();

          // restore container touch behavior
          mapContainer.style.touchAction = "";

          // remove mouse listeners
          if (p._mouseDownHandler) {
            mapContainer.removeEventListener("mousedown", p._mouseDownHandler);
            p._mouseDownHandler = null;
          }
          if (p._mouseUpHandler) {
            mapContainer.removeEventListener("mouseup", p._mouseUpHandler);
            p._mouseUpHandler = null;
          }

          // remove touch listeners (must match capture:true)
          if (p._touchStart) {
            mapContainer.removeEventListener("touchstart", p._touchStart, {
              capture: true,
            });
            mapContainer.removeEventListener("touchmove", p._touchMove, {
              capture: true,
            });
            mapContainer.removeEventListener("touchend", p._touchEnd, {
              capture: true,
            });
            mapContainer.removeEventListener("touchcancel", p._touchEnd, {
              capture: true,
            });
            p._touchStart = p._touchMove = p._touchEnd = null;
          }

          // restore map interactions
          map.dragging.enable();
          map.doubleClickZoom.enable();
          map.scrollWheelZoom.enable();
        },

        // Still used for PC drawing path (ToolManager dispatch)
        onMouseDown(e) {
          const p = state.pen;
          if (!p.active) return;

          const oe = e.originalEvent;

          // Mouse only here (touch is handled via container touch listeners)
          const isLeftMouse = oe?.button === 0 || oe?.buttons === 1;
          if (!isLeftMouse) return;

          map.dragging.disable();
          if (oe?.cancelable) oe.preventDefault();

          p.drawing = true;
          p.currentLine = L.polyline([e.latlng], {
            color: "red",
            weight: 1.5,
            opacity: 0.9,
            interactive: false,
          }).addTo(map);

          p.all.push(p.currentLine);
        },

        onMouseMove(e) {
          const p = state.pen;
          if (!p.active || !p.drawing || !p.currentLine) return;

          const oe = e.originalEvent;
          if (oe?.cancelable) oe.preventDefault();

          p.currentLine.addLatLng(e.latlng);
        },

        onMouseUp(e) {
          const p = state.pen;
          if (!p.active) return;

          p.drawing = false;
          p.currentLine = null;

          map.dragging.enable();
        },
      });

      // ======================= TEXT BOX TOOL (FULLY STATE-BASED) =======================

      const textBtn = document.getElementById("textToolBtn");

      // Ensure state shape exists (matches your state object)
      state.text ??= {
        active: false,
        markers: [], // [marker]
      };

      // Toggle text tool using ToolManager
      textBtn.addEventListener("click", () => {
        uiSetActiveTool(ToolManager.getActive() === "text" ? null : "text");
      });
      // Clear all text boxes (state-based)
      wireClearButton("clearTextBtn", () => {
        state.text.markers = clearLayerArray(state.text.markers);
      });

      // Register tool
      ToolManager.register("text", {
        onActivate() {
          state.text.active = true;
        },

        onDeactivate() {
          state.text.active = false;
        },

        // Place text box on map click
        onClick(e) {
          if (!state.text.active) return;

          // --- container for textarea + close button ---
          const container = document.createElement("div");
          container.className = "text-box-container";

          const textarea = document.createElement("textarea");
          textarea.className = "text-box";
          textarea.placeholder = "Type here…";

          const closeBtn = document.createElement("div");
          closeBtn.className = "text-box-close";
          closeBtn.innerHTML = "×";

          container.appendChild(closeBtn);
          container.appendChild(textarea);

          const marker = L.marker(e.latlng, {
            pane: "textPane",
            draggable: true, // drag anywhere
            interactive: true,
            icon: L.divIcon({
              className: "text-marker",
              html: container,
              iconSize: null,
            }),
          }).addTo(map);

          // store marker in state
          state.text.markers.push(marker);

          // prevent close click from triggering map/tool stuff + prevent starting a drag from the X
          closeBtn.addEventListener("mousedown", (ev) => ev.stopPropagation());
          closeBtn.addEventListener("click", (ev) => {
            ev.stopPropagation();

            map.removeLayer(marker);
            state.text.markers = state.text.markers.filter((m) => m !== marker);
          });

          // (optional) stop click bubbling so clicking inside textbox doesn't place another one / trigger tools
          container.addEventListener("click", (ev) => ev.stopPropagation());
          container.addEventListener("dblclick", (ev) => ev.stopPropagation());
          container.addEventListener("contextmenu", (ev) =>
            ev.stopPropagation(),
          );

          // focus input
          setTimeout(() => textarea.focus(), 0);

          // auto-disable after one placement
          uiSetActiveTool(null);
        },
      });

      // ------------------------ UNIVERSAL ERASER (STATE-BASED) ------------------------

      state.eraser ??= { active: false, lastEraseAt: 0 };

      const ERASE_INTERVAL_MS = 35;
      const ERASE_RADIUS_PX = 10;

      function isTypingInTextBox() {
        const el = document.activeElement;
        return el && (el.tagName === "TEXTAREA" || el.isContentEditable);
      }

      function restoreCursorAfterEraser() {
        const activeTool = ToolManager.getActive?.() || null;
        setMapCursor(cursorForTool(activeTool));
      }

      // Prevent browser context menu while erasing
      map.getContainer().addEventListener("contextmenu", (e) => {
        if (state.eraser.active) e.preventDefault();
      });

      // Right mouse DOWN = start eraser
      map.getContainer().addEventListener("mousedown", (e) => {
        if (e.button !== 2) return; // right only
        if (isTypingInTextBox()) return;

        state.eraser.active = true;

        e.preventDefault();
        e.stopPropagation();
      });

      // Right mouse UP = stop eraser
      window.addEventListener("mouseup", (e) => {
        if (e.button !== 2) return;

        state.eraser.active = false;
        restoreCursorAfterEraser();

        e.preventDefault();
      });

      // Erase while moving
      map.on("mousemove", (e) => {
        if (!state.eraser.active) return;
        if (isTypingInTextBox()) return;

        const now = performance.now();
        if (now - state.eraser.lastEraseAt < ERASE_INTERVAL_MS) return;
        state.eraser.lastEraseAt = now;

        const cursorPoint = map.latLngToContainerPoint(e.latlng);

        // --- 1) PEN: state.pen.all = [polyline]
        state.pen.all = erasePolylinesNearCursor(state.pen.all, cursorPoint);

        // --- 2) MEASURE: state.measure.all = [{ line, tooltip }]
        state.measure.all = eraseLineTooltipObjectsNearCursor(
          state.measure.all,
          cursorPoint,
        );

        // --- 3) RBL: state.rbl.objects = [{ line, tooltip }]
        state.rbl.objects = eraseLineTooltipObjectsNearCursor(
          state.rbl.objects,
          cursorPoint,
        );

        // --- 4) TEXT: state.text.markers = [marker]
        state.text.markers = eraseMarkersNearCursor(
          state.text.markers,
          cursorPoint,
        );
      });

      // -------------------- helpers --------------------

      function polylineCloseToCursor(polyline, cursorPoint) {
        const latlngs = polyline.getLatLngs();
        return latlngs.some((latlng) => {
          const pt = map.latLngToContainerPoint(latlng);
          return pt.distanceTo(cursorPoint) <= ERASE_RADIUS_PX;
        });
      }

      function erasePolylinesNearCursor(polylines, cursorPoint) {
        return polylines.filter((polyline) => {
          if (!polyline) return false;

          const close = polylineCloseToCursor(polyline, cursorPoint);
          if (close) {
            map.removeLayer(polyline);
            return false;
          }
          return true;
        });
      }

      function eraseLineTooltipObjectsNearCursor(objects, cursorPoint) {
        return objects.filter((obj) => {
          const line = obj?.line;
          const tooltip = obj?.tooltip;

          if (!line) return true;

          const close = polylineCloseToCursor(line, cursorPoint);
          if (close) {
            map.removeLayer(line);
            if (tooltip) map.removeLayer(tooltip);
            return false;
          }
          return true;
        });
      }

      function eraseMarkersNearCursor(markers, cursorPoint) {
        return markers.filter((m) => {
          if (!m) return false;
          const pt = map.latLngToContainerPoint(m.getLatLng());
          const close = pt.distanceTo(cursorPoint) <= ERASE_RADIUS_PX;
          if (close) {
            map.removeLayer(m);
            return false;
          }
          return true;
        });
      }

      // -----------Function to render sector info table from sectorData---------------------

      function renderSectorTable() {
        const tbody = document.querySelector("#sectorTable tbody");
        tbody.innerHTML = ""; // clear old rows

        sectorData.forEach((row) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
      <td>${row.sector}</td>
      <td>${row.limit}</td>
      <td>${row.freq}</td>
      `;
          tbody.appendChild(tr);
        });
      }
      // Call once on load
      renderSectorTable();

      // --- Table toggle logic ---
      const toggleTableBtn = document.getElementById("toggleTableBtn");
      const sectorTablePanel = document.getElementById("sectorTablePanel");

      // Configurable offset for panel position (px)
      const sectorPanelOffset = { x: -126, y: 5 };
      // Change these values to move panel around (e.g., {x:20, y:10})

      toggleTableBtn.addEventListener("click", function () {
        if (
          sectorTablePanel.style.display === "none" ||
          sectorTablePanel.style.display === ""
        ) {
          // Position relative to button with custom offset
          const rect = toggleTableBtn.getBoundingClientRect();
          sectorTablePanel.style.position = "absolute";
          sectorTablePanel.style.left = rect.left + sectorPanelOffset.x + "px";
          sectorTablePanel.style.top =
            rect.bottom + window.scrollY + sectorPanelOffset.y + "px";

          sectorTablePanel.style.display = "block";
          this.textContent = "Sector Info ▼";
        } else {
          sectorTablePanel.style.display = "none";
          this.textContent = "Sector Info ▸";
        }
      });

      // --- Make sector Info table (mouse + touch drag) -------------------------------------

      function makeDraggable(element) {
        if (!element) return;

        let isDragging = false;
        let startX = 0,
          startY = 0;
        let baseX = 0,
          baseY = 0; // committed translation
        let nextX = 0,
          nextY = 0; // pending translation
        let rafPending = false;

        element.style.willChange = "transform";
        element.style.touchAction = "none"; // prevents scroll during touch drag

        function clientXY(e) {
          if (e.touches && e.touches[0])
            return { x: e.touches[0].clientX, y: e.touches[0].clientY };
          return { x: e.clientX, y: e.clientY };
        }

        function apply() {
          rafPending = false;
          element.style.transform = `translate3d(${nextX}px, ${nextY}px, 0)`;
        }

        function onDrag(e) {
          if (!isDragging) return;
          if (e.cancelable) e.preventDefault();

          const { x, y } = clientXY(e);
          nextX = baseX + (x - startX);
          nextY = baseY + (y - startY);

          if (!rafPending) {
            rafPending = true;
            requestAnimationFrame(apply);
          }
        }

        function stopDrag() {
          if (!isDragging) return;
          isDragging = false;

          baseX = nextX;
          baseY = nextY;

          document.removeEventListener("mousemove", onDrag);
          document.removeEventListener("mouseup", stopDrag);
          document.removeEventListener("touchmove", onDrag);
          document.removeEventListener("touchend", stopDrag);
        }

        function startDrag(e) {
          isDragging = true;
          if (e.cancelable) e.preventDefault();

          const { x, y } = clientXY(e);
          startX = x;
          startY = y;

          document.addEventListener("mousemove", onDrag, { passive: false });
          document.addEventListener("mouseup", stopDrag);
          document.addEventListener("touchmove", onDrag, { passive: false });
          document.addEventListener("touchend", stopDrag);
        }

        element.addEventListener("mousedown", startDrag);
        element.addEventListener("touchstart", startDrag, { passive: false });
      }

      // Enable drag on sectorTablePanel
      makeDraggable(document.getElementById("sectorTablePanel"));

      Object.entries(extraPoints).forEach(([name, [latDMS, lonDMS]]) => {
        const lat = convertDMSToDecimal(latDMS);
        const lon = convertDMSToDecimal(lonDMS);

        if (lat !== null && lon !== null) {
          const label = L.tooltip({
            permanent: true,
            direction: "top",
            offset: [7, -1],
            className: "coord-label",
          })
            .setLatLng([lat, lon])
            .setContent(name)
            .addTo(map);

          extraLabelMarkers.push(label);
        }
      });

      // set color ONCE after labels exist
      setExtraLabelColor(coordLabelColor || "white");

      requestAnimationFrame(() => {
        extraLabelMarkers.forEach((label) => {
          const el = label.getElement();
          if (el) el.style.opacity = coordsVisible ? "1" : "0";
        });
      });

      //--- highlight sectors with their sector letters--------------
      function drawSector(code, options = {}) {
        if (!sectorPolygons[code] || sectorLayers[code]) return;

        const color = sectorColors[code] || "orange";
        const fillOpacity = options.fillOpacity ?? 0.25;

        const polygon = L.polygon(sectorPolygons[code], {
          color,
          weight: 1.5,
          dashArray: "3 6",
          fillColor: color,
          fillOpacity,
          opacity: 0.3,
        }).addTo(map);

        let centerLat, centerLng;

        // Prefer manual label coordinate if you provided one
        if (sectorLabelCoords[code]) {
          const [latDMS, lonDMS] = sectorLabelCoords[code];
          centerLat = convertDMSToDecimal(latDMS);
          centerLng = convertDMSToDecimal(lonDMS);
        } else {
          // fallback: simple average of polygon vertices (your current behavior)
          let sumLat = 0,
            sumLng = 0;
          sectorPolygons[code].forEach(([lat, lng]) => {
            sumLat += lat;
            sumLng += lng;
          });
          centerLat = sumLat / sectorPolygons[code].length;
          centerLng = sumLng / sectorPolygons[code].length;
        }

        const label = L.tooltip({
          permanent: true,
          direction: "center",
          className: "sector-label",
          offset: [0, 0],
        })
          .setLatLng([centerLat, centerLng])
          .setContent(code)
          .addTo(map);

        sectorLayers[code] = { polygon, label };
      }

      //---highlight sectos with color when check box ticked
      function removeSector(code) {
        if (!sectorLayers[code]) return;
        map.removeLayer(sectorLayers[code].polygon);
        map.removeLayer(sectorLayers[code].label);
        delete sectorLayers[code];
      }

      //--------------draw colored route line on map----------------------

      function expandRouteWithAirwaySegments(routeSeq, airwaysDict) {
        const airwaySegments = [];
        const dctSegments = [];

        let i = 0;
        while (i < routeSeq.length) {
          const item = routeSeq[i];

          if (item === "DCT") {
            const from = routeSeq[i - 1];
            const to = routeSeq[i + 1];
            if (from && to) {
              dctSegments.push({ from, to });
            }
            i++;
            continue;
          }

          if (airwaysDict[item]) {
            const entry = routeSeq[i - 1];
            const exit = routeSeq[i + 1];
            const airway = airwaysDict[item];

            const s = airway.indexOf(entry);
            const e = airway.indexOf(exit);
            if (s !== -1 && e !== -1) {
              let path = airway.slice(Math.min(s, e), Math.max(s, e) + 1);
              if (s > e) path.reverse();
              airwaySegments.push({ points: path, airway: item });
            }
            i++;
          } else {
            i++;
          }
        }

        return { airwaySegments, dctSegments };
      }
      // ===== SIDs 12_13 drawing =====
      const sidLayerGroup = L.layerGroup().addTo(map);
      const sidDrawn = new Map(); // key: checkboxId -> Leaflet polyline

      // store current route start fix (first point of the selected route)
      state.currentRouteFirstFix ??= null;

      //----SID recenter helper ------------------
      function fitRouteAndSids() {
        let b = null;

        // include the route if it exists
        if (lastRouteBounds) b = L.latLngBounds(lastRouteBounds);

        // include all drawn SIDs
        sidLayerGroup.eachLayer((layer) => {
          if (layer && layer.getBounds) {
            b = b ? b.extend(layer.getBounds()) : layer.getBounds();
          }
        });

        if (!b) return;

        map.flyToBounds(b, { padding: [60, 60], maxZoom: 9.1, duration: 0.4 });
      }

      //----SID draw helper ------------------
      function getFixLatLngByName(name) {
        // 1) SID library points first
        if (typeof SidStar !== "undefined" && SidStar[name]) {
          return dmsToLatLng(SidStar[name][0], SidStar[name][1]);
        }

        // 2) fallback to your existing extraPoints (route/fixes db)
        if (typeof extraPoints !== "undefined" && extraPoints[name]) {
          const pt = extraPoints[name];
          return [convertDMSToDecimal(pt[0]), convertDMSToDecimal(pt[1])];
        }

        return null;
      }

      function getSidPrefixFromCheckbox(cb) {
        // names checkbox like "AA 13, AD 13, DB 12, SJ 12"
        const label = cb.closest("label");
        const txt = (label?.textContent || cb.value || cb.id || "")
          .trim()
          .toUpperCase();
        // expects "AA 13" / "AD 13" / "DB 12" / "SJ 12"
        const parts = txt.split(/\s+/); // ["AA","13"]
        const code = parts[0] || "";
        const rwy = parts[1] || "";
        return rwy ? `${code}_${rwy}` : code; // "AA_13"
      }

      function drawSidForCheckbox(cb) {
        if (!cb.checked) return;

        const firstFix = state.currentRouteFirstFix;
        if (!firstFix) return;

        const prefix = getSidPrefixFromCheckbox(cb);
        const sidKey = `${firstFix}_${prefix}`; // e.g. DAXIB_AA

        if (typeof sid12_13 === "undefined" || !sid12_13[sidKey]) return;

        const names = sid12_13[sidKey]; // ["AA836","PATAM",...,"DAXIB"]
        const latlngs = names.map(getFixLatLngByName).filter(Boolean);

        if (latlngs.length < 2) return;

        // remove old if exists
        if (sidDrawn.has(cb.id)) {
          sidLayerGroup.removeLayer(sidDrawn.get(cb.id));
          sidDrawn.delete(cb.id);
        }

        const line = L.polyline(latlngs, {
          color: "#FCFBBB",
          weight: 1.7,
          dashArray: "10 10",
          opacity: 0.85,
        });
        line.addTo(sidLayerGroup);
        sidDrawn.set(cb.id, line);
        fitRouteAndSids();
      }

      function clearSidForCheckbox(cb) {
        const line = sidDrawn.get(cb.id);
        if (line) sidLayerGroup.removeLayer(line);
        sidDrawn.delete(cb.id);
      }

      function refreshAllCheckedSids() {
        // 1) Clear all previously drawn SIDs (route changed → old SID lines must go)
        sidLayerGroup.clearLayers();
        sidDrawn.clear();

        const firstFix = state.currentRouteFirstFix;
        if (!firstFix) return;

        // 2) Redraw only those checked SIDs that exist for this route
        document
          .querySelectorAll('#sid12Checkboxes input[type="checkbox"]')
          .forEach((cb) => {
            if (!cb.checked) return;

            const prefix = getSidPrefixFromCheckbox(cb); // now returns like "AA_13"
            const sidKey = `${firstFix}_${prefix}`; // e.g. "DAXIB_AA_13"

            // If no SID exists for this route+SID → don't draw anything
            if (typeof sid12_13 === "undefined" || !sid12_13[sidKey]) {
              // optional: auto-uncheck to show user it's not available
              // cb.checked = false;
              return;
            }

            drawSidForCheckbox(cb); // draws + stores in sidDrawn + can recenter
          });
      }

      function setupSid12UI() {
        // wire checkbox changes
        document
          .querySelectorAll('#sid12Checkboxes input[type="checkbox"]')
          .forEach((cb) => {
            cb.addEventListener("change", () => {
              if (cb.checked) drawSidForCheckbox(cb);
              else clearSidForCheckbox(cb);
            });
          });
      }

      //----displaye route tooltips- bottom of the screen-------------

      function displayExpandedRouteByKey(routeKey) {
        const [from, to] = routeKey.split("-"); //(e.g. ORSAR-KUSEN-FRA)
        const routeSteps = routes[routeKey];

        if (!routeSteps) {
          alert("Route not found!");
          return;
        }

        // ✅ NEW: store first fix (this is what your SID logic uses)
        state.currentRouteFirstFix = routeSteps[0] || null;

        // ✅ NEW: route changed → re-draw any checked SIDs for new first fix
        refreshAllCheckedSids();
        fitRouteAndSids();

        // Inject into routeMap for reuse
        if (!routeMap[from]) routeMap[from] = {};
        routeMap[from][to] = routeSteps;

        // Expand the route for the waypoints only tooltip
        const expandedRoute = expandRoute(routeSteps, airways);
        document.getElementById("expandedRouteTooltip").textContent =
          `${expandedRoute.join(" ")}`;

        // Call the original function to display the route with airway names---
        displayExpandedRoute(from, to, routeKey);
      }

      function toggleRouteTips() {
        const button = document.getElementById("toggleRouteTipsBtn");
        const routeTooltips = document.querySelectorAll(
          ".leaflet-tooltip.route-extra-label",
        );
        const remarksOverlay = document.getElementById("remarksOverlay");

        routeTipsVisible = !routeTipsVisible;
        if (routeTipsVisible) {
          routeTooltips.forEach((tooltip) => (tooltip.style.display = "block"));
          if (remarksOverlay) remarksOverlay.style.display = "block";
          //button.textContent = "RTE Info: On";
          button.style.backgroundColor = ""; // Reset background color (or set to desired ON color)
          button.style.color = "#B4F59D"; // Text color for ON state

          // Check for selected route-pair button and show tooltips
          const selectedRouteButton = document.querySelector(
            "#routeList button.selected-route",
          );
          if (selectedRouteButton) {
            const routeKey = selectedRouteButton.textContent; // Assuming button text is the routeKey
            const [from, to] = routeKey.split("-");
            showTooltipsForCurrentRoute(from, to, routeKey);
          }
        } else {
          routeTooltips.forEach((tooltip) => (tooltip.style.display = "none"));
          if (remarksOverlay) remarksOverlay.style.display = "none";
          //button.textContent = "RTE Info: OFF";
          button.style.color = "#c2c2c0"; // Text color for OFF state
        }
      }

      // Helper function to show tooltips for the current route

      function showTooltipsForCurrentRoute(from, to, routeKey) {
        const routeSteps = routeMap[from][to];
        if (!routeSteps) return;

        /*        document
      .querySelectorAll(".leaflet-tooltip.route-extra-label")
      .forEach((tooltip) => {
      map.removeLayer(tooltip);
      });
      */
        if (CFL_XFL[routeKey]) {
          // Start point tooltip: CFL
          const startPointName = routeSteps[0];
          const startPoint = extraPoints[startPointName];
          if (startPoint) {
            const startCoord = [
              convertDMSToDecimal(startPoint[0]),
              convertDMSToDecimal(startPoint[1]),
            ];
            const startTooltip = L.tooltip({
              className: "route-extra-label",
              permanent: true,
              direction: "top",
              offset: [0, -20],
            })
              .setLatLng(startCoord)
              .setContent(`CFL: ${CFL_XFL[routeKey].CFL || ""}`)
              .addTo(map);
            drawnRouteLayers.push(startTooltip);
          }

          // End point tooltip: XFL
          const lastPointName = routeSteps[routeSteps.length - 1];
          const lastPoint = extraPoints[lastPointName];
          if (lastPoint) {
            const lastCoord = [
              convertDMSToDecimal(lastPoint[0]),
              convertDMSToDecimal(lastPoint[1]),
            ];
            const endTooltip = L.tooltip({
              className: "route-extra-label",
              permanent: true,
              direction: "top",
              offset: [0, -20],
            })
              .setLatLng(lastCoord)
              .setContent(`XFL: ${CFL_XFL[routeKey].XFL || ""}`)
              .addTo(map);
            drawnRouteLayers.push(endTooltip);
          }
        }

        // Remarks overlay
        const remarksOverlay = document.getElementById("remarksOverlay");
        if (CFL_XFL[routeKey] && CFL_XFL[routeKey].REMARKS) {
          remarksOverlay.innerHTML = `# ${CFL_XFL[routeKey].REMARKS}`;
          remarksOverlay.style.display = "block";
        } else {
          remarksOverlay.style.display = "none";
        }
      }

      //------------------------------------------
      function displayExpandedRoute(from, to, routeKey) {
        clearRouteLayers(); // Clears existing layers, including tooltips
        const hoverSectorLayers = {};
        let temporarySectors = [];

        if (!routeMap[from] || !routeMap[from][to]) {
          alert("Route not found!");
          return;
        }

        const routeSteps = routeMap[from][to];
        document.getElementById("routeTooltip").textContent =
          `${routeSteps.join(" ")}`;

        const sectors = routeSectors[routeKey];
        const sectorText = sectors ? sectors.join(", ") : "—";
        document.getElementById("sectorTooltip").textContent =
          `Sectors: ${sectorText}`;

        const sectorTooltip = document.getElementById("sectorTooltip");

        sectorTooltip.onmouseenter = () => {
          const sectors = routeSectors[routeKey];
          if (!sectors) return;

          sectors.forEach((code) => {
            if (!sectorPolygons[code] || sectorLayers[code]) return;

            const color = sectorColors[code] || "orange";
            const poly = L.polyline(sectorPolygons[code], {
              color: color,
              weight: 1.5,
              dashArray: "5 5",
              opacity: 0.2,
              fill: true,
              fillColor: color,
              fillOpacity: 0.2,
            }).addTo(map);

            sectorHoverLayers[code] = poly;
            temporarySectors.push(code);
          });
        };

        sectorTooltip.onmouseleave = () => {
          temporarySectors.forEach((code) => {
            const layer = sectorHoverLayers[code];
            if (layer) {
              map.removeLayer(layer);
              delete sectorHoverLayers[code];
            }
          });
          temporarySectors = [];
        };

        const { airwaySegments, dctSegments } = expandRouteWithAirwaySegments(
          routeSteps,
          airways,
        );

        const airwayColorMap = {};
        let colorIndex = 0;

        airwaySegments.forEach(({ airway }) => {
          if (!airwayColorMap[airway]) {
            airwayColorMap[airway] =
              airwayColors[colorIndex++ % airwayColors.length];
          }
        });

        highlightAirwaysUsedInRoute(routeSteps, airwayColorMap);

        const latlngs = [];
        const drawnPoints = new Set();

        // compute bounds before animation
        airwaySegments.forEach((seg) => {
          seg.points.forEach((p) => {
            if (extraPoints[p]) {
              latlngs.push([
                convertDMSToDecimal(extraPoints[p][0]),
                convertDMSToDecimal(extraPoints[p][1]),
              ]);
            }
          });
        });

        dctSegments.forEach(({ from, to }) => {
          if (extraPoints[from] && extraPoints[to]) {
            latlngs.push([
              convertDMSToDecimal(extraPoints[from][0]),
              convertDMSToDecimal(extraPoints[from][1]),
            ]);
            latlngs.push([
              convertDMSToDecimal(extraPoints[to][0]),
              convertDMSToDecimal(extraPoints[to][1]),
            ]);
          }
        });

        //----------pan fly animation of map ------------------
        if (latlngs.length > 1) {
          const bounds = L.latLngBounds(latlngs);
          lastRouteBounds = bounds;

          // ✅ Combine route bounds + all SID bounds (if any)
          let combinedBounds = L.latLngBounds(bounds);

          if (typeof sidLayerGroup !== "undefined" && sidLayerGroup) {
            sidLayerGroup.eachLayer((layer) => {
              if (layer && typeof layer.getBounds === "function") {
                combinedBounds.extend(layer.getBounds());
              }
            });
          }

          // --- Calculate orientation (use combined bounds so padding matches what we fit to) ---
          const sw = combinedBounds.getSouthWest();
          const ne = combinedBounds.getNorthEast();
          const height = Math.abs(ne.lat - sw.lat);
          const width = Math.abs(ne.lng - sw.lng);

          // --- Dynamic padding ---
          let padding;
          if (height > width) {
            // Route+SID more vertical
            padding = [100, 130]; // [horz, vert]
          } else {
            // Route+SID more horizontal
            padding = [250, 140];
          }

          map.flyToBounds(combinedBounds, {
            padding: padding,
            maxZoom: 9.1,
            duration: 0.5,
            easeLinearity: 0.25,
          });

          let started = false;
          const startAnimation = () => {
            if (started) return;
            started = true;

            setTimeout(() => {
              const combinedSegments = [];

              for (let i = 0; i < routeSteps.length; i++) {
                const step = routeSteps[i];

                // If this is an airway, expand its segment
                if (airways[step]) {
                  const airway = step;
                  const entry = routeSteps[i - 1];
                  const exit = routeSteps[i + 1];

                  if (entry && exit) {
                    const airwayPoints = airways[airway];
                    let entryIndex = airwayPoints.indexOf(entry);
                    let exitIndex = airwayPoints.indexOf(exit);

                    if (entryIndex !== -1 && exitIndex !== -1) {
                      let segment = airwayPoints.slice(
                        Math.min(entryIndex, exitIndex),
                        Math.max(entryIndex, exitIndex) + 1,
                      );
                      if (entryIndex > exitIndex) segment.reverse();

                      combinedSegments.push({
                        points: segment,
                        color: airwayColorMap[airway] || "yellow",
                        airway,
                      });
                    }
                  }
                }

                // If this is a DCT, insert the direct leg immediately
                if (step === "DCT" && i > 0 && i < routeSteps.length - 1) {
                  const from = routeSteps[i - 1];
                  const to = routeSteps[i + 1];
                  const pt1 = extraPoints[from];
                  const pt2 = extraPoints[to];
                  if (pt1 && pt2) {
                    combinedSegments.push({
                      points: [from, to],
                      color: "#CBCBCB",
                      airway: null,
                    });
                  }
                }
              }

              if (combinedSegments.length > 0) {
                animateSegmentChain(combinedSegments, 0);
              }
            }, 50); //small delay after pan ends
          };

          // Only run when pan/zoom animation completes
          map.once("moveend", startAnimation);
          setTimeout(startAnimation, 470); // force start animation after 0.47 second (pan duration + delay + extra)
        }

        // Show arrow/circle at last point
        const lastPointName = routeSteps[routeSteps.length - 1];
        const lastPoint = extraPoints[lastPointName];
        if (lastPoint) {
          const lastCoord = [
            convertDMSToDecimal(lastPoint[0]),
            convertDMSToDecimal(lastPoint[1]),
          ];
          const arrow = L.divIcon({
            className: "arrow-head",
            iconSize: [11, 11],
            iconAnchor: [8, 8],
            html: `<div></div>`,
          });
          const arrowMarker = L.marker(lastCoord, { icon: arrow }).addTo(map);
          drawnRouteLayers.push(arrowMarker);

          // Add tooltips at start and end with CFL and XFL if routeTipsVisible is true and key exists

          if (routeTipsVisible && CFL_XFL[routeKey]) {
            const startPointName = routeSteps[0];
            const startPoint = extraPoints[startPointName];
            if (startPoint) {
              const startCoord = [
                convertDMSToDecimal(startPoint[0]),
                convertDMSToDecimal(startPoint[1]),
              ];
              const startTooltip = L.tooltip({
                className: "route-extra-label",
                permanent: true,
                direction: "top",
                offset: [0, -20],
              })
                .setLatLng(startCoord)
                .setContent(`CFL: ${CFL_XFL[routeKey].CFL || ""}`)
                .addTo(map);
              drawnRouteLayers.push(startTooltip);
            }

            const endTooltip = L.tooltip({
              className: "route-extra-label",
              permanent: true,
              direction: "top",
              offset: [0, -20],
            })
              .setLatLng(lastCoord)
              .setContent(`XFL: ${CFL_XFL[routeKey].XFL || ""}`)
              .addTo(map);
            drawnRouteLayers.push(endTooltip);
          }
        }

        // Add remarks tooltip if routeTipsVisible is true and key exists
        const remarksOverlay = document.getElementById("remarksOverlay");
        if (
          routeTipsVisible &&
          CFL_XFL[routeKey] &&
          CFL_XFL[routeKey].REMARKS
        ) {
          remarksOverlay.innerHTML = `# ${CFL_XFL[routeKey].REMARKS}`;
          remarksOverlay.style.display = "block";
        } else {
          remarksOverlay.style.display = "none";
        }
      }

      // draw route animate a chain of segments with controlled speed
      function animateSegmentChain(segments, segmentIndex, doneCallback) {
        if (segmentIndex >= segments.length) {
          if (doneCallback) doneCallback(); // call back after finishing
          return;
        }

        const { points, color, airway } = segments[segmentIndex];
        let index = 0;
        const totalPoints = points.length;
        const line = L.polyline([], {
          color: color,
          weight: 3,
          opacity: 1,
        }).addTo(map);
        drawnRouteLayers.push(line);

        let lastFrameTime = performance.now();
        const frameDelay = 50; // Adjust this value (in ms) to control animation speed

        function animateStep(currentTime) {
          if (index < totalPoints - 1) {
            if (currentTime - lastFrameTime >= frameDelay) {
              const name1 = points[index];
              const name2 = points[index + 1];
              const pt1 = extraPoints[name1];
              const pt2 = extraPoints[name2];
              if (pt1 && pt2) {
                const coords = [
                  [convertDMSToDecimal(pt1[0]), convertDMSToDecimal(pt1[1])],
                  [convertDMSToDecimal(pt2[0]), convertDMSToDecimal(pt2[1])],
                ];
                line.addLatLng(coords[1]); // Add the next point to extend the line

                // Add airway label at the midpoint if it's the middle segment
                if (index === Math.floor((totalPoints - 1) / 2) && airway) {
                  const midLat = (coords[0][0] + coords[1][0]) / 2;
                  const midLng = (coords[0][1] + coords[1][1]) / 2;
                  const label = L.tooltip({
                    permanent: true,
                    direction: "center",
                    className: "airway-label",
                    offset: [0, 0],
                    opacity: 3.5,
                  })
                    .setLatLng([midLat, midLng])
                    .setContent(
                      `<span style=font-weight:bold;">${airway}</span>`,
                    )
                    .addTo(map);
                  drawnRouteLayers.push(label);
                }

                index++;
                lastFrameTime = currentTime;
              }
            }
            window.animationFrameId = requestAnimationFrame(animateStep);
          } else {
            window.animationFrameId = requestAnimationFrame(
              () =>
                animateSegmentChain(segments, segmentIndex + 1, doneCallback), // pass callback down
            );
          }
        }
        // Start with the first point
        const firstPoint = extraPoints[points[0]];
        if (firstPoint) {
          line.addLatLng([
            convertDMSToDecimal(firstPoint[0]),
            convertDMSToDecimal(firstPoint[1]),
          ]);
          window.animationFrameId = requestAnimationFrame(animateStep);
        }
      }

      function clearRouteLayers() {
        drawnRouteLayers.forEach((layer) => map.removeLayer(layer));
        drawnRouteLayers = [];

        highlightedAirwayLayers.forEach((layer) => map.removeLayer(layer));
        highlightedAirwayLayers = [];

        // Reset route-pair button state and clear any pending animations
        const activeButton = document.querySelector(
          "#routeList button.selected-route",
        );
        if (activeButton) {
          // Ensure selected state persists by not resetting unless a new button is clicked
        } else {
          document.querySelectorAll("#routeList button").forEach((btn) => {
            btn.classList.remove("selected-route");
            btn.style.backgroundColor = ""; // Reset to default only if no active selection
          });
        }

        // Cancel any pending animation frames
        if (window.animationFrameId) {
          cancelAnimationFrame(window.animationFrameId);
          window.animationFrameId = null;
        }
      }

      //-----------------------------------------------------
      function highlightAirwaysUsedInRoute(routeSteps, airwayColorMap) {
        // Clear old highlights
        highlightedAirwayLayers.forEach((layer) => map.removeLayer(layer));
        highlightedAirwayLayers = [];

        const usedAirways = routeSteps.filter((step) => airways[step]);

        usedAirways.forEach((airwayName) => {
          const points = airways[airwayName];

          const latlngs = points
            .map((name) => {
              const pt = extraPoints[name];
              if (pt) {
                return [convertDMSToDecimal(pt[0]), convertDMSToDecimal(pt[1])];
              }
              return null;
            })
            .filter(Boolean);

          if (latlngs.length >= 2) {
            const color = airwayColorMap[airwayName] || "white";

            const line = L.polyline(latlngs, {
              color,
              weight: 1.8,
              dashArray: "2 8",
              opacity: 0.7,
            }).addTo(map);

            highlightedAirwayLayers.push(line);
          }
        });
      }

      //------highlight whole airway when selected airway name
      let singleAirwayHighlightLayer = null;
      function clearAirwayHighlight() {
        highlightedAirwayLayers.forEach((layer) => map.removeLayer(layer));
        highlightedAirwayLayers = [];
        activeHighlightedAirway = null;
      }

      function highlightSingleAirway(airwayName) {
        //---- TOGGLE OFF (already selected)
        if (activeHighlightedAirways.has(airwayName)) {
          const entry = activeHighlightedAirways.get(airwayName);
          entry.layers.forEach((layer) => map.removeLayer(layer));
          activeHighlightedAirways.delete(airwayName);
          return;
        }

        const points = airways[airwayName];
        if (!points) return;

        const latlngs = points
          .map((name) => {
            const pt = extraPoints[name];
            return pt
              ? [convertDMSToDecimal(pt[0]), convertDMSToDecimal(pt[1])]
              : null;
          })
          .filter(Boolean);

        if (latlngs.length < 2) return;

        //-------Pick next color (cycle)
        const color = airwayColors[airwayColorIndex % airwayColors.length];
        airwayColorIndex++;

        const line = L.polyline(latlngs, {
          color,
          weight: 2.5,
          opacity: 0.6,
          lineCap: "round",
          lineJoin: "round",
        }).addTo(map);

        highlightedAirwayLayers.push(line);

        activeHighlightedAirways.set(airwayName, {
          layers: [line],
          color,
        });
      }

      //----select hi/low grouped sector----------------------------------------------
      function toggleSectorGroup(group, checked) {
        group.forEach((code) => {
          const checkbox = document.querySelector(
            `#sectorOptions input[value="${code}"]`,
          );
          if (checkbox) {
            checkbox.checked = checked;
            checkbox.dispatchEvent(new Event("change"));
          }
        });
      }

      //-----on page load----------------
      document.addEventListener("DOMContentLoaded", function () {
        setupSectorUI();
        setupButtonsAndToggles();
        setupSid12UI();
        setupMapHooksAndDefaults();
        toggleRouteTips();
        toggleSectorPanel();
      });

      function setupSectorUI() {
        document
          .querySelectorAll('#sectorOptions input[type="checkbox"]')
          .forEach((cb) => cb.addEventListener("change", populateRouteButtons));

        const activeSectorCodes = new Set();
        const showColorsCheckbox = document.getElementById("showSectorColors");
        if (!showColorsCheckbox) return;

        showColorsCheckbox.addEventListener("change", () => {
          Object.keys(sectorLayers).forEach(removeSector);
          if (showColorsCheckbox.checked) {
            activeSectorCodes.forEach((code) => drawSector(code));
          }
        });

        document
          .querySelectorAll(
            '#sectorOptions input[type="checkbox"]:not(#showSectorColors)',
          )
          .forEach((cb) => {
            cb.addEventListener("change", () => {
              const code = cb.value;
              if (cb.checked) {
                activeSectorCodes.add(code);
                if (showColorsCheckbox.checked) drawSector(code);
              } else {
                activeSectorCodes.delete(code);
                removeSector(code);
              }
            });
          });

        document
          .getElementById("selectHighSectors")
          ?.addEventListener("change", function () {
            toggleSectorGroup(highSectors, this.checked);
          });

        document
          .getElementById("selectLowSectors")
          ?.addEventListener("change", function () {
            toggleSectorGroup(lowSectors, this.checked);
          });

        document
          .getElementById("sectorHeader")
          ?.addEventListener("click", toggleSectorPanel);
      }

      function setupButtonsAndToggles() {
        let mapLayerPanelVisible = false;
        let sid12_PanelVisible = false;

        document
          .getElementById("toggleMapLayerBtn")
          ?.addEventListener("click", () => {
            const p = document.getElementById("mapLayerPanel");
            if (!p) return;
            p.classList.toggle("active");
            mapLayerPanelVisible = p.classList.contains("active");
          });

        // --- wire Map Layer checkbox  ---
        document
          .getElementById("mlBorders")
          ?.addEventListener("change", (e) => {
            setCountryOutlinesVisible(e.target.checked);
            //updateMapLayerButtonState();
          });

        document
          .getElementById("mlRunways")
          ?.addEventListener("change", (e) => {
            setRunwaysVisible(e.target.checked);
            //updateMapLayerButtonState();
          });
        document.getElementById("mlFixes")?.addEventListener("change", (e) => {
          setFixesVisible(e.target.checked);
          //updateMapLayerButtonState();
        });
        document
          .getElementById("mlAwyLabels")
          ?.addEventListener("change", (e) => {
            setAwyLabelsVisible(e.target.checked);
            //updateMapLayerButtonState();
          });
        document
          .getElementById("mlAirspace")
          ?.addEventListener("change", (e) => {
            setAirspaceVisible(e.target.checked);
            //updateMapLayerButtonState();
          });

        document
          .getElementById("showHoldingsBtn")
          ?.addEventListener("click", function () {
            if (holdingsVisible) {
              clearAllHoldings();
              this.style.color = "";
            } else {
              drawAllHoldings();
              this.style.color = "#b4f59d";
            }
            holdingsVisible = !holdingsVisible;
          });

        document
          .getElementById("toggleAreasBtn")
          ?.addEventListener("click", function () {
            const areasPanel = document.getElementById("areasPanel");
            if (!areasPanel) return;

            if (areasVisible) areasPanel.classList.remove("active");
            else areasPanel.classList.add("active");

            areasVisible = !areasVisible;
          });

        document
          .getElementById("clearAreasBtn")
          ?.addEventListener("click", clearAreas);

        document
          .getElementById("toggleSidBtn")
          ?.addEventListener("click", () => {
            const panel = document.getElementById("sid12_Panel");
            if (!panel) return;

            panel.classList.toggle("active");

            // optional arrow flip (nice UX)
            const btn = document.getElementById("toggleSidBtn");
            /*if (btn) {
              btn.textContent = panel.classList.contains("active")
                ? "SIDs ▼"
                : "SIDs ▸";
            }
                */
          });

        //--------toggle map---------------------
        document
          .getElementById("toggleMapBtn")
          ?.addEventListener("click", function () {
            if (mapLayerVisible) {
              map.removeLayer(baseMapLayer);
              coordLabelColor = "#878F91";
              airwayColor = "#848787"; // pick whatever you want for map OFF
              applyCoordLabelColor();
              applyAirwayColor();
              runwayLayers.forEach((layer) =>
                layer.setStyle({ color: "#00ADD6" }),
              );
            } else {
              baseMapLayer.addTo(map);
              coordLabelColor = "#627482";
              airwayColor = "#576C7D";
              applyCoordLabelColor();
              applyAirwayColor();
              runwayLayers.forEach((layer) =>
                layer.setStyle({ color: "black" }),
              );
            }

            function setExtraLabelColor(color) {
              coordLabelColor = color; // keep your global in sync (optional but useful)
              extraLabelMarkers.forEach((label) => {
                const el = label.getElement();
                if (el) el.style.color = color;
              });
            }

            mapLayerVisible = !mapLayerVisible;
          });

        //---------togglewaypoint--------
        /*
              document
                .getElementById("toggleWaypointsBtn")
                ?.addEventListener("click", function () {
                  coordsVisible = !coordsVisible;
                  extraLabelMarkers.forEach((label) => {
                    const el = label.getElement();
                    if (el) el.style.opacity = coordsVisible ? "1" : "0";
                  });
                  this.textContent = "Fixes";
                  this.style.color = coordsVisible ? "" : "#c2c2c0";
                });
      */
        function setFixesVisible(visible) {
          coordsVisible = !!visible;

          extraLabelMarkers.forEach((label) => {
            const el = label.getElement();
            if (el) el.style.opacity = coordsVisible ? "1" : "0";
          });

          /*const btn = document.getElementById("toggleWaypointsBtn");
                if (btn) btn.style.color = coordsVisible ? "" : "#c2c2c0";
      */
        }
        document
          .getElementById("toggleRouteTipsBtn")
          ?.addEventListener("click", toggleRouteTips);
        /*
              document
                .getElementById("toggleRunwaysBtn")
                ?.addEventListener("click", toggleRunwayLines);
      */
        document
          .getElementById("toggleFreqBtn")
          ?.addEventListener("click", function () {
            if (this.textContent === "FREQ") {
              addFreqMarkers();
              this.textContent = "FREQ ";
              this.style.color = "#B4F59D";
            } else {
              removeFreqMarkers();
              this.textContent = "FREQ";
              this.style.color = "";
            }
          });

        document
          .getElementById("resetViewBtn")
          ?.addEventListener("click", clearRouteLayers);
        document
          .getElementById("toggleRoutePanelBtn")
          ?.addEventListener("click", uiToggleRoutePanel);
        syncRoutePanelUI();

        document
          .getElementById("toggleDetails")
          ?.addEventListener("change", (e) => {
            const p = document.getElementById("areaDetailsPanel");
            if (p) p.style.display = e.target.checked ? "block" : "none";
          });

        const remarksOverlay = document.getElementById("remarksOverlay");
        if (remarksOverlay) remarksOverlay.style.display = "none";

        document.getElementById("zoomSliderPanel").style.display = "none";
        //updateMapLayerButtonState();
      }

      function setupMapHooksAndDefaults() {
        // text pane
        if (!map.getPane("textPane")) map.createPane("textPane");
        const textPane = map.getPane("textPane");
        textPane.style.zIndex = 10000;
        textPane.style.pointerEvents = "auto";

        // right-click measure finalize/cancel
        map.on("contextmenu", () => {
          if (ToolManager.getActive() !== "measure") return;
          if (state.measure.points.length < 2) return resetMeasure();
          finalizeMeasure();
        });

        // default rendering
        filterRoutes("Arr");
        renderTriangles();
        drawAirways();

        // combine zoomend work into ONE handler
        map.on("zoomend", () => {
          const z = map.getZoom();
          zoomSlider.value = z;
          zoomValue.textContent = z.toFixed(1);

          requestAnimationFrame(() => {
            renderTriangles();
          });
        });

        map.fitBounds(firBoundary.getBounds());
      }
    </script>
  </body>
</html>
